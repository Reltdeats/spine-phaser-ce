/**
 * Copyright for the Phaser CE Spine Plugin software and its source files:
 * @author       Ruben García Vilà
 * @version      0.9.7
 * @copyright    2023 Ruben García Vilà.
 * @license      {@link https://github.com/Reltdeats/spine-phaser-ce/blob/master/LICENSE|MIT License}
 *
 * Copyright for the Spine Runtimes software and its source files:
 * @author       Esoteric Software LLC
 * @copyright    Copyright (c) 2013-2023, Esoteric Software LLC
 * @licence      {@link https://github.com/EsotericSoftware/spine-runtimes/blob/master/LICENSE}
 * 
 */(()=>{"use strict";class t{entries={};size=0;add(t){let e=this.entries[t];return this.entries[t]=!0,!e&&(this.size++,!0)}addAll(t){let e=this.size;for(var s=0,i=t.length;s<i;s++)this.add(t[s]);return e!=this.size}contains(t){return this.entries[t]}clear(){this.entries={},this.size=0}}class e{r;g;b;a;static WHITE=new e(1,1,1,1);static RED=new e(1,0,0,1);static GREEN=new e(0,1,0,1);static BLUE=new e(0,0,1,1);static MAGENTA=new e(1,0,1,1);constructor(t=0,e=0,s=0,i=0){this.r=t,this.g=e,this.b=s,this.a=i}set(t,e,s,i){return this.r=t,this.g=e,this.b=s,this.a=i,this.clamp()}setFromColor(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this}setFromString(t){return t="#"==t.charAt(0)?t.substr(1):t,this.r=parseInt(t.substr(0,2),16)/255,this.g=parseInt(t.substr(2,2),16)/255,this.b=parseInt(t.substr(4,2),16)/255,this.a=8!=t.length?1:parseInt(t.substr(6,2),16)/255,this}add(t,e,s,i){return this.r+=t,this.g+=e,this.b+=s,this.a+=i,this.clamp()}clamp(){return this.r<0?this.r=0:this.r>1&&(this.r=1),this.g<0?this.g=0:this.g>1&&(this.g=1),this.b<0?this.b=0:this.b>1&&(this.b=1),this.a<0?this.a=0:this.a>1&&(this.a=1),this}static rgba8888ToColor(t,e){t.r=((4278190080&e)>>>24)/255,t.g=((16711680&e)>>>16)/255,t.b=((65280&e)>>>8)/255,t.a=(255&e)/255}static rgb888ToColor(t,e){t.r=((16711680&e)>>>16)/255,t.g=((65280&e)>>>8)/255,t.b=(255&e)/255}static fromString(t){return(new e).setFromString(t)}}class s{static PI=3.1415927;static PI2=2*s.PI;static radiansToDegrees=180/s.PI;static radDeg=s.radiansToDegrees;static degreesToRadians=s.PI/180;static degRad=s.degreesToRadians;static clamp(t,e,s){return t<e?e:t>s?s:t}static cosDeg(t){return Math.cos(t*s.degRad)}static sinDeg(t){return Math.sin(t*s.degRad)}static signum(t){return t>0?1:t<0?-1:0}static toInt(t){return t>0?Math.floor(t):Math.ceil(t)}static cbrt(t){let e=Math.pow(Math.abs(t),1/3);return t<0?-e:e}static randomTriangular(t,e){return s.randomTriangularWith(t,e,.5*(t+e))}static randomTriangularWith(t,e,s){let i=Math.random(),r=e-t;return i<=(s-t)/r?t+Math.sqrt(i*r*(s-t)):e-Math.sqrt((1-i)*r*(e-s))}static isPowerOfTwo(t){return t&&0==(t&t-1)}}class i{static SUPPORTS_TYPED_ARRAYS="undefined"!=typeof Float32Array;static arrayCopy(t,e,s,i,r){for(let a=e,n=i;a<e+r;a++,n++)s[n]=t[a]}static arrayFill(t,e,s,i){for(let r=e;r<s;r++)t[r]=i}static setArraySize(t,e,s=0){let i=t.length;if(i==e)return t;if(t.length=e,i<e)for(let r=i;r<e;r++)t[r]=s;return t}static ensureArrayCapacity(t,e,s=0){return t.length>=e?t:i.setArraySize(t,e,s)}static newArray(t,e){let s=new Array(t);for(let i=0;i<t;i++)s[i]=e;return s}static newFloatArray(t){if(i.SUPPORTS_TYPED_ARRAYS)return new Float32Array(t);{let e=new Array(t);for(let t=0;t<e.length;t++)e[t]=0;return e}}static newShortArray(t){if(i.SUPPORTS_TYPED_ARRAYS)return new Int16Array(t);{let e=new Array(t);for(let t=0;t<e.length;t++)e[t]=0;return e}}static toFloatArray(t){return i.SUPPORTS_TYPED_ARRAYS?new Float32Array(t):t}static toSinglePrecision(t){return i.SUPPORTS_TYPED_ARRAYS?Math.fround(t):t}static webkit602BugfixHelper(t,e){}static contains(t,e,s=!0){for(var i=0;i<t.length;i++)if(t[i]==e)return!0;return!1}static enumValue(t,e){return t[e[0].toUpperCase()+e.slice(1)]}}class r{items=new Array;instantiator;constructor(t){this.instantiator=t}obtain(){return this.items.length>0?this.items.pop():this.instantiator()}free(t){t.reset&&t.reset(),this.items.push(t)}freeAll(t){for(let e=0;e<t.length;e++)this.free(t[e])}clear(){this.items.length=0}}class a{x;y;constructor(t=0,e=0){this.x=t,this.y=e}set(t,e){return this.x=t,this.y=e,this}length(){let t=this.x,e=this.y;return Math.sqrt(t*t+e*e)}normalize(){let t=this.length();return 0!=t&&(this.x/=t,this.y/=t),this}}class n{name;constructor(t){if(!t)throw new Error("name cannot be null.");this.name=t}}class o extends n{static nextID=0;id=o.nextID++;bones=null;vertices=[];worldVerticesLength=0;timelineAttachment=this;constructor(t){super(t)}computeWorldVertices(t,e,s,i,r,a){s=r+(s>>1)*a;let n=t.bone.skeleton,o=t.deform,l=this.vertices,h=this.bones;if(!h){o.length>0&&(l=o);let n=t.bone,h=n.worldX,c=n.worldY,d=n.a,u=n.b,m=n.c,g=n.d;for(let t=e,n=r;n<s;t+=2,n+=a){let e=l[t],s=l[t+1];i[n]=e*d+s*u+h,i[n+1]=e*m+s*g+c}return}let c=0,d=0;for(let t=0;t<e;t+=2){let t=h[c];c+=t+1,d+=t}let u=n.bones;if(0==o.length)for(let t=r,e=3*d;t<s;t+=a){let s=0,r=0,a=h[c++];for(a+=c;c<a;c++,e+=3){let t=u[h[c]],i=l[e],a=l[e+1],n=l[e+2];s+=(i*t.a+a*t.b+t.worldX)*n,r+=(i*t.c+a*t.d+t.worldY)*n}i[t]=s,i[t+1]=r}else{let t=o;for(let e=r,n=3*d,o=d<<1;e<s;e+=a){let s=0,r=0,a=h[c++];for(a+=c;c<a;c++,n+=3,o+=2){let e=u[h[c]],i=l[n]+t[o],a=l[n+1]+t[o+1],d=l[n+2];s+=(i*e.a+a*e.b+e.worldX)*d,r+=(i*e.c+a*e.d+e.worldY)*d}i[e]=s,i[e+1]=r}}}copyTo(t){this.bones?(t.bones=new Array(this.bones.length),i.arrayCopy(this.bones,0,t.bones,0,this.bones.length)):t.bones=null,this.vertices&&(t.vertices=i.newFloatArray(this.vertices.length),i.arrayCopy(this.vertices,0,t.vertices,0,this.vertices.length)),t.worldVerticesLength=this.worldVerticesLength,t.timelineAttachment=this.timelineAttachment}}class l{static _nextID=0;id=l.nextID();regions;start=0;digits=0;setupIndex=0;constructor(t){this.regions=new Array(t)}copy(){let t=new l(this.regions.length);return i.arrayCopy(this.regions,0,t.regions,0,this.regions.length),t.start=this.start,t.digits=this.digits,t.setupIndex=this.setupIndex,t}apply(t,e){let s=t.sequenceIndex;-1==s&&(s=this.setupIndex),s>=this.regions.length&&(s=this.regions.length-1);let i=this.regions[s];e.region!=i&&(e.region=i,e.updateRegion())}getPath(t,e){let s=t,i=(this.start+e).toString();for(let t=this.digits-i.length;t>0;t--)s+="0";return s+=i,s}static nextID(){return l._nextID++}}var h;!function(t){t[t.hold=0]="hold",t[t.once=1]="once",t[t.loop=2]="loop",t[t.pingpong=3]="pingpong",t[t.onceReverse=4]="onceReverse",t[t.loopReverse=5]="loopReverse",t[t.pingpongReverse=6]="pingpongReverse"}(h||(h={}));const c=[h.hold,h.once,h.loop,h.pingpong,h.onceReverse,h.loopReverse,h.pingpongReverse];class d{name;timelines=[];timelineIds=new t;duration;constructor(t,e,s){if(!t)throw new Error("name cannot be null.");this.name=t,this.setTimelines(e),this.duration=s}setTimelines(t){if(!t)throw new Error("timelines cannot be null.");this.timelines=t,this.timelineIds.clear();for(var e=0;e<t.length;e++)this.timelineIds.addAll(t[e].getPropertyIds())}hasTimeline(t){for(let e=0;e<t.length;e++)if(this.timelineIds.contains(t[e]))return!0;return!1}apply(t,e,s,i,r,a,n,o){if(!t)throw new Error("skeleton cannot be null.");i&&0!=this.duration&&(s%=this.duration,e>0&&(e%=this.duration));let l=this.timelines;for(let i=0,h=l.length;i<h;i++)l[i].apply(t,e,s,r,a,n,o)}}var u,m;!function(t){t[t.setup=0]="setup",t[t.first=1]="first",t[t.replace=2]="replace",t[t.add=3]="add"}(u||(u={})),function(t){t[t.mixIn=0]="mixIn",t[t.mixOut=1]="mixOut"}(m||(m={}));const g=0,f=1,p=2,x=3,w=4,b=5,y=6,v=7,k=8,A=9,S=10,I=11,C=12,M=13,R=14,T=15,E=16,F=17,Y=18,P=19;class L{propertyIds;frames;constructor(t,e){this.propertyIds=e,this.frames=i.newFloatArray(t*this.getFrameEntries())}getPropertyIds(){return this.propertyIds}getFrameEntries(){return 1}getFrameCount(){return this.frames.length/this.getFrameEntries()}getDuration(){return this.frames[this.frames.length-this.getFrameEntries()]}static search1(t,e){let s=t.length;for(let i=1;i<s;i++)if(t[i]>e)return i-1;return s-1}static search(t,e,s){let i=t.length;for(let r=s;r<i;r+=s)if(t[r]>e)return r-s;return i-s}}class X extends L{curves;constructor(t,e,s){super(t,s),this.curves=i.newFloatArray(t+18*e),this.curves[t-1]=1}setLinear(t){this.curves[t]=0}setStepped(t){this.curves[t]=1}shrink(t){let e=this.getFrameCount()+18*t;if(this.curves.length>e){let t=i.newFloatArray(e);i.arrayCopy(this.curves,0,t,0,e),this.curves=t}}setBezier(t,e,s,i,r,a,n,o,l,h,c){let d=this.curves,u=this.getFrameCount()+18*t;0==s&&(d[e]=2+u);let m=.03*(i-2*a+o),g=.03*(r-2*n+l),f=.006*(3*(a-o)-i+h),p=.006*(3*(n-l)-r+c),x=2*m+f,w=2*g+p,b=.3*(a-i)+m+.16666667*f,y=.3*(n-r)+g+.16666667*p,v=i+b,k=r+y;for(let t=u+18;u<t;u+=2)d[u]=v,d[u+1]=k,b+=x,y+=w,x+=f,w+=p,v+=b,k+=y}getBezierValue(t,e,s,i){let r=this.curves;if(r[i]>t){let a=this.frames[e],n=this.frames[e+s];return n+(t-a)/(r[i]-a)*(r[i+1]-n)}let a=i+18;for(i+=2;i<a;i+=2)if(r[i]>=t){let e=r[i-2],s=r[i-1];return s+(t-e)/(r[i]-e)*(r[i+1]-s)}e+=this.getFrameEntries();let n=r[a-2],o=r[a-1];return o+(t-n)/(this.frames[e]-n)*(this.frames[e+s]-o)}}class B extends X{constructor(t,e,s){super(t,e,[s])}getFrameEntries(){return 2}setFrame(t,e,s){t<<=1,this.frames[t]=e,this.frames[t+1]=s}getCurveValue(t){let e=this.frames,s=e.length-2;for(let i=2;i<=s;i+=2)if(e[i]>t){s=i-2;break}let i=this.curves[s>>1];switch(i){case 0:let i=e[s],r=e[s+1];return r+(t-i)/(e[s+2]-i)*(e[s+2+1]-r);case 1:return e[s+1]}return this.getBezierValue(t,s,1,i-2)}}class _ extends X{constructor(t,e,s,i){super(t,e,[s,i])}getFrameEntries(){return 3}setFrame(t,e,s,i){t*=3,this.frames[t]=e,this.frames[t+1]=s,this.frames[t+2]=i}}class V extends B{boneIndex=0;constructor(t,e,s){super(t,e,g+"|"+s),this.boneIndex=s}apply(t,e,s,i,r,a,n){let o=t.bones[this.boneIndex];if(!o.active)return;if(s<this.frames[0]){switch(a){case u.setup:return void(o.rotation=o.data.rotation);case u.first:o.rotation+=(o.data.rotation-o.rotation)*r}return}let l=this.getCurveValue(s);switch(a){case u.setup:o.rotation=o.data.rotation+l*r;break;case u.first:case u.replace:l+=o.data.rotation-o.rotation;case u.add:o.rotation+=l*r}}}class D extends _{boneIndex=0;constructor(t,e,s){super(t,e,f+"|"+s,p+"|"+s),this.boneIndex=s}apply(t,e,s,i,r,a,n){let o=t.bones[this.boneIndex];if(!o.active)return;let l=this.frames;if(s<l[0]){switch(a){case u.setup:return o.x=o.data.x,void(o.y=o.data.y);case u.first:o.x+=(o.data.x-o.x)*r,o.y+=(o.data.y-o.y)*r}return}let h=0,c=0,d=L.search(l,s,3),m=this.curves[d/3];switch(m){case 0:let t=l[d];h=l[d+1],c=l[d+2];let e=(s-t)/(l[d+3]-t);h+=(l[d+3+1]-h)*e,c+=(l[d+3+2]-c)*e;break;case 1:h=l[d+1],c=l[d+2];break;default:h=this.getBezierValue(s,d,1,m-2),c=this.getBezierValue(s,d,2,m+18-2)}switch(a){case u.setup:o.x=o.data.x+h*r,o.y=o.data.y+c*r;break;case u.first:case u.replace:o.x+=(o.data.x+h-o.x)*r,o.y+=(o.data.y+c-o.y)*r;break;case u.add:o.x+=h*r,o.y+=c*r}}}class N extends B{boneIndex=0;constructor(t,e,s){super(t,e,f+"|"+s),this.boneIndex=s}apply(t,e,s,i,r,a,n){let o=t.bones[this.boneIndex];if(!o.active)return;if(s<this.frames[0]){switch(a){case u.setup:return void(o.x=o.data.x);case u.first:o.x+=(o.data.x-o.x)*r}return}let l=this.getCurveValue(s);switch(a){case u.setup:o.x=o.data.x+l*r;break;case u.first:case u.replace:o.x+=(o.data.x+l-o.x)*r;break;case u.add:o.x+=l*r}}}class U extends B{boneIndex=0;constructor(t,e,s){super(t,e,p+"|"+s),this.boneIndex=s}apply(t,e,s,i,r,a,n){let o=t.bones[this.boneIndex];if(!o.active)return;if(s<this.frames[0]){switch(a){case u.setup:return void(o.y=o.data.y);case u.first:o.y+=(o.data.y-o.y)*r}return}let l=this.getCurveValue(s);switch(a){case u.setup:o.y=o.data.y+l*r;break;case u.first:case u.replace:o.y+=(o.data.y+l-o.y)*r;break;case u.add:o.y+=l*r}}}class O extends _{boneIndex=0;constructor(t,e,s){super(t,e,x+"|"+s,w+"|"+s),this.boneIndex=s}apply(t,e,i,r,a,n,o){let l=t.bones[this.boneIndex];if(!l.active)return;let h,c,d=this.frames;if(i<d[0]){switch(n){case u.setup:return l.scaleX=l.data.scaleX,void(l.scaleY=l.data.scaleY);case u.first:l.scaleX+=(l.data.scaleX-l.scaleX)*a,l.scaleY+=(l.data.scaleY-l.scaleY)*a}return}let g=L.search(d,i,3),f=this.curves[g/3];switch(f){case 0:let t=d[g];h=d[g+1],c=d[g+2];let e=(i-t)/(d[g+3]-t);h+=(d[g+3+1]-h)*e,c+=(d[g+3+2]-c)*e;break;case 1:h=d[g+1],c=d[g+2];break;default:h=this.getBezierValue(i,g,1,f-2),c=this.getBezierValue(i,g,2,f+18-2)}if(h*=l.data.scaleX,c*=l.data.scaleY,1==a)n==u.add?(l.scaleX+=h-l.data.scaleX,l.scaleY+=c-l.data.scaleY):(l.scaleX=h,l.scaleY=c);else{let t=0,e=0;if(o==m.mixOut)switch(n){case u.setup:t=l.data.scaleX,e=l.data.scaleY,l.scaleX=t+(Math.abs(h)*s.signum(t)-t)*a,l.scaleY=e+(Math.abs(c)*s.signum(e)-e)*a;break;case u.first:case u.replace:t=l.scaleX,e=l.scaleY,l.scaleX=t+(Math.abs(h)*s.signum(t)-t)*a,l.scaleY=e+(Math.abs(c)*s.signum(e)-e)*a;break;case u.add:l.scaleX+=(h-l.data.scaleX)*a,l.scaleY+=(c-l.data.scaleY)*a}else switch(n){case u.setup:t=Math.abs(l.data.scaleX)*s.signum(h),e=Math.abs(l.data.scaleY)*s.signum(c),l.scaleX=t+(h-t)*a,l.scaleY=e+(c-e)*a;break;case u.first:case u.replace:t=Math.abs(l.scaleX)*s.signum(h),e=Math.abs(l.scaleY)*s.signum(c),l.scaleX=t+(h-t)*a,l.scaleY=e+(c-e)*a;break;case u.add:l.scaleX+=(h-l.data.scaleX)*a,l.scaleY+=(c-l.data.scaleY)*a}}}}class W extends B{boneIndex=0;constructor(t,e,s){super(t,e,x+"|"+s),this.boneIndex=s}apply(t,e,i,r,a,n,o){let l=t.bones[this.boneIndex];if(!l.active)return;if(i<this.frames[0]){switch(n){case u.setup:return void(l.scaleX=l.data.scaleX);case u.first:l.scaleX+=(l.data.scaleX-l.scaleX)*a}return}let h=this.getCurveValue(i)*l.data.scaleX;if(1==a)n==u.add?l.scaleX+=h-l.data.scaleX:l.scaleX=h;else{let t=0;if(o==m.mixOut)switch(n){case u.setup:t=l.data.scaleX,l.scaleX=t+(Math.abs(h)*s.signum(t)-t)*a;break;case u.first:case u.replace:t=l.scaleX,l.scaleX=t+(Math.abs(h)*s.signum(t)-t)*a;break;case u.add:l.scaleX+=(h-l.data.scaleX)*a}else switch(n){case u.setup:t=Math.abs(l.data.scaleX)*s.signum(h),l.scaleX=t+(h-t)*a;break;case u.first:case u.replace:t=Math.abs(l.scaleX)*s.signum(h),l.scaleX=t+(h-t)*a;break;case u.add:l.scaleX+=(h-l.data.scaleX)*a}}}}class z extends B{boneIndex=0;constructor(t,e,s){super(t,e,w+"|"+s),this.boneIndex=s}apply(t,e,i,r,a,n,o){let l=t.bones[this.boneIndex];if(!l.active)return;if(i<this.frames[0]){switch(n){case u.setup:return void(l.scaleY=l.data.scaleY);case u.first:l.scaleY+=(l.data.scaleY-l.scaleY)*a}return}let h=this.getCurveValue(i)*l.data.scaleY;if(1==a)n==u.add?l.scaleY+=h-l.data.scaleY:l.scaleY=h;else{let t=0;if(o==m.mixOut)switch(n){case u.setup:t=l.data.scaleY,l.scaleY=t+(Math.abs(h)*s.signum(t)-t)*a;break;case u.first:case u.replace:t=l.scaleY,l.scaleY=t+(Math.abs(h)*s.signum(t)-t)*a;break;case u.add:l.scaleY+=(h-l.data.scaleY)*a}else switch(n){case u.setup:t=Math.abs(l.data.scaleY)*s.signum(h),l.scaleY=t+(h-t)*a;break;case u.first:case u.replace:t=Math.abs(l.scaleY)*s.signum(h),l.scaleY=t+(h-t)*a;break;case u.add:l.scaleY+=(h-l.data.scaleY)*a}}}}class q extends _{boneIndex=0;constructor(t,e,s){super(t,e,b+"|"+s,y+"|"+s),this.boneIndex=s}apply(t,e,s,i,r,a,n){let o=t.bones[this.boneIndex];if(!o.active)return;let l=this.frames;if(s<l[0]){switch(a){case u.setup:return o.shearX=o.data.shearX,void(o.shearY=o.data.shearY);case u.first:o.shearX+=(o.data.shearX-o.shearX)*r,o.shearY+=(o.data.shearY-o.shearY)*r}return}let h=0,c=0,d=L.search(l,s,3),m=this.curves[d/3];switch(m){case 0:let t=l[d];h=l[d+1],c=l[d+2];let e=(s-t)/(l[d+3]-t);h+=(l[d+3+1]-h)*e,c+=(l[d+3+2]-c)*e;break;case 1:h=l[d+1],c=l[d+2];break;default:h=this.getBezierValue(s,d,1,m-2),c=this.getBezierValue(s,d,2,m+18-2)}switch(a){case u.setup:o.shearX=o.data.shearX+h*r,o.shearY=o.data.shearY+c*r;break;case u.first:case u.replace:o.shearX+=(o.data.shearX+h-o.shearX)*r,o.shearY+=(o.data.shearY+c-o.shearY)*r;break;case u.add:o.shearX+=h*r,o.shearY+=c*r}}}class $ extends B{boneIndex=0;constructor(t,e,s){super(t,e,b+"|"+s),this.boneIndex=s}apply(t,e,s,i,r,a,n){let o=t.bones[this.boneIndex];if(!o.active)return;if(s<this.frames[0]){switch(a){case u.setup:return void(o.shearX=o.data.shearX);case u.first:o.shearX+=(o.data.shearX-o.shearX)*r}return}let l=this.getCurveValue(s);switch(a){case u.setup:o.shearX=o.data.shearX+l*r;break;case u.first:case u.replace:o.shearX+=(o.data.shearX+l-o.shearX)*r;break;case u.add:o.shearX+=l*r}}}class G extends B{boneIndex=0;constructor(t,e,s){super(t,e,y+"|"+s),this.boneIndex=s}apply(t,e,s,i,r,a,n){let o=t.bones[this.boneIndex];if(!o.active)return;if(s<this.frames[0]){switch(a){case u.setup:return void(o.shearY=o.data.shearY);case u.first:o.shearY+=(o.data.shearY-o.shearY)*r}return}let l=this.getCurveValue(s);switch(a){case u.setup:o.shearY=o.data.shearY+l*r;break;case u.first:case u.replace:o.shearY+=(o.data.shearY+l-o.shearY)*r;break;case u.add:o.shearY+=l*r}}}class H extends X{slotIndex=0;constructor(t,e,s){super(t,e,[v+"|"+s,k+"|"+s]),this.slotIndex=s}getFrameEntries(){return 5}setFrame(t,e,s,i,r,a){t*=5,this.frames[t]=e,this.frames[t+1]=s,this.frames[t+2]=i,this.frames[t+3]=r,this.frames[t+4]=a}apply(t,e,s,i,r,a,n){let o=t.slots[this.slotIndex];if(!o.bone.active)return;let l=this.frames,h=o.color;if(s<l[0]){let t=o.data.color;switch(a){case u.setup:return void h.setFromColor(t);case u.first:h.add((t.r-h.r)*r,(t.g-h.g)*r,(t.b-h.b)*r,(t.a-h.a)*r)}return}let c=0,d=0,m=0,g=0,f=L.search(l,s,5),p=this.curves[f/5];switch(p){case 0:let t=l[f];c=l[f+1],d=l[f+2],m=l[f+3],g=l[f+4];let e=(s-t)/(l[f+5]-t);c+=(l[f+5+1]-c)*e,d+=(l[f+5+2]-d)*e,m+=(l[f+5+3]-m)*e,g+=(l[f+5+4]-g)*e;break;case 1:c=l[f+1],d=l[f+2],m=l[f+3],g=l[f+4];break;default:c=this.getBezierValue(s,f,1,p-2),d=this.getBezierValue(s,f,2,p+18-2),m=this.getBezierValue(s,f,3,p+36-2),g=this.getBezierValue(s,f,4,p+54-2)}1==r?h.set(c,d,m,g):(a==u.setup&&h.setFromColor(o.data.color),h.add((c-h.r)*r,(d-h.g)*r,(m-h.b)*r,(g-h.a)*r))}}class j extends X{slotIndex=0;constructor(t,e,s){super(t,e,[v+"|"+s]),this.slotIndex=s}getFrameEntries(){return 4}setFrame(t,e,s,i,r){t<<=2,this.frames[t]=e,this.frames[t+1]=s,this.frames[t+2]=i,this.frames[t+3]=r}apply(t,e,s,i,r,a,n){let o=t.slots[this.slotIndex];if(!o.bone.active)return;let l=this.frames,h=o.color;if(s<l[0]){let t=o.data.color;switch(a){case u.setup:return h.r=t.r,h.g=t.g,void(h.b=t.b);case u.first:h.r+=(t.r-h.r)*r,h.g+=(t.g-h.g)*r,h.b+=(t.b-h.b)*r}return}let c=0,d=0,m=0,g=L.search(l,s,4),f=this.curves[g>>2];switch(f){case 0:let t=l[g];c=l[g+1],d=l[g+2],m=l[g+3];let e=(s-t)/(l[g+4]-t);c+=(l[g+4+1]-c)*e,d+=(l[g+4+2]-d)*e,m+=(l[g+4+3]-m)*e;break;case 1:c=l[g+1],d=l[g+2],m=l[g+3];break;default:c=this.getBezierValue(s,g,1,f-2),d=this.getBezierValue(s,g,2,f+18-2),m=this.getBezierValue(s,g,3,f+36-2)}if(1==r)h.r=c,h.g=d,h.b=m;else{if(a==u.setup){let t=o.data.color;h.r=t.r,h.g=t.g,h.b=t.b}h.r+=(c-h.r)*r,h.g+=(d-h.g)*r,h.b+=(m-h.b)*r}}}class K extends B{slotIndex=0;constructor(t,e,s){super(t,e,k+"|"+s),this.slotIndex=s}apply(t,e,s,i,r,a,n){let o=t.slots[this.slotIndex];if(!o.bone.active)return;let l=o.color;if(s<this.frames[0]){let t=o.data.color;switch(a){case u.setup:return void(l.a=t.a);case u.first:l.a+=(t.a-l.a)*r}return}let h=this.getCurveValue(s);1==r?l.a=h:(a==u.setup&&(l.a=o.data.color.a),l.a+=(h-l.a)*r)}}class Q extends X{slotIndex=0;constructor(t,e,s){super(t,e,[v+"|"+s,k+"|"+s,A+"|"+s]),this.slotIndex=s}getFrameEntries(){return 8}setFrame(t,e,s,i,r,a,n,o,l){t<<=3,this.frames[t]=e,this.frames[t+1]=s,this.frames[t+2]=i,this.frames[t+3]=r,this.frames[t+4]=a,this.frames[t+5]=n,this.frames[t+6]=o,this.frames[t+7]=l}apply(t,e,s,i,r,a,n){let o=t.slots[this.slotIndex];if(!o.bone.active)return;let l=this.frames,h=o.color,c=o.darkColor;if(s<l[0]){let t=o.data.color,e=o.data.darkColor;switch(a){case u.setup:return h.setFromColor(t),c.r=e.r,c.g=e.g,void(c.b=e.b);case u.first:h.add((t.r-h.r)*r,(t.g-h.g)*r,(t.b-h.b)*r,(t.a-h.a)*r),c.r+=(e.r-c.r)*r,c.g+=(e.g-c.g)*r,c.b+=(e.b-c.b)*r}return}let d=0,m=0,g=0,f=0,p=0,x=0,w=0,b=L.search(l,s,8),y=this.curves[b>>3];switch(y){case 0:let t=l[b];d=l[b+1],m=l[b+2],g=l[b+3],f=l[b+4],p=l[b+5],x=l[b+6],w=l[b+7];let e=(s-t)/(l[b+8]-t);d+=(l[b+8+1]-d)*e,m+=(l[b+8+2]-m)*e,g+=(l[b+8+3]-g)*e,f+=(l[b+8+4]-f)*e,p+=(l[b+8+5]-p)*e,x+=(l[b+8+6]-x)*e,w+=(l[b+8+7]-w)*e;break;case 1:d=l[b+1],m=l[b+2],g=l[b+3],f=l[b+4],p=l[b+5],x=l[b+6],w=l[b+7];break;default:d=this.getBezierValue(s,b,1,y-2),m=this.getBezierValue(s,b,2,y+18-2),g=this.getBezierValue(s,b,3,y+36-2),f=this.getBezierValue(s,b,4,y+54-2),p=this.getBezierValue(s,b,5,y+72-2),x=this.getBezierValue(s,b,6,y+90-2),w=this.getBezierValue(s,b,7,y+108-2)}if(1==r)h.set(d,m,g,f),c.r=p,c.g=x,c.b=w;else{if(a==u.setup){h.setFromColor(o.data.color);let t=o.data.darkColor;c.r=t.r,c.g=t.g,c.b=t.b}h.add((d-h.r)*r,(m-h.g)*r,(g-h.b)*r,(f-h.a)*r),c.r+=(p-c.r)*r,c.g+=(x-c.g)*r,c.b+=(w-c.b)*r}}}class J extends X{slotIndex=0;constructor(t,e,s){super(t,e,[v+"|"+s,A+"|"+s]),this.slotIndex=s}getFrameEntries(){return 7}setFrame(t,e,s,i,r,a,n,o){t*=7,this.frames[t]=e,this.frames[t+1]=s,this.frames[t+2]=i,this.frames[t+3]=r,this.frames[t+4]=a,this.frames[t+5]=n,this.frames[t+6]=o}apply(t,e,s,i,r,a,n){let o=t.slots[this.slotIndex];if(!o.bone.active)return;let l=this.frames,h=o.color,c=o.darkColor;if(s<l[0]){let t=o.data.color,e=o.data.darkColor;switch(a){case u.setup:return h.r=t.r,h.g=t.g,h.b=t.b,c.r=e.r,c.g=e.g,void(c.b=e.b);case u.first:h.r+=(t.r-h.r)*r,h.g+=(t.g-h.g)*r,h.b+=(t.b-h.b)*r,c.r+=(e.r-c.r)*r,c.g+=(e.g-c.g)*r,c.b+=(e.b-c.b)*r}return}let d=0,m=0,g=0,f=0,p=0,x=0,w=L.search(l,s,7),b=this.curves[w/7];switch(b){case 0:let t=l[w];d=l[w+1],m=l[w+2],g=l[w+3],f=l[w+4],p=l[w+5],x=l[w+6];let e=(s-t)/(l[w+7]-t);d+=(l[w+7+1]-d)*e,m+=(l[w+7+2]-m)*e,g+=(l[w+7+3]-g)*e,f+=(l[w+7+4]-f)*e,p+=(l[w+7+5]-p)*e,x+=(l[w+7+6]-x)*e;break;case 1:d=l[w+1],m=l[w+2],g=l[w+3],f=l[w+4],p=l[w+5],x=l[w+6];break;default:d=this.getBezierValue(s,w,1,b-2),m=this.getBezierValue(s,w,2,b+18-2),g=this.getBezierValue(s,w,3,b+36-2),f=this.getBezierValue(s,w,4,b+54-2),p=this.getBezierValue(s,w,5,b+72-2),x=this.getBezierValue(s,w,6,b+90-2)}if(1==r)h.r=d,h.g=m,h.b=g,c.r=f,c.g=p,c.b=x;else{if(a==u.setup){let t=o.data.color,e=o.data.darkColor;h.r=t.r,h.g=t.g,h.b=t.b,c.r=e.r,c.g=e.g,c.b=e.b}h.r+=(d-h.r)*r,h.g+=(m-h.g)*r,h.b+=(g-h.b)*r,c.r+=(f-c.r)*r,c.g+=(p-c.g)*r,c.b+=(x-c.b)*r}}}class Z extends L{slotIndex=0;attachmentNames;constructor(t,e){super(t,[S+"|"+e]),this.slotIndex=e,this.attachmentNames=new Array(t)}getFrameCount(){return this.frames.length}setFrame(t,e,s){this.frames[t]=e,this.attachmentNames[t]=s}apply(t,e,s,i,r,a,n){let o=t.slots[this.slotIndex];o.bone.active&&(n!=m.mixOut?s<this.frames[0]?a!=u.setup&&a!=u.first||this.setAttachment(t,o,o.data.attachmentName):this.setAttachment(t,o,this.attachmentNames[L.search1(this.frames,s)]):a==u.setup&&this.setAttachment(t,o,o.data.attachmentName))}setAttachment(t,e,s){e.setAttachment(s?t.getAttachment(this.slotIndex,s):null)}}class tt extends X{slotIndex=0;attachment;vertices;constructor(t,e,s,i){super(t,e,[I+"|"+s+"|"+i.id]),this.slotIndex=s,this.attachment=i,this.vertices=new Array(t)}getFrameCount(){return this.frames.length}setFrame(t,e,s){this.frames[t]=e,this.vertices[t]=s}setBezier(t,e,s,i,r,a,n,o,l,h,c){let d=this.curves,u=this.getFrameCount()+18*t;0==s&&(d[e]=2+u);let m=.03*(i-2*a+o),g=.03*l-.06*n,f=.006*(3*(a-o)-i+h),p=.018*(n-l+.33333333),x=2*m+f,w=2*g+p,b=.3*(a-i)+m+.16666667*f,y=.3*n+g+.16666667*p,v=i+b,k=y;for(let t=u+18;u<t;u+=2)d[u]=v,d[u+1]=k,b+=x,y+=w,x+=f,w+=p,v+=b,k+=y}getCurvePercent(t,e){let s=this.curves,i=s[e];switch(i){case 0:let s=this.frames[e];return(t-s)/(this.frames[e+this.getFrameEntries()]-s);case 1:return 0}if(i-=2,s[i]>t){let r=this.frames[e];return s[i+1]*(t-r)/(s[i]-r)}let r=i+18;for(i+=2;i<r;i+=2)if(s[i]>=t){let e=s[i-2],r=s[i-1];return r+(t-e)/(s[i]-e)*(s[i+1]-r)}let a=s[r-2],n=s[r-1];return n+(1-n)*(t-a)/(this.frames[e+this.getFrameEntries()]-a)}apply(t,e,s,r,a,n,l){let h=t.slots[this.slotIndex];if(!h.bone.active)return;let c=h.getAttachment();if(!c)return;if(!(c instanceof o)||c.timelineAttachment!=this.attachment)return;let d=h.deform;0==d.length&&(n=u.setup);let m=this.vertices,g=m[0].length,f=this.frames;if(s<f[0]){switch(n){case u.setup:return void(d.length=0);case u.first:if(1==a)return void(d.length=0);d.length=g;let t=c;if(t.bones){a=1-a;for(p=0;p<g;p++)d[p]*=a}else{let e=t.vertices;for(var p=0;p<g;p++)d[p]+=(e[p]-d[p])*a}}return}if(d.length=g,s>=f[f.length-1]){let t=m[f.length-1];if(1==a)if(n==u.add){let e=c;if(e.bones)for(let e=0;e<g;e++)d[e]+=t[e];else{let s=e.vertices;for(let e=0;e<g;e++)d[e]+=t[e]-s[e]}}else i.arrayCopy(t,0,d,0,g);else switch(n){case u.setup:{let e=c;if(e.bones)for(let e=0;e<g;e++)d[e]=t[e]*a;else{let s=e.vertices;for(let e=0;e<g;e++){let i=s[e];d[e]=i+(t[e]-i)*a}}break}case u.first:case u.replace:for(let e=0;e<g;e++)d[e]+=(t[e]-d[e])*a;break;case u.add:let e=c;if(e.bones)for(let e=0;e<g;e++)d[e]+=t[e]*a;else{let s=e.vertices;for(let e=0;e<g;e++)d[e]+=(t[e]-s[e])*a}}return}let x=L.search1(f,s),w=this.getCurvePercent(s,x),b=m[x],y=m[x+1];if(1==a)if(n==u.add){let t=c;if(t.bones)for(let t=0;t<g;t++){let e=b[t];d[t]+=e+(y[t]-e)*w}else{let e=t.vertices;for(let t=0;t<g;t++){let s=b[t];d[t]+=s+(y[t]-s)*w-e[t]}}}else for(let t=0;t<g;t++){let e=b[t];d[t]=e+(y[t]-e)*w}else switch(n){case u.setup:{let t=c;if(t.bones)for(let t=0;t<g;t++){let e=b[t];d[t]=(e+(y[t]-e)*w)*a}else{let e=t.vertices;for(let t=0;t<g;t++){let s=b[t],i=e[t];d[t]=i+(s+(y[t]-s)*w-i)*a}}break}case u.first:case u.replace:for(let t=0;t<g;t++){let e=b[t];d[t]+=(e+(y[t]-e)*w-d[t])*a}break;case u.add:let t=c;if(t.bones)for(let t=0;t<g;t++){let e=b[t];d[t]+=(e+(y[t]-e)*w)*a}else{let e=t.vertices;for(let t=0;t<g;t++){let s=b[t];d[t]+=(s+(y[t]-s)*w-e[t])*a}}}}}class et extends L{static propertyIds=[""+C];events;constructor(t){super(t,et.propertyIds),this.events=new Array(t)}getFrameCount(){return this.frames.length}setFrame(t,e){this.frames[t]=e.time,this.events[t]=e}apply(t,e,s,i,r,a,n){if(!i)return;let o=this.frames,l=this.frames.length;if(e>s)this.apply(t,e,Number.MAX_VALUE,i,r,a,n),e=-1;else if(e>=o[l-1])return;if(s<o[0])return;let h=0;if(e<o[0])h=0;else{h=L.search1(o,e)+1;let t=o[h];for(;h>0&&o[h-1]==t;)h--}for(;h<l&&s>=o[h];h++)i.push(this.events[h])}}class st extends L{static propertyIds=[""+M];drawOrders;constructor(t){super(t,st.propertyIds),this.drawOrders=new Array(t)}getFrameCount(){return this.frames.length}setFrame(t,e,s){this.frames[t]=e,this.drawOrders[t]=s}apply(t,e,s,r,a,n,o){if(o==m.mixOut)return void(n==u.setup&&i.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length));if(s<this.frames[0])return void(n!=u.setup&&n!=u.first||i.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length));let l=L.search1(this.frames,s),h=this.drawOrders[l];if(h){let e=t.drawOrder,s=t.slots;for(let t=0,i=h.length;t<i;t++)e[t]=s[h[t]]}else i.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length)}}class it extends X{ikConstraintIndex=0;constructor(t,e,s){super(t,e,[R+"|"+s]),this.ikConstraintIndex=s}getFrameEntries(){return 6}setFrame(t,e,s,i,r,a,n){t*=6,this.frames[t]=e,this.frames[t+1]=s,this.frames[t+2]=i,this.frames[t+3]=r,this.frames[t+4]=a?1:0,this.frames[t+5]=n?1:0}apply(t,e,s,i,r,a,n){let o=t.ikConstraints[this.ikConstraintIndex];if(!o.active)return;let l=this.frames;if(s<l[0]){switch(a){case u.setup:return o.mix=o.data.mix,o.softness=o.data.softness,o.bendDirection=o.data.bendDirection,o.compress=o.data.compress,void(o.stretch=o.data.stretch);case u.first:o.mix+=(o.data.mix-o.mix)*r,o.softness+=(o.data.softness-o.softness)*r,o.bendDirection=o.data.bendDirection,o.compress=o.data.compress,o.stretch=o.data.stretch}return}let h=0,c=0,d=L.search(l,s,6),g=this.curves[d/6];switch(g){case 0:let t=l[d];h=l[d+1],c=l[d+2];let e=(s-t)/(l[d+6]-t);h+=(l[d+6+1]-h)*e,c+=(l[d+6+2]-c)*e;break;case 1:h=l[d+1],c=l[d+2];break;default:h=this.getBezierValue(s,d,1,g-2),c=this.getBezierValue(s,d,2,g+18-2)}a==u.setup?(o.mix=o.data.mix+(h-o.data.mix)*r,o.softness=o.data.softness+(c-o.data.softness)*r,n==m.mixOut?(o.bendDirection=o.data.bendDirection,o.compress=o.data.compress,o.stretch=o.data.stretch):(o.bendDirection=l[d+3],o.compress=0!=l[d+4],o.stretch=0!=l[d+5])):(o.mix+=(h-o.mix)*r,o.softness+=(c-o.softness)*r,n==m.mixIn&&(o.bendDirection=l[d+3],o.compress=0!=l[d+4],o.stretch=0!=l[d+5]))}}class rt extends X{transformConstraintIndex=0;constructor(t,e,s){super(t,e,[T+"|"+s]),this.transformConstraintIndex=s}getFrameEntries(){return 7}setFrame(t,e,s,i,r,a,n,o){let l=this.frames;l[t*=7]=e,l[t+1]=s,l[t+2]=i,l[t+3]=r,l[t+4]=a,l[t+5]=n,l[t+6]=o}apply(t,e,s,i,r,a,n){let o=t.transformConstraints[this.transformConstraintIndex];if(!o.active)return;let l,h,c,d,m,g,f=this.frames;if(s<f[0]){let t=o.data;switch(a){case u.setup:return o.mixRotate=t.mixRotate,o.mixX=t.mixX,o.mixY=t.mixY,o.mixScaleX=t.mixScaleX,o.mixScaleY=t.mixScaleY,void(o.mixShearY=t.mixShearY);case u.first:o.mixRotate+=(t.mixRotate-o.mixRotate)*r,o.mixX+=(t.mixX-o.mixX)*r,o.mixY+=(t.mixY-o.mixY)*r,o.mixScaleX+=(t.mixScaleX-o.mixScaleX)*r,o.mixScaleY+=(t.mixScaleY-o.mixScaleY)*r,o.mixShearY+=(t.mixShearY-o.mixShearY)*r}return}let p=L.search(f,s,7),x=this.curves[p/7];switch(x){case 0:let t=f[p];l=f[p+1],h=f[p+2],c=f[p+3],d=f[p+4],m=f[p+5],g=f[p+6];let e=(s-t)/(f[p+7]-t);l+=(f[p+7+1]-l)*e,h+=(f[p+7+2]-h)*e,c+=(f[p+7+3]-c)*e,d+=(f[p+7+4]-d)*e,m+=(f[p+7+5]-m)*e,g+=(f[p+7+6]-g)*e;break;case 1:l=f[p+1],h=f[p+2],c=f[p+3],d=f[p+4],m=f[p+5],g=f[p+6];break;default:l=this.getBezierValue(s,p,1,x-2),h=this.getBezierValue(s,p,2,x+18-2),c=this.getBezierValue(s,p,3,x+36-2),d=this.getBezierValue(s,p,4,x+54-2),m=this.getBezierValue(s,p,5,x+72-2),g=this.getBezierValue(s,p,6,x+90-2)}if(a==u.setup){let t=o.data;o.mixRotate=t.mixRotate+(l-t.mixRotate)*r,o.mixX=t.mixX+(h-t.mixX)*r,o.mixY=t.mixY+(c-t.mixY)*r,o.mixScaleX=t.mixScaleX+(d-t.mixScaleX)*r,o.mixScaleY=t.mixScaleY+(m-t.mixScaleY)*r,o.mixShearY=t.mixShearY+(g-t.mixShearY)*r}else o.mixRotate+=(l-o.mixRotate)*r,o.mixX+=(h-o.mixX)*r,o.mixY+=(c-o.mixY)*r,o.mixScaleX+=(d-o.mixScaleX)*r,o.mixScaleY+=(m-o.mixScaleY)*r,o.mixShearY+=(g-o.mixShearY)*r}}class at extends B{pathConstraintIndex=0;constructor(t,e,s){super(t,e,E+"|"+s),this.pathConstraintIndex=s}apply(t,e,s,i,r,a,n){let o=t.pathConstraints[this.pathConstraintIndex];if(!o.active)return;if(s<this.frames[0]){switch(a){case u.setup:return void(o.position=o.data.position);case u.first:o.position+=(o.data.position-o.position)*r}return}let l=this.getCurveValue(s);a==u.setup?o.position=o.data.position+(l-o.data.position)*r:o.position+=(l-o.position)*r}}class nt extends B{pathConstraintIndex=0;constructor(t,e,s){super(t,e,F+"|"+s),this.pathConstraintIndex=s}apply(t,e,s,i,r,a,n){let o=t.pathConstraints[this.pathConstraintIndex];if(!o.active)return;if(s<this.frames[0]){switch(a){case u.setup:return void(o.spacing=o.data.spacing);case u.first:o.spacing+=(o.data.spacing-o.spacing)*r}return}let l=this.getCurveValue(s);a==u.setup?o.spacing=o.data.spacing+(l-o.data.spacing)*r:o.spacing+=(l-o.spacing)*r}}class ot extends X{pathConstraintIndex=0;constructor(t,e,s){super(t,e,[Y+"|"+s]),this.pathConstraintIndex=s}getFrameEntries(){return 4}setFrame(t,e,s,i,r){let a=this.frames;a[t<<=2]=e,a[t+1]=s,a[t+2]=i,a[t+3]=r}apply(t,e,s,i,r,a,n){let o=t.pathConstraints[this.pathConstraintIndex];if(!o.active)return;let l,h,c,d=this.frames;if(s<d[0]){switch(a){case u.setup:return o.mixRotate=o.data.mixRotate,o.mixX=o.data.mixX,void(o.mixY=o.data.mixY);case u.first:o.mixRotate+=(o.data.mixRotate-o.mixRotate)*r,o.mixX+=(o.data.mixX-o.mixX)*r,o.mixY+=(o.data.mixY-o.mixY)*r}return}let m=L.search(d,s,4),g=this.curves[m>>2];switch(g){case 0:let t=d[m];l=d[m+1],h=d[m+2],c=d[m+3];let e=(s-t)/(d[m+4]-t);l+=(d[m+4+1]-l)*e,h+=(d[m+4+2]-h)*e,c+=(d[m+4+3]-c)*e;break;case 1:l=d[m+1],h=d[m+2],c=d[m+3];break;default:l=this.getBezierValue(s,m,1,g-2),h=this.getBezierValue(s,m,2,g+18-2),c=this.getBezierValue(s,m,3,g+36-2)}if(a==u.setup){let t=o.data;o.mixRotate=t.mixRotate+(l-t.mixRotate)*r,o.mixX=t.mixX+(h-t.mixX)*r,o.mixY=t.mixY+(c-t.mixY)*r}else o.mixRotate+=(l-o.mixRotate)*r,o.mixX+=(h-o.mixX)*r,o.mixY+=(c-o.mixY)*r}}class lt extends L{static ENTRIES=3;static MODE=1;static DELAY=2;slotIndex;attachment;constructor(t,e,s){super(t,[P+"|"+e+"|"+s.sequence.id]),this.slotIndex=e,this.attachment=s}getFrameEntries(){return lt.ENTRIES}getSlotIndex(){return this.slotIndex}getAttachment(){return this.attachment}setFrame(t,e,s,i,r){let a=this.frames;a[t*=lt.ENTRIES]=e,a[t+lt.MODE]=s|i<<4,a[t+lt.DELAY]=r}apply(t,e,s,i,r,a,n){let l=t.slots[this.slotIndex];if(!l.bone.active)return;let d=l.attachment,m=this.attachment;if(!(d==m||d instanceof o&&d.timelineAttachment==m))return;let g=this.frames;if(s<g[0])return void(a!=u.setup&&a!=u.first||(l.sequenceIndex=-1));let f=L.search(g,s,lt.ENTRIES),p=g[f],x=g[f+lt.MODE],w=g[f+lt.DELAY];if(!this.attachment.sequence)return;let b=x>>4,y=this.attachment.sequence.regions.length,v=c[15&x];if(v!=h.hold)switch(b+=(s-p)/w+1e-5|0,v){case h.once:b=Math.min(y-1,b);break;case h.loop:b%=y;break;case h.pingpong:{let t=(y<<1)-2;b=0==t?0:b%t,b>=y&&(b=t-b);break}case h.onceReverse:b=Math.max(y-1-b,0);break;case h.loopReverse:b=y-1-b%y;break;case h.pingpongReverse:{let t=(y<<1)-2;b=0==t?0:(b+y-1)%t,b>=y&&(b=t-b)}}l.sequenceIndex=b}}class ht{static _emptyAnimation=new d("<empty>",[],0);static emptyAnimation(){return ht._emptyAnimation}data;tracks=new Array;timeScale=1;unkeyedState=0;events=new Array;listeners=new Array;queue=new dt(this);propertyIDs=new t;animationsChanged=!1;trackEntryPool=new r((()=>new ct));constructor(t){this.data=t}update(t){t*=this.timeScale;let e=this.tracks;for(let s=0,i=e.length;s<i;s++){let i=e[s];if(!i)continue;i.animationLast=i.nextAnimationLast,i.trackLast=i.nextTrackLast;let r=t*i.timeScale;if(i.delay>0){if(i.delay-=r,i.delay>0)continue;r=-i.delay,i.delay=0}let a=i.next;if(a){let e=i.trackLast-a.delay;if(e>=0){for(a.delay=0,a.trackTime+=0==i.timeScale?0:(e/i.timeScale+t)*a.timeScale,i.trackTime+=r,this.setCurrent(s,a,!0);a.mixingFrom;)a.mixTime+=t,a=a.mixingFrom;continue}}else if(i.trackLast>=i.trackEnd&&!i.mixingFrom){e[s]=null,this.queue.end(i),this.clearNext(i);continue}if(i.mixingFrom&&this.updateMixingFrom(i,t)){let t=i.mixingFrom;for(i.mixingFrom=null,t&&(t.mixingTo=null);t;)this.queue.end(t),t=t.mixingFrom}i.trackTime+=r}this.queue.drain()}updateMixingFrom(t,e){let s=t.mixingFrom;if(!s)return!0;let i=this.updateMixingFrom(s,e);return s.animationLast=s.nextAnimationLast,s.trackLast=s.nextTrackLast,t.mixTime>0&&t.mixTime>=t.mixDuration?(0!=s.totalAlpha&&0!=t.mixDuration||(t.mixingFrom=s.mixingFrom,s.mixingFrom&&(s.mixingFrom.mixingTo=t),t.interruptAlpha=s.interruptAlpha,this.queue.end(s)),i):(s.trackTime+=e*s.timeScale,t.mixTime+=e,!1)}apply(t){if(!t)throw new Error("skeleton cannot be null.");this.animationsChanged&&this._animationsChanged();let e=this.events,s=this.tracks,r=!1;for(let n=0,o=s.length;n<o;n++){let o=s[n];if(!o||o.delay>0)continue;r=!0;let l=0==n?u.first:o.mixBlend,h=o.alpha;o.mixingFrom?h*=this.applyMixingFrom(o,t,l):o.trackTime>=o.trackEnd&&!o.next&&(h=0);let c=o.animationLast,d=o.getAnimationTime(),g=d,f=e;o.reverse&&(g=o.animation.duration-g,f=null);let p=o.animation.timelines,x=p.length;if(0==n&&1==h||l==u.add)for(let e=0;e<x;e++){i.webkit602BugfixHelper(h,l);var a=p[e];a instanceof Z?this.applyAttachmentTimeline(a,t,g,l,!0):a.apply(t,c,g,f,h,l,m.mixIn)}else{let e=o.timelineMode,s=o.shortestRotation,r=!s&&o.timelinesRotation.length!=x<<1;r&&(o.timelinesRotation.length=x<<1);for(let a=0;a<x;a++){let n=p[a],d=e[a]==mt?l:u.setup;!s&&n instanceof V?this.applyRotateTimeline(n,t,g,h,d,o.timelinesRotation,a<<1,r):n instanceof Z?this.applyAttachmentTimeline(n,t,g,l,!0):(i.webkit602BugfixHelper(h,l),n.apply(t,c,g,f,h,d,m.mixIn))}}this.queueEvents(o,d),e.length=0,o.nextAnimationLast=d,o.nextTrackLast=o.trackTime}for(var n=this.unkeyedState+wt,o=t.slots,l=0,h=t.slots.length;l<h;l++){var c=o[l];if(c.attachmentState==n){var d=c.data.attachmentName;c.setAttachment(d?t.getAttachment(c.data.index,d):null)}}return this.unkeyedState+=2,this.queue.drain(),r}applyMixingFrom(t,e,s){let r=t.mixingFrom;r.mixingFrom&&this.applyMixingFrom(r,e,s);let a=0;0==t.mixDuration?(a=1,s==u.first&&(s=u.setup)):(a=t.mixTime/t.mixDuration,a>1&&(a=1),s!=u.first&&(s=r.mixBlend));let n=a<r.attachmentThreshold,o=a<r.drawOrderThreshold,l=r.animation.timelines,h=l.length,c=r.alpha*t.interruptAlpha,d=c*(1-a),g=r.animationLast,f=r.getAnimationTime(),p=f,x=null;if(r.reverse?p=r.animation.duration-p:a<r.eventThreshold&&(x=this.events),s==u.add)for(let t=0;t<h;t++)l[t].apply(e,g,p,x,d,s,m.mixOut);else{let t=r.timelineMode,a=r.timelineHoldMix,f=r.shortestRotation,w=!f&&r.timelinesRotation.length!=h<<1;w&&(r.timelinesRotation.length=h<<1),r.totalAlpha=0;for(let b=0;b<h;b++){let h,y=l[b],v=m.mixOut,k=0;switch(t[b]){case mt:if(!o&&y instanceof st)continue;h=s,k=d;break;case gt:h=u.setup,k=d;break;case ft:h=s,k=c;break;case pt:h=u.setup,k=c;break;default:h=u.setup;let t=a[b];k=c*Math.max(0,1-t.mixTime/t.mixDuration)}r.totalAlpha+=k,!f&&y instanceof V?this.applyRotateTimeline(y,e,p,k,h,r.timelinesRotation,b<<1,w):y instanceof Z?this.applyAttachmentTimeline(y,e,p,h,n):(i.webkit602BugfixHelper(k,s),o&&y instanceof st&&h==u.setup&&(v=m.mixIn),y.apply(e,g,p,x,k,h,v))}}return t.mixDuration>0&&this.queueEvents(r,f),this.events.length=0,r.nextAnimationLast=f,r.nextTrackLast=r.trackTime,a}applyAttachmentTimeline(t,e,s,i,r){var a=e.slots[t.slotIndex];a.bone.active&&(s<t.frames[0]?i!=u.setup&&i!=u.first||this.setAttachment(e,a,a.data.attachmentName,r):this.setAttachment(e,a,t.attachmentNames[L.search1(t.frames,s)],r),a.attachmentState<=this.unkeyedState&&(a.attachmentState=this.unkeyedState+wt))}setAttachment(t,e,s,i){e.setAttachment(s?t.getAttachment(e.data.index,s):null),i&&(e.attachmentState=this.unkeyedState+bt)}applyRotateTimeline(t,e,i,r,a,n,o,l){if(l&&(n[o]=0),1==r)return void t.apply(e,0,i,null,1,a,m.mixIn);let h=e.bones[t.boneIndex];if(!h.active)return;let c=0,d=0;if(i<t.frames[0])switch(a){case u.setup:h.rotation=h.data.rotation;default:return;case u.first:c=h.rotation,d=h.data.rotation}else c=a==u.setup?h.data.rotation:h.rotation,d=h.data.rotation+t.getCurveValue(i);let g=0,f=d-c;if(f-=360*(16384-(16384.499999999996-f/360|0)),0==f)g=n[o];else{let t=0,e=0;l?(t=0,e=f):(t=n[o],e=n[o+1]);let i=f>0,r=t>=0;s.signum(e)!=s.signum(f)&&Math.abs(e)<=90&&(Math.abs(t)>180&&(t+=360*s.signum(t)),r=i),g=f+t-t%360,r!=i&&(g+=360*s.signum(t)),n[o]=g}n[o+1]=f,h.rotation=c+g*r}queueEvents(t,e){let s=t.animationStart,i=t.animationEnd,r=i-s,a=t.trackLast%r,n=this.events,o=0,l=n.length;for(;o<l;o++){let e=n[o];if(e.time<a)break;e.time>i||this.queue.event(t,e)}let h=!1;for(h=t.loop?0==r||a>t.trackTime%r:e>=i&&t.animationLast<i,h&&this.queue.complete(t);o<l;o++){let e=n[o];e.time<s||this.queue.event(t,e)}}clearTracks(){let t=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(let t=0,e=this.tracks.length;t<e;t++)this.clearTrack(t);this.tracks.length=0,this.queue.drainDisabled=t,this.queue.drain()}clearTrack(t){if(t>=this.tracks.length)return;let e=this.tracks[t];if(!e)return;this.queue.end(e),this.clearNext(e);let s=e;for(;;){let t=s.mixingFrom;if(!t)break;this.queue.end(t),s.mixingFrom=null,s.mixingTo=null,s=t}this.tracks[e.trackIndex]=null,this.queue.drain()}setCurrent(t,e,s){let i=this.expandToIndex(t);this.tracks[t]=e,e.previous=null,i&&(s&&this.queue.interrupt(i),e.mixingFrom=i,i.mixingTo=e,e.mixTime=0,i.mixingFrom&&i.mixDuration>0&&(e.interruptAlpha*=Math.min(1,i.mixTime/i.mixDuration)),i.timelinesRotation.length=0),this.queue.start(e)}setAnimation(t,e,s=!1){let i=this.data.skeletonData.findAnimation(e);if(!i)throw new Error("Animation not found: "+e);return this.setAnimationWith(t,i,s)}setAnimationWith(t,e,s=!1){if(!e)throw new Error("animation cannot be null.");let i=!0,r=this.expandToIndex(t);r&&(-1==r.nextTrackLast?(this.tracks[t]=r.mixingFrom,this.queue.interrupt(r),this.queue.end(r),this.clearNext(r),r=r.mixingFrom,i=!1):this.clearNext(r));let a=this.trackEntry(t,e,s,r);return this.setCurrent(t,a,i),this.queue.drain(),a}addAnimation(t,e,s=!1,i=0){let r=this.data.skeletonData.findAnimation(e);if(!r)throw new Error("Animation not found: "+e);return this.addAnimationWith(t,r,s,i)}addAnimationWith(t,e,s=!1,i=0){if(!e)throw new Error("animation cannot be null.");let r=this.expandToIndex(t);if(r)for(;r.next;)r=r.next;let a=this.trackEntry(t,e,s,r);return r?(r.next=a,a.previous=r,i<=0&&(i+=r.getTrackComplete()-a.mixDuration)):(this.setCurrent(t,a,!0),this.queue.drain()),a.delay=i,a}setEmptyAnimation(t,e=0){let s=this.setAnimationWith(t,ht.emptyAnimation(),!1);return s.mixDuration=e,s.trackEnd=e,s}addEmptyAnimation(t,e=0,s=0){let i=this.addAnimationWith(t,ht.emptyAnimation(),!1,s);return s<=0&&(i.delay+=i.mixDuration-e),i.mixDuration=e,i.trackEnd=e,i}setEmptyAnimations(t=0){let e=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(let e=0,s=this.tracks.length;e<s;e++){let s=this.tracks[e];s&&this.setEmptyAnimation(s.trackIndex,t)}this.queue.drainDisabled=e,this.queue.drain()}expandToIndex(t){return t<this.tracks.length?this.tracks[t]:(i.ensureArrayCapacity(this.tracks,t+1,null),this.tracks.length=t+1,null)}trackEntry(t,e,s,i){let r=this.trackEntryPool.obtain();return r.reset(),r.trackIndex=t,r.animation=e,r.loop=s,r.holdPrevious=!1,r.reverse=!1,r.shortestRotation=!1,r.eventThreshold=0,r.attachmentThreshold=0,r.drawOrderThreshold=0,r.animationStart=0,r.animationEnd=e.duration,r.animationLast=-1,r.nextAnimationLast=-1,r.delay=0,r.trackTime=0,r.trackLast=-1,r.nextTrackLast=-1,r.trackEnd=Number.MAX_VALUE,r.timeScale=1,r.alpha=1,r.mixTime=0,r.mixDuration=i?this.data.getMix(i.animation,e):0,r.interruptAlpha=1,r.totalAlpha=0,r.mixBlend=u.replace,r}clearNext(t){let e=t.next;for(;e;)this.queue.dispose(e),e=e.next;t.next=null}_animationsChanged(){this.animationsChanged=!1,this.propertyIDs.clear();let t=this.tracks;for(let e=0,s=t.length;e<s;e++){let s=t[e];if(s){for(;s.mixingFrom;)s=s.mixingFrom;do{s.mixingTo&&s.mixBlend==u.add||this.computeHold(s),s=s.mixingTo}while(s)}}}computeHold(t){let e=t.mixingTo,s=t.animation.timelines,i=t.animation.timelines.length,r=t.timelineMode;r.length=i;let a=t.timelineHoldMix;a.length=0;let n=this.propertyIDs;if(e&&e.holdPrevious)for(let t=0;t<i;t++)r[t]=n.addAll(s[t].getPropertyIds())?pt:ft;else t:for(let o=0;o<i;o++){let i=s[o],l=i.getPropertyIds();if(n.addAll(l))if(!e||i instanceof Z||i instanceof st||i instanceof et||!e.animation.hasTimeline(l))r[o]=gt;else{for(let s=e.mixingTo;s;s=s.mixingTo)if(!s.animation.hasTimeline(l)){if(t.mixDuration>0){r[o]=xt,a[o]=s;continue t}break}r[o]=pt}else r[o]=mt}}getCurrent(t){return t>=this.tracks.length?null:this.tracks[t]}addListener(t){if(!t)throw new Error("listener cannot be null.");this.listeners.push(t)}removeListener(t){let e=this.listeners.indexOf(t);e>=0&&this.listeners.splice(e,1)}clearListeners(){this.listeners.length=0}clearListenerNotifications(){this.queue.clear()}}class ct{animation=null;previous=null;next=null;mixingFrom=null;mixingTo=null;listener=null;trackIndex=0;loop=!1;holdPrevious=!1;reverse=!1;shortestRotation=!1;eventThreshold=0;attachmentThreshold=0;drawOrderThreshold=0;animationStart=0;animationEnd=0;animationLast=0;nextAnimationLast=0;delay=0;trackTime=0;trackLast=0;nextTrackLast=0;trackEnd=0;timeScale=0;alpha=0;mixTime=0;mixDuration=0;interruptAlpha=0;totalAlpha=0;mixBlend=u.replace;timelineMode=new Array;timelineHoldMix=new Array;timelinesRotation=new Array;reset(){this.next=null,this.previous=null,this.mixingFrom=null,this.mixingTo=null,this.animation=null,this.listener=null,this.timelineMode.length=0,this.timelineHoldMix.length=0,this.timelinesRotation.length=0}getAnimationTime(){if(this.loop){let t=this.animationEnd-this.animationStart;return 0==t?this.animationStart:this.trackTime%t+this.animationStart}return Math.min(this.trackTime+this.animationStart,this.animationEnd)}setAnimationLast(t){this.animationLast=t,this.nextAnimationLast=t}isComplete(){return this.trackTime>=this.animationEnd-this.animationStart}resetRotationDirections(){this.timelinesRotation.length=0}getTrackComplete(){let t=this.animationEnd-this.animationStart;if(0!=t){if(this.loop)return t*(1+(this.trackTime/t|0));if(this.trackTime<t)return t}return this.trackTime}}class dt{objects=[];drainDisabled=!1;animState;constructor(t){this.animState=t}start(t){this.objects.push(ut.start),this.objects.push(t),this.animState.animationsChanged=!0}interrupt(t){this.objects.push(ut.interrupt),this.objects.push(t)}end(t){this.objects.push(ut.end),this.objects.push(t),this.animState.animationsChanged=!0}dispose(t){this.objects.push(ut.dispose),this.objects.push(t)}complete(t){this.objects.push(ut.complete),this.objects.push(t)}event(t,e){this.objects.push(ut.event),this.objects.push(t),this.objects.push(e)}drain(){if(this.drainDisabled)return;this.drainDisabled=!0;let t=this.objects,e=this.animState.listeners;for(let s=0;s<t.length;s+=2){let i=t[s],r=t[s+1];switch(i){case ut.start:r.listener&&r.listener.start&&r.listener.start(r);for(let t=0;t<e.length;t++){let s=e[t];s.start&&s.start(r)}break;case ut.interrupt:r.listener&&r.listener.interrupt&&r.listener.interrupt(r);for(let t=0;t<e.length;t++){let s=e[t];s.interrupt&&s.interrupt(r)}break;case ut.end:r.listener&&r.listener.end&&r.listener.end(r);for(let t=0;t<e.length;t++){let s=e[t];s.end&&s.end(r)}case ut.dispose:r.listener&&r.listener.dispose&&r.listener.dispose(r);for(let t=0;t<e.length;t++){let s=e[t];s.dispose&&s.dispose(r)}this.animState.trackEntryPool.free(r);break;case ut.complete:r.listener&&r.listener.complete&&r.listener.complete(r);for(let t=0;t<e.length;t++){let s=e[t];s.complete&&s.complete(r)}break;case ut.event:let i=t[2+s++];r.listener&&r.listener.event&&r.listener.event(r,i);for(let t=0;t<e.length;t++){let s=e[t];s.event&&s.event(r,i)}}}this.clear(),this.drainDisabled=!1}clear(){this.objects.length=0}}var ut;!function(t){t[t.start=0]="start",t[t.interrupt=1]="interrupt",t[t.end=2]="end",t[t.dispose=3]="dispose",t[t.complete=4]="complete",t[t.event=5]="event"}(ut||(ut={}));const mt=0,gt=1,ft=2,pt=3,xt=4,wt=1,bt=2;class yt{skeletonData;animationToMixTime={};defaultMix=0;constructor(t){if(!t)throw new Error("skeletonData cannot be null.");this.skeletonData=t}setMix(t,e,s){let i=this.skeletonData.findAnimation(t);if(!i)throw new Error("Animation not found: "+t);let r=this.skeletonData.findAnimation(e);if(!r)throw new Error("Animation not found: "+e);this.setMixWith(i,r,s)}setMixWith(t,e,s){if(!t)throw new Error("from cannot be null.");if(!e)throw new Error("to cannot be null.");let i=t.name+"."+e.name;this.animationToMixTime[i]=s}getMix(t,e){let s=t.name+"."+e.name,i=this.animationToMixTime[s];return void 0===i?this.defaultMix:i}}class vt extends o{color=new e(1,1,1,1);constructor(t){super(t)}copy(){let t=new vt(this.name);return this.copyTo(t),t.color.setFromColor(this.color),t}}class kt extends o{endSlot=null;color=new e(.2275,.2275,.8078,1);constructor(t){super(t)}copy(){let t=new kt(this.name);return this.copyTo(t),t.endSlot=this.endSlot,t.color.setFromColor(this.color),t}}class At{_image;constructor(t){this._image=t}getImage(){return this._image}}var St,It,Ct,Mt,Rt,Tt,Et,Ft;!function(t){t[t.Nearest=9728]="Nearest",t[t.Linear=9729]="Linear",t[t.MipMap=9987]="MipMap",t[t.MipMapNearestNearest=9984]="MipMapNearestNearest",t[t.MipMapLinearNearest=9985]="MipMapLinearNearest",t[t.MipMapNearestLinear=9986]="MipMapNearestLinear",t[t.MipMapLinearLinear=9987]="MipMapLinearLinear"}(St||(St={})),function(t){t[t.MirroredRepeat=33648]="MirroredRepeat",t[t.ClampToEdge=33071]="ClampToEdge",t[t.Repeat=10497]="Repeat"}(It||(It={}));class Yt{texture;u=0;v=0;u2=0;v2=0;width=0;height=0;degrees=0;offsetX=0;offsetY=0;originalWidth=0;originalHeight=0}class Pt{pages=new Array;regions=new Array;constructor(t){let e=new Lt(t),s=new Array(4),r={size:t=>{t.width=parseInt(s[1]),t.height=parseInt(s[2])},format:()=>{},filter:t=>{t.minFilter=i.enumValue(St,s[1]),t.magFilter=i.enumValue(St,s[2])},repeat:t=>{-1!=s[1].indexOf("x")&&(t.uWrap=It.Repeat),-1!=s[1].indexOf("y")&&(t.vWrap=It.Repeat)},pma:t=>{t.pma="true"==s[1]}};var a={xy:t=>{t.x=parseInt(s[1]),t.y=parseInt(s[2])},size:t=>{t.width=parseInt(s[1]),t.height=parseInt(s[2])},bounds:t=>{t.x=parseInt(s[1]),t.y=parseInt(s[2]),t.width=parseInt(s[3]),t.height=parseInt(s[4])},offset:t=>{t.offsetX=parseInt(s[1]),t.offsetY=parseInt(s[2])},orig:t=>{t.originalWidth=parseInt(s[1]),t.originalHeight=parseInt(s[2])},offsets:t=>{t.offsetX=parseInt(s[1]),t.offsetY=parseInt(s[2]),t.originalWidth=parseInt(s[3]),t.originalHeight=parseInt(s[4])},rotate:t=>{let e=s[1];"true"==e?t.degrees=90:"false"!=e&&(t.degrees=parseInt(e))},index:t=>{t.index=parseInt(s[1])}};let n=e.readLine();for(;n&&0==n.trim().length;)n=e.readLine();for(;n&&0!=n.trim().length&&0!=e.readEntry(s,n);)n=e.readLine();let o=null,l=null,h=null;for(;null!==n;)if(0==n.trim().length)o=null,n=e.readLine();else if(o){let t=new Bt(o,n);for(;;){let i=e.readEntry(s,n=e.readLine());if(0==i)break;let r=a[s[0]];if(r)r(t);else{l||(l=[]),h||(h=[]),l.push(s[0]);let t=[];for(let e=0;e<i;e++)t.push(parseInt(s[e+1]));h.push(t)}}0==t.originalWidth&&0==t.originalHeight&&(t.originalWidth=t.width,t.originalHeight=t.height),l&&l.length>0&&h&&h.length>0&&(t.names=l,t.values=h,l=null,h=null),t.u=t.x/o.width,t.v=t.y/o.height,90==t.degrees?(t.u2=(t.x+t.height)/o.width,t.v2=(t.y+t.width)/o.height):(t.u2=(t.x+t.width)/o.width,t.v2=(t.y+t.height)/o.height),this.regions.push(t)}else{for(o=new Xt(n.trim());0!=e.readEntry(s,n=e.readLine());){let t=r[s[0]];t&&t(o)}this.pages.push(o)}}findRegion(t){for(let e=0;e<this.regions.length;e++)if(this.regions[e].name==t)return this.regions[e];return null}setTextures(t,e=""){for(let s of this.pages)s.setTexture(t.get(e+s.name))}dispose(){for(let t=0;t<this.pages.length;t++)this.pages[t].texture?.dispose()}}class Lt{lines;index=0;constructor(t){this.lines=t.split(/\r\n|\r|\n/)}readLine(){return this.index>=this.lines.length?null:this.lines[this.index++]}readEntry(t,e){if(!e)return 0;if(0==(e=e.trim()).length)return 0;let s=e.indexOf(":");if(-1==s)return 0;t[0]=e.substr(0,s).trim();for(let i=1,r=s+1;;i++){let s=e.indexOf(",",r);if(-1==s)return t[i]=e.substr(r).trim(),i;if(t[i]=e.substr(r,s-r).trim(),r=s+1,4==i)return 4}}}class Xt{name;minFilter=St.Nearest;magFilter=St.Nearest;uWrap=It.ClampToEdge;vWrap=It.ClampToEdge;texture=null;width=0;height=0;pma=!1;regions=new Array;constructor(t){this.name=t}setTexture(t){this.texture=t,t.setFilters(this.minFilter,this.magFilter),t.setWraps(this.uWrap,this.vWrap);for(let e of this.regions)e.texture=t}}class Bt extends Yt{page;name;x=0;y=0;offsetX=0;offsetY=0;originalWidth=0;originalHeight=0;index=0;degrees=0;names=null;values=null;constructor(t,e){super(),this.page=t,this.name=e,t.regions.push(this)}}class _t extends o{region=null;path;regionUVs=[];uvs=[];triangles=[];color=new e(1,1,1,1);width=0;height=0;hullLength=0;edges=[];parentMesh=null;sequence=null;tempColor=new e(0,0,0,0);constructor(t,e){super(t),this.path=e}updateRegion(){if(!this.region)throw new Error("Region not set.");let t=this.regionUVs;this.uvs&&this.uvs.length==t.length||(this.uvs=i.newFloatArray(t.length));let e=this.uvs,s=this.uvs.length,r=this.region.u,a=this.region.v,n=0,o=0;if(this.region instanceof Bt){let i=this.region,l=i.page.texture.getImage(),h=l.width,c=l.height;switch(i.degrees){case 90:r-=(i.originalHeight-i.offsetY-i.height)/h,a-=(i.originalWidth-i.offsetX-i.width)/c,n=i.originalHeight/h,o=i.originalWidth/c;for(let i=0;i<s;i+=2)e[i]=r+t[i+1]*n,e[i+1]=a+(1-t[i])*o;return;case 180:r-=(i.originalWidth-i.offsetX-i.width)/h,a-=i.offsetY/c,n=i.originalWidth/h,o=i.originalHeight/c;for(let i=0;i<s;i+=2)e[i]=r+(1-t[i])*n,e[i+1]=a+(1-t[i+1])*o;return;case 270:r-=i.offsetY/h,a-=i.offsetX/c,n=i.originalHeight/h,o=i.originalWidth/c;for(let i=0;i<s;i+=2)e[i]=r+(1-t[i+1])*n,e[i+1]=a+t[i]*o;return}r-=i.offsetX/h,a-=(i.originalHeight-i.offsetY-i.height)/c,n=i.originalWidth/h,o=i.originalHeight/c}else this.region?(n=this.region.u2-r,o=this.region.v2-a):(r=a=0,n=o=1);for(let i=0;i<s;i+=2)e[i]=r+t[i]*n,e[i+1]=a+t[i+1]*o}getParentMesh(){return this.parentMesh}setParentMesh(t){this.parentMesh=t,t&&(this.bones=t.bones,this.vertices=t.vertices,this.worldVerticesLength=t.worldVerticesLength,this.regionUVs=t.regionUVs,this.triangles=t.triangles,this.hullLength=t.hullLength,this.worldVerticesLength=t.worldVerticesLength)}copy(){if(this.parentMesh)return this.newLinkedMesh();let t=new _t(this.name,this.path);return t.region=this.region,t.color.setFromColor(this.color),this.copyTo(t),t.regionUVs=new Array(this.regionUVs.length),i.arrayCopy(this.regionUVs,0,t.regionUVs,0,this.regionUVs.length),t.uvs=new Array(this.uvs.length),i.arrayCopy(this.uvs,0,t.uvs,0,this.uvs.length),t.triangles=new Array(this.triangles.length),i.arrayCopy(this.triangles,0,t.triangles,0,this.triangles.length),t.hullLength=this.hullLength,t.sequence=null!=this.sequence?this.sequence.copy():null,this.edges&&(t.edges=new Array(this.edges.length),i.arrayCopy(this.edges,0,t.edges,0,this.edges.length)),t.width=this.width,t.height=this.height,t}computeWorldVertices(t,e,s,i,r,a){null!=this.sequence&&this.sequence.apply(t,this),super.computeWorldVertices(t,e,s,i,r,a)}newLinkedMesh(){let t=new _t(this.name,this.path);return t.region=this.region,t.color.setFromColor(this.color),t.timelineAttachment=this.timelineAttachment,t.setParentMesh(this.parentMesh?this.parentMesh:this),null!=t.region&&t.updateRegion(),t}}class Vt extends o{lengths=[];closed=!1;constantSpeed=!1;color=new e(1,1,1,1);constructor(t){super(t)}copy(){let t=new Vt(this.name);return this.copyTo(t),t.lengths=new Array(this.lengths.length),i.arrayCopy(this.lengths,0,t.lengths,0,this.lengths.length),t.closed=closed,t.constantSpeed=this.constantSpeed,t.color.setFromColor(this.color),t}}class Dt extends o{x=0;y=0;rotation=0;color=new e(.38,.94,0,1);constructor(t){super(t)}computeWorldPosition(t,e){return e.x=this.x*t.a+this.y*t.b+t.worldX,e.y=this.x*t.c+this.y*t.d+t.worldY,e}computeWorldRotation(t){let e=s.cosDeg(this.rotation),i=s.sinDeg(this.rotation),r=e*t.a+i*t.b,a=e*t.c+i*t.d;return Math.atan2(a,r)*s.radDeg}copy(){let t=new Dt(this.name);return t.x=this.x,t.y=this.y,t.rotation=this.rotation,t.color.setFromColor(this.color),t}}class Nt extends n{x=0;y=0;scaleX=1;scaleY=1;rotation=0;width=0;height=0;color=new e(1,1,1,1);path;region=null;sequence=null;offset=i.newFloatArray(8);uvs=i.newFloatArray(8);tempColor=new e(1,1,1,1);constructor(t,e){super(t),this.path=e}updateRegion(){if(!this.region)throw new Error("Region not set.");let t=this.region,e=this.uvs;if(null==t)return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=1,e[5]=1,e[6]=1,void(e[7]=0);let s=this.width/this.region.originalWidth*this.scaleX,i=this.height/this.region.originalHeight*this.scaleY,r=-this.width/2*this.scaleX+this.region.offsetX*s,a=-this.height/2*this.scaleY+this.region.offsetY*i,n=r+this.region.width*s,o=a+this.region.height*i,l=this.rotation*Math.PI/180,h=Math.cos(l),c=Math.sin(l),d=this.x,u=this.y,m=r*h+d,g=r*c,f=a*h+u,p=a*c,x=n*h+d,w=n*c,b=o*h+u,y=o*c,v=this.offset;v[0]=m-p,v[1]=f+g,v[2]=m-y,v[3]=b+g,v[4]=x-y,v[5]=b+w,v[6]=x-p,v[7]=f+w,90==t.degrees?(e[0]=t.u2,e[1]=t.v2,e[2]=t.u,e[3]=t.v2,e[4]=t.u,e[5]=t.v,e[6]=t.u2,e[7]=t.v):(e[0]=t.u,e[1]=t.v2,e[2]=t.u,e[3]=t.v,e[4]=t.u2,e[5]=t.v,e[6]=t.u2,e[7]=t.v2)}computeWorldVertices(t,e,s,i){null!=this.sequence&&this.sequence.apply(t,this);let r=t.bone,a=this.offset,n=r.worldX,o=r.worldY,l=r.a,h=r.b,c=r.c,d=r.d,u=0,m=0;u=a[0],m=a[1],e[s]=u*l+m*h+n,e[s+1]=u*c+m*d+o,s+=i,u=a[2],m=a[3],e[s]=u*l+m*h+n,e[s+1]=u*c+m*d+o,s+=i,u=a[4],m=a[5],e[s]=u*l+m*h+n,e[s+1]=u*c+m*d+o,s+=i,u=a[6],m=a[7],e[s]=u*l+m*h+n,e[s+1]=u*c+m*d+o}copy(){let t=new Nt(this.name,this.path);return t.region=this.region,t.x=this.x,t.y=this.y,t.scaleX=this.scaleX,t.scaleY=this.scaleY,t.rotation=this.rotation,t.width=this.width,t.height=this.height,i.arrayCopy(this.uvs,0,t.uvs,0,8),i.arrayCopy(this.offset,0,t.offset,0,8),t.color.setFromColor(this.color),t.sequence=null!=this.sequence?this.sequence.copy():null,t}static X1=0;static Y1=1;static C1R=2;static C1G=3;static C1B=4;static C1A=5;static U1=6;static V1=7;static X2=8;static Y2=9;static C2R=10;static C2G=11;static C2B=12;static C2A=13;static U2=14;static V2=15;static X3=16;static Y3=17;static C3R=18;static C3G=19;static C3B=20;static C3A=21;static U3=22;static V3=23;static X4=24;static Y4=25;static C4R=26;static C4G=27;static C4B=28;static C4A=29;static U4=30;static V4=31}class Ut{atlas;constructor(t){this.atlas=t}loadSequence(t,e,s){let i=s.regions;for(let r=0,a=i.length;r<a;r++){let a=s.getPath(e,r),n=this.atlas.findRegion(a);if(null==n)throw new Error("Region not found in atlas: "+a+" (sequence: "+t+")");i[r]=n}}newRegionAttachment(t,e,s,i){let r=new Nt(e,s);if(null!=i)this.loadSequence(e,s,i);else{let t=this.atlas.findRegion(s);if(!t)throw new Error("Region not found in atlas: "+s+" (region attachment: "+e+")");r.region=t}return r}newMeshAttachment(t,e,s,i){let r=new _t(e,s);if(null!=i)this.loadSequence(e,s,i);else{let t=this.atlas.findRegion(s);if(!t)throw new Error("Region not found in atlas: "+s+" (mesh attachment: "+e+")");r.region=t}return r}newBoundingBoxAttachment(t,e){return new vt(e)}newPathAttachment(t,e){return new Vt(e)}newPointAttachment(t,e){return new Dt(e)}newClippingAttachment(t,e){return new kt(e)}}class Ot{index=0;name;parent=null;length=0;x=0;y=0;rotation=0;scaleX=1;scaleY=1;shearX=0;shearY=0;transformMode=Ct.Normal;skinRequired=!1;color=new e;constructor(t,e,s){if(t<0)throw new Error("index must be >= 0.");if(!e)throw new Error("name cannot be null.");this.index=t,this.name=e,this.parent=s}}!function(t){t[t.Normal=0]="Normal",t[t.OnlyTranslation=1]="OnlyTranslation",t[t.NoRotationOrReflection=2]="NoRotationOrReflection",t[t.NoScale=3]="NoScale",t[t.NoScaleOrReflection=4]="NoScaleOrReflection"}(Ct||(Ct={}));class Wt{data;skeleton;parent=null;children=new Array;x=0;y=0;rotation=0;scaleX=0;scaleY=0;shearX=0;shearY=0;ax=0;ay=0;arotation=0;ascaleX=0;ascaleY=0;ashearX=0;ashearY=0;a=0;b=0;c=0;d=0;worldY=0;worldX=0;sorted=!1;active=!1;constructor(t,e,s){if(!t)throw new Error("data cannot be null.");if(!e)throw new Error("skeleton cannot be null.");this.data=t,this.skeleton=e,this.parent=s,this.setToSetupPose()}isActive(){return this.active}update(){this.updateWorldTransformWith(this.ax,this.ay,this.arotation,this.ascaleX,this.ascaleY,this.ashearX,this.ashearY)}updateWorldTransform(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)}updateWorldTransformWith(t,e,i,r,a,n,o){this.ax=t,this.ay=e,this.arotation=i,this.ascaleX=r,this.ascaleY=a,this.ashearX=n,this.ashearY=o;let l=this.parent;if(!l){let l=this.skeleton,h=i+90+o,c=l.scaleX,d=l.scaleY;return this.a=s.cosDeg(i+n)*r*c,this.b=s.cosDeg(h)*a*c,this.c=s.sinDeg(i+n)*r*d,this.d=s.sinDeg(h)*a*d,this.worldX=t*c+l.x,void(this.worldY=e*d+l.y)}let h=l.a,c=l.b,d=l.c,u=l.d;switch(this.worldX=h*t+c*e+l.worldX,this.worldY=d*t+u*e+l.worldY,this.data.transformMode){case Ct.Normal:{let t=i+90+o,e=s.cosDeg(i+n)*r,l=s.cosDeg(t)*a,m=s.sinDeg(i+n)*r,g=s.sinDeg(t)*a;return this.a=h*e+c*m,this.b=h*l+c*g,this.c=d*e+u*m,void(this.d=d*l+u*g)}case Ct.OnlyTranslation:{let t=i+90+o;this.a=s.cosDeg(i+n)*r,this.b=s.cosDeg(t)*a,this.c=s.sinDeg(i+n)*r,this.d=s.sinDeg(t)*a;break}case Ct.NoRotationOrReflection:{let t=h*h+d*d,e=0;t>1e-4?(t=Math.abs(h*u-c*d)/t,h/=this.skeleton.scaleX,d/=this.skeleton.scaleY,c=d*t,u=h*t,e=Math.atan2(d,h)*s.radDeg):(h=0,d=0,e=90-Math.atan2(u,c)*s.radDeg);let l=i+n-e,m=i+o-e+90,g=s.cosDeg(l)*r,f=s.cosDeg(m)*a,p=s.sinDeg(l)*r,x=s.sinDeg(m)*a;this.a=h*g-c*p,this.b=h*f-c*x,this.c=d*g+u*p,this.d=d*f+u*x;break}case Ct.NoScale:case Ct.NoScaleOrReflection:{let t=s.cosDeg(i),e=s.sinDeg(i),l=(h*t+c*e)/this.skeleton.scaleX,m=(d*t+u*e)/this.skeleton.scaleY,g=Math.sqrt(l*l+m*m);g>1e-5&&(g=1/g),l*=g,m*=g,g=Math.sqrt(l*l+m*m),this.data.transformMode==Ct.NoScale&&h*u-c*d<0!=(this.skeleton.scaleX<0!=this.skeleton.scaleY<0)&&(g=-g);let f=Math.PI/2+Math.atan2(m,l),p=Math.cos(f)*g,x=Math.sin(f)*g,w=s.cosDeg(n)*r,b=s.cosDeg(90+o)*a,y=s.sinDeg(n)*r,v=s.sinDeg(90+o)*a;this.a=l*w+p*y,this.b=l*b+p*v,this.c=m*w+x*y,this.d=m*b+x*v;break}}this.a*=this.skeleton.scaleX,this.b*=this.skeleton.scaleX,this.c*=this.skeleton.scaleY,this.d*=this.skeleton.scaleY}setToSetupPose(){let t=this.data;this.x=t.x,this.y=t.y,this.rotation=t.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this.shearX=t.shearX,this.shearY=t.shearY}getWorldRotationX(){return Math.atan2(this.c,this.a)*s.radDeg}getWorldRotationY(){return Math.atan2(this.d,this.b)*s.radDeg}getWorldScaleX(){return Math.sqrt(this.a*this.a+this.c*this.c)}getWorldScaleY(){return Math.sqrt(this.b*this.b+this.d*this.d)}updateAppliedTransform(){let t=this.parent;if(!t)return this.ax=this.worldX-this.skeleton.x,this.ay=this.worldY-this.skeleton.y,this.arotation=Math.atan2(this.c,this.a)*s.radDeg,this.ascaleX=Math.sqrt(this.a*this.a+this.c*this.c),this.ascaleY=Math.sqrt(this.b*this.b+this.d*this.d),this.ashearX=0,void(this.ashearY=Math.atan2(this.a*this.b+this.c*this.d,this.a*this.d-this.b*this.c)*s.radDeg);let e=t.a,i=t.b,r=t.c,a=t.d,n=1/(e*a-i*r),o=this.worldX-t.worldX,l=this.worldY-t.worldY;this.ax=o*a*n-l*i*n,this.ay=l*e*n-o*r*n;let h=n*a,c=n*e,d=n*i,u=n*r,m=h*this.a-d*this.c,g=h*this.b-d*this.d,f=c*this.c-u*this.a,p=c*this.d-u*this.b;if(this.ashearX=0,this.ascaleX=Math.sqrt(m*m+f*f),this.ascaleX>1e-4){let t=m*p-g*f;this.ascaleY=t/this.ascaleX,this.ashearY=Math.atan2(m*g+f*p,t)*s.radDeg,this.arotation=Math.atan2(f,m)*s.radDeg}else this.ascaleX=0,this.ascaleY=Math.sqrt(g*g+p*p),this.ashearY=0,this.arotation=90-Math.atan2(p,g)*s.radDeg}worldToLocal(t){let e=1/(this.a*this.d-this.b*this.c),s=t.x-this.worldX,i=t.y-this.worldY;return t.x=s*this.d*e-i*this.b*e,t.y=i*this.a*e-s*this.c*e,t}localToWorld(t){let e=t.x,s=t.y;return t.x=e*this.a+s*this.b+this.worldX,t.y=e*this.c+s*this.d+this.worldY,t}worldToLocalRotation(t){let e=s.sinDeg(t),i=s.cosDeg(t);return Math.atan2(this.a*e-this.c*i,this.d*i-this.b*e)*s.radDeg+this.rotation-this.shearX}localToWorldRotation(t){t-=this.rotation-this.shearX;let e=s.sinDeg(t),i=s.cosDeg(t);return Math.atan2(i*this.c+e*this.d,i*this.a+e*this.b)*s.radDeg}rotateWorld(t){let e=this.a,i=this.b,r=this.c,a=this.d,n=s.cosDeg(t),o=s.sinDeg(t);this.a=n*e-o*r,this.b=n*i-o*a,this.c=o*e+n*r,this.d=o*i+n*a}}class zt{data;bones;target;bendDirection=0;compress=!1;stretch=!1;mix=1;softness=0;active=!1;constructor(t,e){if(!t)throw new Error("data cannot be null.");if(!e)throw new Error("skeleton cannot be null.");this.data=t,this.mix=t.mix,this.softness=t.softness,this.bendDirection=t.bendDirection,this.compress=t.compress,this.stretch=t.stretch,this.bones=new Array;for(let s=0;s<t.bones.length;s++){let i=e.findBone(t.bones[s].name);if(!i)throw new Error(`Couldn't find bone ${t.bones[s].name}`);this.bones.push(i)}let s=e.findBone(t.target.name);if(!s)throw new Error(`Couldn't find bone ${t.target.name}`);this.target=s}isActive(){return this.active}update(){if(0==this.mix)return;let t=this.target,e=this.bones;switch(e.length){case 1:this.apply1(e[0],t.worldX,t.worldY,this.compress,this.stretch,this.data.uniform,this.mix);break;case 2:this.apply2(e[0],e[1],t.worldX,t.worldY,this.bendDirection,this.stretch,this.data.uniform,this.softness,this.mix)}}apply1(t,e,i,r,a,n,o){let l=t.parent;if(!l)throw new Error("IK bone must have parent.");let h=l.a,c=l.b,d=l.c,u=l.d,m=-t.ashearX-t.arotation,g=0,f=0;switch(t.data.transformMode){case Ct.OnlyTranslation:g=(e-t.worldX)*s.signum(t.skeleton.scaleX),f=(i-t.worldY)*s.signum(t.skeleton.scaleY);break;case Ct.NoRotationOrReflection:let r=Math.abs(h*u-c*d)/Math.max(1e-4,h*h+d*d),a=h/t.skeleton.scaleX,n=d/t.skeleton.scaleY;c=-n*r*t.skeleton.scaleX,u=a*r*t.skeleton.scaleY,m+=Math.atan2(n,a)*s.radDeg;default:let o=e-l.worldX,p=i-l.worldY,x=h*u-c*d;Math.abs(x)<=1e-4?(g=0,f=0):(g=(o*u-p*c)/x-t.ax,f=(p*h-o*d)/x-t.ay)}m+=Math.atan2(f,g)*s.radDeg,t.ascaleX<0&&(m+=180),m>180?m-=360:m<-180&&(m+=360);let p=t.ascaleX,x=t.ascaleY;if(r||a){switch(t.data.transformMode){case Ct.NoScale:case Ct.NoScaleOrReflection:g=e-t.worldX,f=i-t.worldY}let s=t.data.length*p,l=Math.sqrt(g*g+f*f);if(r&&l<s||a&&l>s&&s>1e-4){let t=(l/s-1)*o+1;p*=t,n&&(x*=t)}}t.updateWorldTransformWith(t.ax,t.ay,t.arotation+m*o,p,x,t.ashearX,t.ashearY)}apply2(t,e,i,r,a,n,o,l,h){let c=t.ax,d=t.ay,u=t.ascaleX,m=t.ascaleY,g=u,f=m,p=e.ascaleX,x=0,w=0,b=0;u<0?(u=-u,x=180,b=-1):(x=0,b=1),m<0&&(m=-m,b=-b),p<0?(p=-p,w=180):w=0;let y=e.ax,v=0,k=0,A=0,S=t.a,I=t.b,C=t.c,M=t.d,R=Math.abs(u-m)<=1e-4;!R||n?(v=0,k=S*y+t.worldX,A=C*y+t.worldY):(v=e.ay,k=S*y+I*v+t.worldX,A=C*y+M*v+t.worldY);let T=t.parent;if(!T)throw new Error("IK parent must itself have a parent.");S=T.a,I=T.b,C=T.c,M=T.d;let E=S*M-I*C,F=k-T.worldX,Y=A-T.worldY;E=Math.abs(E)<=1e-4?0:1/E;let P,L,X=(F*M-Y*I)*E-c,B=(Y*S-F*C)*E-d,_=Math.sqrt(X*X+B*B),V=e.data.length*p;if(_<1e-4)return this.apply1(t,i,r,!1,n,!1,h),void e.updateWorldTransformWith(y,v,0,e.ascaleX,e.ascaleY,e.ashearX,e.ashearY);F=i-T.worldX,Y=r-T.worldY;let D=(F*M-Y*I)*E-c,N=(Y*S-F*C)*E-d,U=D*D+N*N;if(0!=l){l*=u*(p+1)*.5;let t=Math.sqrt(U),e=t-_-V*u+l;if(e>0){let s=Math.min(1,e/(2*l))-1;s=(e-l*(1-s*s))/t,D-=s*D,N-=s*N,U=D*D+N*N}}t:if(R){V*=u;let t=(U-_*_-V*V)/(2*_*V);t<-1?(t=-1,L=Math.PI*a):t>1?(t=1,L=0,n&&(S=(Math.sqrt(U)/(_+V)-1)*h+1,g*=S,o&&(f*=S))):L=Math.acos(t)*a,S=_+V*t,I=V*Math.sin(L),P=Math.atan2(N*S-D*I,D*S+N*I)}else{S=u*V,I=m*V;let t=S*S,e=I*I,i=Math.atan2(N,D);C=e*_*_+t*U-t*e;let r=-2*e*_,n=e-t;if(M=r*r-4*n*C,M>=0){let t=Math.sqrt(M);r<0&&(t=-t),t=.5*-(r+t);let e=t/n,s=C/t,o=Math.abs(e)<Math.abs(s)?e:s;if(o*o<=U){Y=Math.sqrt(U-o*o)*a,P=i-Math.atan2(Y,o),L=Math.atan2(Y/m,(o-_)/u);break t}}let o=s.PI,l=_-S,h=l*l,c=0,d=0,g=_+S,f=g*g,p=0;C=-S*_/(t-e),C>=-1&&C<=1&&(C=Math.acos(C),F=S*Math.cos(C)+_,Y=I*Math.sin(C),M=F*F+Y*Y,M<h&&(o=C,h=M,l=F,c=Y),M>f&&(d=C,f=M,g=F,p=Y)),U<=.5*(h+f)?(P=i-Math.atan2(c*a,l),L=o*a):(P=i-Math.atan2(p*a,g),L=d*a)}let O=Math.atan2(v,y)*b,W=t.arotation;P=(P-O)*s.radDeg+x-W,P>180?P-=360:P<-180&&(P+=360),t.updateWorldTransformWith(c,d,W+P*h,g,f,0,0),W=e.arotation,L=((L+O)*s.radDeg-e.ashearX)*b+w-W,L>180?L-=360:L<-180&&(L+=360),e.updateWorldTransformWith(y,v,W+L*h,e.ascaleX,e.ascaleY,e.ashearX,e.ashearY)}}class qt{name;order;skinRequired;constructor(t,e,s){this.name=t,this.order=e,this.skinRequired=s}}class $t extends qt{bones=new Array;_target=null;set target(t){this._target=t}get target(){if(this._target)return this._target;throw new Error("SlotData not set.")}positionMode=Mt.Fixed;spacingMode=Rt.Fixed;rotateMode=Tt.Chain;offsetRotation=0;position=0;spacing=0;mixRotate=0;mixX=0;mixY=0;constructor(t){super(t,0,!1)}}!function(t){t[t.Fixed=0]="Fixed",t[t.Percent=1]="Percent"}(Mt||(Mt={})),function(t){t[t.Length=0]="Length",t[t.Fixed=1]="Fixed",t[t.Percent=2]="Percent",t[t.Proportional=3]="Proportional"}(Rt||(Rt={})),function(t){t[t.Tangent=0]="Tangent",t[t.Chain=1]="Chain",t[t.ChainScale=2]="ChainScale"}(Tt||(Tt={}));class Gt{static NONE=-1;static BEFORE=-2;static AFTER=-3;static epsilon=1e-5;data;bones;target;position=0;spacing=0;mixRotate=0;mixX=0;mixY=0;spaces=new Array;positions=new Array;world=new Array;curves=new Array;lengths=new Array;segments=new Array;active=!1;constructor(t,e){if(!t)throw new Error("data cannot be null.");if(!e)throw new Error("skeleton cannot be null.");this.data=t,this.bones=new Array;for(let s=0,i=t.bones.length;s<i;s++){let i=e.findBone(t.bones[s].name);if(!i)throw new Error(`Couldn't find bone ${t.bones[s].name}.`);this.bones.push(i)}let s=e.findSlot(t.target.name);if(!s)throw new Error(`Couldn't find target bone ${t.target.name}`);this.target=s,this.position=t.position,this.spacing=t.spacing,this.mixRotate=t.mixRotate,this.mixX=t.mixX,this.mixY=t.mixY}isActive(){return this.active}update(){let t=this.target.getAttachment();if(!(t instanceof Vt))return;let e=this.mixRotate,r=this.mixX,a=this.mixY;if(0==e&&0==r&&0==a)return;let n=this.data,o=n.rotateMode==Tt.Tangent,l=n.rotateMode==Tt.ChainScale,h=this.bones,c=h.length,d=o?c:c+1,u=i.setArraySize(this.spaces,d),m=l?this.lengths=i.setArraySize(this.lengths,c):[],g=this.spacing;switch(n.spacingMode){case Rt.Percent:if(l)for(let t=0,e=d-1;t<e;t++){let e=h[t],s=e.data.length;if(s<Gt.epsilon)m[t]=0;else{let i=s*e.a,r=s*e.c;m[t]=Math.sqrt(i*i+r*r)}}i.arrayFill(u,1,d,g);break;case Rt.Proportional:let t=0;for(let e=0,s=d-1;e<s;){let s=h[e],i=s.data.length;if(i<Gt.epsilon)l&&(m[e]=0),u[++e]=g;else{let r=i*s.a,a=i*s.c,n=Math.sqrt(r*r+a*a);l&&(m[e]=n),u[++e]=n,t+=n}}if(t>0){t=d/t*g;for(let e=1;e<d;e++)u[e]*=t}break;default:let e=n.spacingMode==Rt.Length;for(let t=0,s=d-1;t<s;){let s=h[t],i=s.data.length;if(i<Gt.epsilon)l&&(m[t]=0),u[++t]=g;else{let r=i*s.a,a=i*s.c,n=Math.sqrt(r*r+a*a);l&&(m[t]=n),u[++t]=(e?i+g:g)*n/i}}}let f=this.computeWorldPositions(t,d,o),p=f[0],x=f[1],w=n.offsetRotation,b=!1;if(0==w)b=n.rotateMode==Tt.Chain;else{b=!1;let t=this.target.bone;w*=t.a*t.d-t.b*t.c>0?s.degRad:-s.degRad}for(let t=0,i=3;t<c;t++,i+=3){let n=h[t];n.worldX+=(p-n.worldX)*r,n.worldY+=(x-n.worldY)*a;let c=f[i],d=f[i+1],g=c-p,y=d-x;if(l){let s=m[t];if(0!=s){let t=(Math.sqrt(g*g+y*y)/s-1)*e+1;n.a*=t,n.c*=t}}if(p=c,x=d,e>0){let r=n.a,a=n.b,l=n.c,h=n.d,c=0,d=0,m=0;if(c=o?f[i-1]:0==u[t+1]?f[i+2]:Math.atan2(y,g),c-=Math.atan2(l,r),b){d=Math.cos(c),m=Math.sin(c);let t=n.data.length;p+=(t*(d*r-m*l)-g)*e,x+=(t*(m*r+d*l)-y)*e}else c+=w;c>s.PI?c-=s.PI2:c<-s.PI&&(c+=s.PI2),c*=e,d=Math.cos(c),m=Math.sin(c),n.a=d*r-m*l,n.b=d*a-m*h,n.c=m*r+d*l,n.d=m*a+d*h}n.updateAppliedTransform()}}computeWorldPositions(t,e,s){let r=this.target,a=this.position,n=this.spaces,o=i.setArraySize(this.positions,3*e+2),l=this.world,h=t.closed,c=t.worldVerticesLength,d=c/6,u=Gt.NONE;if(!t.constantSpeed){let m=t.lengths;d-=h?1:2;let g,f=m[d];switch(this.data.positionMode==Mt.Percent&&(a*=f),this.data.spacingMode){case Rt.Percent:g=f;break;case Rt.Proportional:g=f/e;break;default:g=1}l=i.setArraySize(this.world,8);for(let i=0,p=0,x=0;i<e;i++,p+=3){let e=n[i]*g;a+=e;let w=a;if(h)w%=f,w<0&&(w+=f),x=0;else{if(w<0){u!=Gt.BEFORE&&(u=Gt.BEFORE,t.computeWorldVertices(r,2,4,l,0,2)),this.addBeforePosition(w,l,0,o,p);continue}if(w>f){u!=Gt.AFTER&&(u=Gt.AFTER,t.computeWorldVertices(r,c-6,4,l,0,2)),this.addAfterPosition(w-f,l,0,o,p);continue}}for(;;x++){let t=m[x];if(!(w>t)){if(0==x)w/=t;else{let e=m[x-1];w=(w-e)/(t-e)}break}}x!=u&&(u=x,h&&x==d?(t.computeWorldVertices(r,c-4,4,l,0,2),t.computeWorldVertices(r,0,4,l,4,2)):t.computeWorldVertices(r,6*x+2,8,l,0,2)),this.addCurvePosition(w,l[0],l[1],l[2],l[3],l[4],l[5],l[6],l[7],o,p,s||i>0&&0==e)}return o}h?(c+=2,l=i.setArraySize(this.world,c),t.computeWorldVertices(r,2,c-4,l,0,2),t.computeWorldVertices(r,0,2,l,c-4,2),l[c-2]=l[0],l[c-1]=l[1]):(d--,c-=4,l=i.setArraySize(this.world,c),t.computeWorldVertices(r,2,c,l,0,2));let m,g=i.setArraySize(this.curves,d),f=0,p=l[0],x=l[1],w=0,b=0,y=0,v=0,k=0,A=0,S=0,I=0,C=0,M=0,R=0,T=0,E=0,F=0;for(let t=0,e=2;t<d;t++,e+=6)w=l[e],b=l[e+1],y=l[e+2],v=l[e+3],k=l[e+4],A=l[e+5],S=.1875*(p-2*w+y),I=.1875*(x-2*b+v),C=.09375*(3*(w-y)-p+k),M=.09375*(3*(b-v)-x+A),R=2*S+C,T=2*I+M,E=.75*(w-p)+S+.16666667*C,F=.75*(b-x)+I+.16666667*M,f+=Math.sqrt(E*E+F*F),E+=R,F+=T,R+=C,T+=M,f+=Math.sqrt(E*E+F*F),E+=R,F+=T,f+=Math.sqrt(E*E+F*F),E+=R+C,F+=T+M,f+=Math.sqrt(E*E+F*F),g[t]=f,p=k,x=A;switch(this.data.positionMode==Mt.Percent&&(a*=f),this.data.spacingMode){case Rt.Percent:m=f;break;case Rt.Proportional:m=f/e;break;default:m=1}let Y=this.segments,P=0;for(let t=0,i=0,r=0,d=0;t<e;t++,i+=3){let e=n[t]*m;a+=e;let L=a;if(h)L%=f,L<0&&(L+=f),r=0;else{if(L<0){this.addBeforePosition(L,l,0,o,i);continue}if(L>f){this.addAfterPosition(L-f,l,c-4,o,i);continue}}for(;;r++){let t=g[r];if(!(L>t)){if(0==r)L/=t;else{let e=g[r-1];L=(L-e)/(t-e)}break}}if(r!=u){u=r;let t=6*r;for(p=l[t],x=l[t+1],w=l[t+2],b=l[t+3],y=l[t+4],v=l[t+5],k=l[t+6],A=l[t+7],S=.03*(p-2*w+y),I=.03*(x-2*b+v),C=.006*(3*(w-y)-p+k),M=.006*(3*(b-v)-x+A),R=2*S+C,T=2*I+M,E=.3*(w-p)+S+.16666667*C,F=.3*(b-x)+I+.16666667*M,P=Math.sqrt(E*E+F*F),Y[0]=P,t=1;t<8;t++)E+=R,F+=T,R+=C,T+=M,P+=Math.sqrt(E*E+F*F),Y[t]=P;E+=R,F+=T,P+=Math.sqrt(E*E+F*F),Y[8]=P,E+=R+C,F+=T+M,P+=Math.sqrt(E*E+F*F),Y[9]=P,d=0}for(L*=P;;d++){let t=Y[d];if(!(L>t)){if(0==d)L/=t;else{let e=Y[d-1];L=d+(L-e)/(t-e)}break}}this.addCurvePosition(.1*L,p,x,w,b,y,v,k,A,o,i,s||t>0&&0==e)}return o}addBeforePosition(t,e,s,i,r){let a=e[s],n=e[s+1],o=e[s+2]-a,l=e[s+3]-n,h=Math.atan2(l,o);i[r]=a+t*Math.cos(h),i[r+1]=n+t*Math.sin(h),i[r+2]=h}addAfterPosition(t,e,s,i,r){let a=e[s+2],n=e[s+3],o=a-e[s],l=n-e[s+1],h=Math.atan2(l,o);i[r]=a+t*Math.cos(h),i[r+1]=n+t*Math.sin(h),i[r+2]=h}addCurvePosition(t,e,s,i,r,a,n,o,l,h,c,d){if(0==t||isNaN(t))return h[c]=e,h[c+1]=s,void(h[c+2]=Math.atan2(r-s,i-e));let u=t*t,m=u*t,g=1-t,f=g*g,p=f*g,x=g*t,w=3*x,b=g*w,y=w*t,v=e*p+i*b+a*y+o*m,k=s*p+r*b+n*y+l*m;h[c]=v,h[c+1]=k,d&&(h[c+2]=t<.001?Math.atan2(r-s,i-e):Math.atan2(k-(s*f+r*x*2+n*u),v-(e*f+i*x*2+a*u)))}}class Ht{data;bone;color;darkColor=null;attachment=null;attachmentState=0;sequenceIndex=-1;deform=new Array;constructor(t,s){if(!t)throw new Error("data cannot be null.");if(!s)throw new Error("bone cannot be null.");this.data=t,this.bone=s,this.color=new e,this.darkColor=t.darkColor?new e:null,this.setToSetupPose()}getSkeleton(){return this.bone.skeleton}getAttachment(){return this.attachment}setAttachment(t){this.attachment!=t&&(t instanceof o&&this.attachment instanceof o&&t.timelineAttachment==this.attachment.timelineAttachment||(this.deform.length=0),this.attachment=t,this.sequenceIndex=-1)}setToSetupPose(){this.color.setFromColor(this.data.color),this.darkColor&&this.darkColor.setFromColor(this.data.darkColor),this.data.attachmentName?(this.attachment=null,this.setAttachment(this.bone.skeleton.getAttachment(this.data.index,this.data.attachmentName))):this.attachment=null}}class jt{data;bones;target;mixRotate=0;mixX=0;mixY=0;mixScaleX=0;mixScaleY=0;mixShearY=0;temp=new a;active=!1;constructor(t,e){if(!t)throw new Error("data cannot be null.");if(!e)throw new Error("skeleton cannot be null.");this.data=t,this.mixRotate=t.mixRotate,this.mixX=t.mixX,this.mixY=t.mixY,this.mixScaleX=t.mixScaleX,this.mixScaleY=t.mixScaleY,this.mixShearY=t.mixShearY,this.bones=new Array;for(let s=0;s<t.bones.length;s++){let i=e.findBone(t.bones[s].name);if(!i)throw new Error(`Couldn't find bone ${t.bones[s].name}.`);this.bones.push(i)}let s=e.findBone(t.target.name);if(!s)throw new Error(`Couldn't find target bone ${t.target.name}.`);this.target=s}isActive(){return this.active}update(){0==this.mixRotate&&0==this.mixX&&0==this.mixY&&0==this.mixScaleX&&0==this.mixScaleY&&0==this.mixShearY||(this.data.local?this.data.relative?this.applyRelativeLocal():this.applyAbsoluteLocal():this.data.relative?this.applyRelativeWorld():this.applyAbsoluteWorld())}applyAbsoluteWorld(){let t=this.mixRotate,e=this.mixX,i=this.mixY,r=this.mixScaleX,a=this.mixScaleY,n=this.mixShearY,o=0!=e||0!=i,l=this.target,h=l.a,c=l.b,d=l.c,u=l.d,m=h*u-c*d>0?s.degRad:-s.degRad,g=this.data.offsetRotation*m,f=this.data.offsetShearY*m,p=this.bones;for(let m=0,x=p.length;m<x;m++){let x=p[m];if(0!=t){let e=x.a,i=x.b,r=x.c,a=x.d,n=Math.atan2(d,h)-Math.atan2(r,e)+g;n>s.PI?n-=s.PI2:n<-s.PI&&(n+=s.PI2),n*=t;let o=Math.cos(n),l=Math.sin(n);x.a=o*e-l*r,x.b=o*i-l*a,x.c=l*e+o*r,x.d=l*i+o*a}if(o){let t=this.temp;l.localToWorld(t.set(this.data.offsetX,this.data.offsetY)),x.worldX+=(t.x-x.worldX)*e,x.worldY+=(t.y-x.worldY)*i}if(0!=r){let t=Math.sqrt(x.a*x.a+x.c*x.c);0!=t&&(t=(t+(Math.sqrt(h*h+d*d)-t+this.data.offsetScaleX)*r)/t),x.a*=t,x.c*=t}if(0!=a){let t=Math.sqrt(x.b*x.b+x.d*x.d);0!=t&&(t=(t+(Math.sqrt(c*c+u*u)-t+this.data.offsetScaleY)*a)/t),x.b*=t,x.d*=t}if(n>0){let t=x.b,e=x.d,i=Math.atan2(e,t),r=Math.atan2(u,c)-Math.atan2(d,h)-(i-Math.atan2(x.c,x.a));r>s.PI?r-=s.PI2:r<-s.PI&&(r+=s.PI2),r=i+(r+f)*n;let a=Math.sqrt(t*t+e*e);x.b=Math.cos(r)*a,x.d=Math.sin(r)*a}x.updateAppliedTransform()}}applyRelativeWorld(){let t=this.mixRotate,e=this.mixX,i=this.mixY,r=this.mixScaleX,a=this.mixScaleY,n=this.mixShearY,o=0!=e||0!=i,l=this.target,h=l.a,c=l.b,d=l.c,u=l.d,m=h*u-c*d>0?s.degRad:-s.degRad,g=this.data.offsetRotation*m,f=this.data.offsetShearY*m,p=this.bones;for(let m=0,x=p.length;m<x;m++){let x=p[m];if(0!=t){let e=x.a,i=x.b,r=x.c,a=x.d,n=Math.atan2(d,h)+g;n>s.PI?n-=s.PI2:n<-s.PI&&(n+=s.PI2),n*=t;let o=Math.cos(n),l=Math.sin(n);x.a=o*e-l*r,x.b=o*i-l*a,x.c=l*e+o*r,x.d=l*i+o*a}if(o){let t=this.temp;l.localToWorld(t.set(this.data.offsetX,this.data.offsetY)),x.worldX+=t.x*e,x.worldY+=t.y*i}if(0!=r){let t=(Math.sqrt(h*h+d*d)-1+this.data.offsetScaleX)*r+1;x.a*=t,x.c*=t}if(0!=a){let t=(Math.sqrt(c*c+u*u)-1+this.data.offsetScaleY)*a+1;x.b*=t,x.d*=t}if(n>0){let t=Math.atan2(u,c)-Math.atan2(d,h);t>s.PI?t-=s.PI2:t<-s.PI&&(t+=s.PI2);let e=x.b,i=x.d;t=Math.atan2(i,e)+(t-s.PI/2+f)*n;let r=Math.sqrt(e*e+i*i);x.b=Math.cos(t)*r,x.d=Math.sin(t)*r}x.updateAppliedTransform()}}applyAbsoluteLocal(){let t=this.mixRotate,e=this.mixX,s=this.mixY,i=this.mixScaleX,r=this.mixScaleY,a=this.mixShearY,n=this.target,o=this.bones;for(let l=0,h=o.length;l<h;l++){let h=o[l],c=h.arotation;if(0!=t){let e=n.arotation-c+this.data.offsetRotation;e-=360*(16384-(16384.499999999996-e/360|0)),c+=e*t}let d=h.ax,u=h.ay;d+=(n.ax-d+this.data.offsetX)*e,u+=(n.ay-u+this.data.offsetY)*s;let m=h.ascaleX,g=h.ascaleY;0!=i&&0!=m&&(m=(m+(n.ascaleX-m+this.data.offsetScaleX)*i)/m),0!=r&&0!=g&&(g=(g+(n.ascaleY-g+this.data.offsetScaleY)*r)/g);let f=h.ashearY;if(0!=a){let t=n.ashearY-f+this.data.offsetShearY;t-=360*(16384-(16384.499999999996-t/360|0)),f+=t*a}h.updateWorldTransformWith(d,u,c,m,g,h.ashearX,f)}}applyRelativeLocal(){let t=this.mixRotate,e=this.mixX,s=this.mixY,i=this.mixScaleX,r=this.mixScaleY,a=this.mixShearY,n=this.target,o=this.bones;for(let l=0,h=o.length;l<h;l++){let h=o[l],c=h.arotation+(n.arotation+this.data.offsetRotation)*t,d=h.ax+(n.ax+this.data.offsetX)*e,u=h.ay+(n.ay+this.data.offsetY)*s,m=h.ascaleX*((n.ascaleX-1+this.data.offsetScaleX)*i+1),g=h.ascaleY*((n.ascaleY-1+this.data.offsetScaleY)*r+1),f=h.ashearY+(n.ashearY+this.data.offsetShearY)*a;h.updateWorldTransformWith(d,u,c,m,g,h.ashearX,f)}}}class Kt{static yDown=!1;data;bones;slots;drawOrder;ikConstraints;transformConstraints;pathConstraints;_updateCache=new Array;skin=null;color;scaleX=1;_scaleY=1;get scaleY(){return Kt.yDown?-this._scaleY:this._scaleY}set scaleY(t){this._scaleY=t}x=0;y=0;constructor(t){if(!t)throw new Error("data cannot be null.");this.data=t,this.bones=new Array;for(let e=0;e<t.bones.length;e++){let s,i=t.bones[e];if(i.parent){let t=this.bones[i.parent.index];s=new Wt(i,this,t),t.children.push(s)}else s=new Wt(i,this,null);this.bones.push(s)}this.slots=new Array,this.drawOrder=new Array;for(let e=0;e<t.slots.length;e++){let s=t.slots[e],i=this.bones[s.boneData.index],r=new Ht(s,i);this.slots.push(r),this.drawOrder.push(r)}this.ikConstraints=new Array;for(let e=0;e<t.ikConstraints.length;e++){let s=t.ikConstraints[e];this.ikConstraints.push(new zt(s,this))}this.transformConstraints=new Array;for(let e=0;e<t.transformConstraints.length;e++){let s=t.transformConstraints[e];this.transformConstraints.push(new jt(s,this))}this.pathConstraints=new Array;for(let e=0;e<t.pathConstraints.length;e++){let s=t.pathConstraints[e];this.pathConstraints.push(new Gt(s,this))}this.color=new e(1,1,1,1),this.updateCache()}updateCache(){this._updateCache.length=0;let t=this.bones;for(let e=0,s=t.length;e<s;e++){let s=t[e];s.sorted=s.data.skinRequired,s.active=!s.sorted}if(this.skin){let t=this.skin.bones;for(let e=0,s=this.skin.bones.length;e<s;e++){let s=this.bones[t[e].index];do{s.sorted=!1,s.active=!0,s=s.parent}while(s)}}let e=this.ikConstraints,s=this.transformConstraints,i=this.pathConstraints,r=e.length,a=s.length,n=i.length,o=r+a+n;t:for(let t=0;t<o;t++){for(let s=0;s<r;s++){let i=e[s];if(i.data.order==t){this.sortIkConstraint(i);continue t}}for(let e=0;e<a;e++){let i=s[e];if(i.data.order==t){this.sortTransformConstraint(i);continue t}}for(let e=0;e<n;e++){let s=i[e];if(s.data.order==t){this.sortPathConstraint(s);continue t}}}for(let e=0,s=t.length;e<s;e++)this.sortBone(t[e])}sortIkConstraint(t){if(t.active=t.target.isActive()&&(!t.data.skinRequired||this.skin&&i.contains(this.skin.constraints,t.data,!0)),!t.active)return;let e=t.target;this.sortBone(e);let s=t.bones,r=s[0];if(this.sortBone(r),1==s.length)this._updateCache.push(t),this.sortReset(r.children);else{let e=s[s.length-1];this.sortBone(e),this._updateCache.push(t),this.sortReset(r.children),e.sorted=!0}}sortPathConstraint(t){if(t.active=t.target.bone.isActive()&&(!t.data.skinRequired||this.skin&&i.contains(this.skin.constraints,t.data,!0)),!t.active)return;let e=t.target,s=e.data.index,r=e.bone;this.skin&&this.sortPathConstraintAttachment(this.skin,s,r),this.data.defaultSkin&&this.data.defaultSkin!=this.skin&&this.sortPathConstraintAttachment(this.data.defaultSkin,s,r);for(let t=0,e=this.data.skins.length;t<e;t++)this.sortPathConstraintAttachment(this.data.skins[t],s,r);let a=e.getAttachment();a instanceof Vt&&this.sortPathConstraintAttachmentWith(a,r);let n=t.bones,o=n.length;for(let t=0;t<o;t++)this.sortBone(n[t]);this._updateCache.push(t);for(let t=0;t<o;t++)this.sortReset(n[t].children);for(let t=0;t<o;t++)n[t].sorted=!0}sortTransformConstraint(t){if(t.active=t.target.isActive()&&(!t.data.skinRequired||this.skin&&i.contains(this.skin.constraints,t.data,!0)),!t.active)return;this.sortBone(t.target);let e=t.bones,s=e.length;if(t.data.local)for(let t=0;t<s;t++){let s=e[t];this.sortBone(s.parent),this.sortBone(s)}else for(let t=0;t<s;t++)this.sortBone(e[t]);this._updateCache.push(t);for(let t=0;t<s;t++)this.sortReset(e[t].children);for(let t=0;t<s;t++)e[t].sorted=!0}sortPathConstraintAttachment(t,e,s){let i=t.attachments[e];if(i)for(let t in i)this.sortPathConstraintAttachmentWith(i[t],s)}sortPathConstraintAttachmentWith(t,e){if(!(t instanceof Vt))return;let s=t.bones;if(s){let t=this.bones;for(let e=0,i=s.length;e<i;){let i=s[e++];for(i+=e;e<i;)this.sortBone(t[s[e++]])}}else this.sortBone(e)}sortBone(t){if(!t)return;if(t.sorted)return;let e=t.parent;e&&this.sortBone(e),t.sorted=!0,this._updateCache.push(t)}sortReset(t){for(let e=0,s=t.length;e<s;e++){let s=t[e];s.active&&(s.sorted&&this.sortReset(s.children),s.sorted=!1)}}updateWorldTransform(){let t=this.bones;for(let e=0,s=t.length;e<s;e++){let s=t[e];s.ax=s.x,s.ay=s.y,s.arotation=s.rotation,s.ascaleX=s.scaleX,s.ascaleY=s.scaleY,s.ashearX=s.shearX,s.ashearY=s.shearY}let e=this._updateCache;for(let t=0,s=e.length;t<s;t++)e[t].update()}updateWorldTransformWith(t){let e=this.getRootBone();if(!e)throw new Error("Root bone must not be null.");let i=t.a,r=t.b,a=t.c,n=t.d;e.worldX=i*this.x+r*this.y+t.worldX,e.worldY=a*this.x+n*this.y+t.worldY;let o=e.rotation+90+e.shearY,l=s.cosDeg(e.rotation+e.shearX)*e.scaleX,h=s.cosDeg(o)*e.scaleY,c=s.sinDeg(e.rotation+e.shearX)*e.scaleX,d=s.sinDeg(o)*e.scaleY;e.a=(i*l+r*c)*this.scaleX,e.b=(i*h+r*d)*this.scaleX,e.c=(a*l+n*c)*this.scaleY,e.d=(a*h+n*d)*this.scaleY;let u=this._updateCache;for(let t=0,s=u.length;t<s;t++){let s=u[t];s!=e&&s.update()}}setToSetupPose(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()}setBonesToSetupPose(){let t=this.bones;for(let e=0,s=t.length;e<s;e++)t[e].setToSetupPose();let e=this.ikConstraints;for(let t=0,s=e.length;t<s;t++){let s=e[t];s.mix=s.data.mix,s.softness=s.data.softness,s.bendDirection=s.data.bendDirection,s.compress=s.data.compress,s.stretch=s.data.stretch}let s=this.transformConstraints;for(let t=0,e=s.length;t<e;t++){let e=s[t],i=e.data;e.mixRotate=i.mixRotate,e.mixX=i.mixX,e.mixY=i.mixY,e.mixScaleX=i.mixScaleX,e.mixScaleY=i.mixScaleY,e.mixShearY=i.mixShearY}let i=this.pathConstraints;for(let t=0,e=i.length;t<e;t++){let e=i[t],s=e.data;e.position=s.position,e.spacing=s.spacing,e.mixRotate=s.mixRotate,e.mixX=s.mixX,e.mixY=s.mixY}}setSlotsToSetupPose(){let t=this.slots;i.arrayCopy(t,0,this.drawOrder,0,t.length);for(let e=0,s=t.length;e<s;e++)t[e].setToSetupPose()}getRootBone(){return 0==this.bones.length?null:this.bones[0]}findBone(t){if(!t)throw new Error("boneName cannot be null.");let e=this.bones;for(let s=0,i=e.length;s<i;s++){let i=e[s];if(i.data.name==t)return i}return null}findSlot(t){if(!t)throw new Error("slotName cannot be null.");let e=this.slots;for(let s=0,i=e.length;s<i;s++){let i=e[s];if(i.data.name==t)return i}return null}setSkinByName(t){let e=this.data.findSkin(t);if(!e)throw new Error("Skin not found: "+t);this.setSkin(e)}setSkin(t){if(t!=this.skin){if(t)if(this.skin)t.attachAll(this,this.skin);else{let e=this.slots;for(let s=0,i=e.length;s<i;s++){let i=e[s],r=i.data.attachmentName;if(r){let e=t.getAttachment(s,r);e&&i.setAttachment(e)}}}this.skin=t,this.updateCache()}}getAttachmentByName(t,e){let s=this.data.findSlot(t);if(!s)throw new Error(`Can't find slot with name ${t}`);return this.getAttachment(s.index,e)}getAttachment(t,e){if(!e)throw new Error("attachmentName cannot be null.");if(this.skin){let s=this.skin.getAttachment(t,e);if(s)return s}return this.data.defaultSkin?this.data.defaultSkin.getAttachment(t,e):null}setAttachment(t,e){if(!t)throw new Error("slotName cannot be null.");let s=this.slots;for(let i=0,r=s.length;i<r;i++){let r=s[i];if(r.data.name==t){let s=null;if(e&&(s=this.getAttachment(i,e),!s))throw new Error("Attachment not found: "+e+", for slot: "+t);return void r.setAttachment(s)}}throw new Error("Slot not found: "+t)}findIkConstraint(t){if(!t)throw new Error("constraintName cannot be null.");let e=this.ikConstraints;for(let s=0,i=e.length;s<i;s++){let i=e[s];if(i.data.name==t)return i}return null}findTransformConstraint(t){if(!t)throw new Error("constraintName cannot be null.");let e=this.transformConstraints;for(let s=0,i=e.length;s<i;s++){let i=e[s];if(i.data.name==t)return i}return null}findPathConstraint(t){if(!t)throw new Error("constraintName cannot be null.");let e=this.pathConstraints;for(let s=0,i=e.length;s<i;s++){let i=e[s];if(i.data.name==t)return i}return null}getBoundsRect(){let t=new a,e=new a;return this.getBounds(t,e),{x:t.x,y:t.y,width:e.x,height:e.y}}getBounds(t,e,s=new Array(2)){if(!t)throw new Error("offset cannot be null.");if(!e)throw new Error("size cannot be null.");let r=this.drawOrder,a=Number.POSITIVE_INFINITY,n=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY;for(let t=0,e=r.length;t<e;t++){let e=r[t];if(!e.bone.active)continue;let h=0,c=null,d=e.getAttachment();if(d instanceof Nt)h=8,c=i.setArraySize(s,h,0),d.computeWorldVertices(e,c,0,2);else if(d instanceof _t){let t=d;h=t.worldVerticesLength,c=i.setArraySize(s,h,0),t.computeWorldVertices(e,0,h,c,0,2)}if(c)for(let t=0,e=c.length;t<e;t+=2){let e=c[t],s=c[t+1];a=Math.min(a,e),n=Math.min(n,s),o=Math.max(o,e),l=Math.max(l,s)}}t.set(a,n),e.set(o-a,l-n)}}class Qt{data;intValue=0;floatValue=0;stringValue=null;time=0;volume=0;balance=0;constructor(t,e){if(!e)throw new Error("data cannot be null.");this.time=t,this.data=e}}class Jt{name;intValue=0;floatValue=0;stringValue=null;audioPath=null;volume=0;balance=0;constructor(t){this.name=t}}class Zt extends qt{bones=new Array;_target=null;set target(t){this._target=t}get target(){if(this._target)return this._target;throw new Error("BoneData not set.")}bendDirection=1;compress=!1;stretch=!1;uniform=!1;mix=1;softness=0;constructor(t){super(t,0,!1)}}class te{name=null;bones=new Array;slots=new Array;skins=new Array;defaultSkin=null;events=new Array;animations=new Array;ikConstraints=new Array;transformConstraints=new Array;pathConstraints=new Array;x=0;y=0;width=0;height=0;version=null;hash=null;fps=0;imagesPath=null;audioPath=null;findBone(t){if(!t)throw new Error("boneName cannot be null.");let e=this.bones;for(let s=0,i=e.length;s<i;s++){let i=e[s];if(i.name==t)return i}return null}findSlot(t){if(!t)throw new Error("slotName cannot be null.");let e=this.slots;for(let s=0,i=e.length;s<i;s++){let i=e[s];if(i.name==t)return i}return null}findSkin(t){if(!t)throw new Error("skinName cannot be null.");let e=this.skins;for(let s=0,i=e.length;s<i;s++){let i=e[s];if(i.name==t)return i}return null}findEvent(t){if(!t)throw new Error("eventDataName cannot be null.");let e=this.events;for(let s=0,i=e.length;s<i;s++){let i=e[s];if(i.name==t)return i}return null}findAnimation(t){if(!t)throw new Error("animationName cannot be null.");let e=this.animations;for(let s=0,i=e.length;s<i;s++){let i=e[s];if(i.name==t)return i}return null}findIkConstraint(t){if(!t)throw new Error("constraintName cannot be null.");let e=this.ikConstraints;for(let s=0,i=e.length;s<i;s++){let i=e[s];if(i.name==t)return i}return null}findTransformConstraint(t){if(!t)throw new Error("constraintName cannot be null.");let e=this.transformConstraints;for(let s=0,i=e.length;s<i;s++){let i=e[s];if(i.name==t)return i}return null}findPathConstraint(t){if(!t)throw new Error("constraintName cannot be null.");let e=this.pathConstraints;for(let s=0,i=e.length;s<i;s++){let i=e[s];if(i.name==t)return i}return null}}class ee{slotIndex;name;attachment;constructor(t=0,e,s){this.slotIndex=t,this.name=e,this.attachment=s}}class se{name;attachments=new Array;bones=Array();constraints=new Array;constructor(t){if(!t)throw new Error("name cannot be null.");this.name=t}setAttachment(t,e,s){if(!s)throw new Error("attachment cannot be null.");let i=this.attachments;t>=i.length&&(i.length=t+1),i[t]||(i[t]={}),i[t][e]=s}addSkin(t){for(let e=0;e<t.bones.length;e++){let s=t.bones[e],i=!1;for(let t=0;t<this.bones.length;t++)if(this.bones[t]==s){i=!0;break}i||this.bones.push(s)}for(let e=0;e<t.constraints.length;e++){let s=t.constraints[e],i=!1;for(let t=0;t<this.constraints.length;t++)if(this.constraints[t]==s){i=!0;break}i||this.constraints.push(s)}let e=t.getAttachments();for(let t=0;t<e.length;t++){var s=e[t];this.setAttachment(s.slotIndex,s.name,s.attachment)}}copySkin(t){for(let e=0;e<t.bones.length;e++){let s=t.bones[e],i=!1;for(let t=0;t<this.bones.length;t++)if(this.bones[t]==s){i=!0;break}i||this.bones.push(s)}for(let e=0;e<t.constraints.length;e++){let s=t.constraints[e],i=!1;for(let t=0;t<this.constraints.length;t++)if(this.constraints[t]==s){i=!0;break}i||this.constraints.push(s)}let e=t.getAttachments();for(let t=0;t<e.length;t++){var s=e[t];s.attachment&&(s.attachment instanceof _t?(s.attachment=s.attachment.newLinkedMesh(),this.setAttachment(s.slotIndex,s.name,s.attachment)):(s.attachment=s.attachment.copy(),this.setAttachment(s.slotIndex,s.name,s.attachment)))}}getAttachment(t,e){let s=this.attachments[t];return s?s[e]:null}removeAttachment(t,e){let s=this.attachments[t];s&&delete s[e]}getAttachments(){let t=new Array;for(var e=0;e<this.attachments.length;e++){let s=this.attachments[e];if(s)for(let i in s){let r=s[i];r&&t.push(new ee(e,i,r))}}return t}getAttachmentsForSlot(t,e){let s=this.attachments[t];if(s)for(let i in s){let r=s[i];r&&e.push(new ee(t,i,r))}}clear(){this.attachments.length=0,this.bones.length=0,this.constraints.length=0}attachAll(t,e){let s=0;for(let i=0;i<t.slots.length;i++){let r=t.slots[i],a=r.getAttachment();if(a&&s<e.attachments.length){let t=e.attachments[s];for(let e in t){if(a==t[e]){let t=this.getAttachment(s,e);t&&r.setAttachment(t);break}}}s++}}}class ie{index=0;name;boneData;color=new e(1,1,1,1);darkColor=null;attachmentName=null;blendMode=Et.Normal;constructor(t,e,s){if(t<0)throw new Error("index must be >= 0.");if(!e)throw new Error("name cannot be null.");if(!s)throw new Error("boneData cannot be null.");this.index=t,this.name=e,this.boneData=s}}!function(t){t[t.Normal=0]="Normal",t[t.Additive=1]="Additive",t[t.Multiply=2]="Multiply",t[t.Screen=3]="Screen"}(Et||(Et={}));class re extends qt{bones=new Array;_target=null;set target(t){this._target=t}get target(){if(this._target)return this._target;throw new Error("BoneData not set.")}mixRotate=0;mixX=0;mixY=0;mixScaleX=0;mixScaleY=0;mixShearY=0;offsetRotation=0;offsetX=0;offsetY=0;offsetScaleX=0;offsetScaleY=0;offsetShearY=0;relative=!1;local=!1;constructor(t){super(t,0,!1)}}class ae{scale=1;attachmentLoader;linkedMeshes=new Array;constructor(t){this.attachmentLoader=t}readSkeletonData(t){let s=this.scale,r=new te;r.name="";let a=new ne(t),n=a.readInt32(),o=a.readInt32();r.hash=0==o&&0==n?null:o.toString(16)+n.toString(16),r.version=a.readString(),r.x=a.readFloat(),r.y=a.readFloat(),r.width=a.readFloat(),r.height=a.readFloat();let l=a.readBoolean();l&&(r.fps=a.readFloat(),r.imagesPath=a.readString(),r.audioPath=a.readString());let h=0;h=a.readInt(!0);for(let t=0;t<h;t++){let t=a.readString();if(!t)throw new Error("String in string table must not be null.");a.strings.push(t)}h=a.readInt(!0);for(let t=0;t<h;t++){let i=a.readString();if(!i)throw new Error("Bone name must not be null.");let n=0==t?null:r.bones[a.readInt(!0)],o=new Ot(t,i,n);o.rotation=a.readFloat(),o.x=a.readFloat()*s,o.y=a.readFloat()*s,o.scaleX=a.readFloat(),o.scaleY=a.readFloat(),o.shearX=a.readFloat(),o.shearY=a.readFloat(),o.length=a.readFloat()*s,o.transformMode=a.readInt(!0),o.skinRequired=a.readBoolean(),l&&e.rgba8888ToColor(o.color,a.readInt32()),r.bones.push(o)}h=a.readInt(!0);for(let t=0;t<h;t++){let s=a.readString();if(!s)throw new Error("Slot name must not be null.");let i=r.bones[a.readInt(!0)],n=new ie(t,s,i);e.rgba8888ToColor(n.color,a.readInt32());let o=a.readInt32();-1!=o&&e.rgb888ToColor(n.darkColor=new e,o),n.attachmentName=a.readStringRef(),n.blendMode=a.readInt(!0),r.slots.push(n)}h=a.readInt(!0);for(let t,e=0;e<h;e++){let e=a.readString();if(!e)throw new Error("IK constraint data name must not be null.");let i=new Zt(e);i.order=a.readInt(!0),i.skinRequired=a.readBoolean(),t=a.readInt(!0);for(let e=0;e<t;e++)i.bones.push(r.bones[a.readInt(!0)]);i.target=r.bones[a.readInt(!0)],i.mix=a.readFloat(),i.softness=a.readFloat()*s,i.bendDirection=a.readByte(),i.compress=a.readBoolean(),i.stretch=a.readBoolean(),i.uniform=a.readBoolean(),r.ikConstraints.push(i)}h=a.readInt(!0);for(let t,e=0;e<h;e++){let e=a.readString();if(!e)throw new Error("Transform constraint data name must not be null.");let i=new re(e);i.order=a.readInt(!0),i.skinRequired=a.readBoolean(),t=a.readInt(!0);for(let e=0;e<t;e++)i.bones.push(r.bones[a.readInt(!0)]);i.target=r.bones[a.readInt(!0)],i.local=a.readBoolean(),i.relative=a.readBoolean(),i.offsetRotation=a.readFloat(),i.offsetX=a.readFloat()*s,i.offsetY=a.readFloat()*s,i.offsetScaleX=a.readFloat(),i.offsetScaleY=a.readFloat(),i.offsetShearY=a.readFloat(),i.mixRotate=a.readFloat(),i.mixX=a.readFloat(),i.mixY=a.readFloat(),i.mixScaleX=a.readFloat(),i.mixScaleY=a.readFloat(),i.mixShearY=a.readFloat(),r.transformConstraints.push(i)}h=a.readInt(!0);for(let t,e=0;e<h;e++){let e=a.readString();if(!e)throw new Error("Path constraint data name must not be null.");let i=new $t(e);i.order=a.readInt(!0),i.skinRequired=a.readBoolean(),t=a.readInt(!0);for(let e=0;e<t;e++)i.bones.push(r.bones[a.readInt(!0)]);i.target=r.slots[a.readInt(!0)],i.positionMode=a.readInt(!0),i.spacingMode=a.readInt(!0),i.rotateMode=a.readInt(!0),i.offsetRotation=a.readFloat(),i.position=a.readFloat(),i.positionMode==Mt.Fixed&&(i.position*=s),i.spacing=a.readFloat(),i.spacingMode!=Rt.Length&&i.spacingMode!=Rt.Fixed||(i.spacing*=s),i.mixRotate=a.readFloat(),i.mixX=a.readFloat(),i.mixY=a.readFloat(),r.pathConstraints.push(i)}let c=this.readSkin(a,r,!0,l);c&&(r.defaultSkin=c,r.skins.push(c));{let t=r.skins.length;for(i.setArraySize(r.skins,h=t+a.readInt(!0));t<h;t++){let e=this.readSkin(a,r,!1,l);if(!e)throw new Error("readSkin() should not have returned null.");r.skins[t]=e}}h=this.linkedMeshes.length;for(let t=0;t<h;t++){let e=this.linkedMeshes[t],s=e.skin?r.findSkin(e.skin):r.defaultSkin;if(!s)throw new Error("Not skin found for linked mesh.");if(!e.parent)throw new Error("Linked mesh parent must not be null");let i=s.getAttachment(e.slotIndex,e.parent);if(!i)throw new Error(`Parent mesh not found: ${e.parent}`);e.mesh.timelineAttachment=e.inheritTimeline?i:e.mesh,e.mesh.setParentMesh(i),null!=e.mesh.region&&e.mesh.updateRegion()}this.linkedMeshes.length=0,h=a.readInt(!0);for(let t=0;t<h;t++){let t=a.readStringRef();if(!t)throw new Error;let e=new Jt(t);e.intValue=a.readInt(!1),e.floatValue=a.readFloat(),e.stringValue=a.readString(),e.audioPath=a.readString(),e.audioPath&&(e.volume=a.readFloat(),e.balance=a.readFloat()),r.events.push(e)}h=a.readInt(!0);for(let t=0;t<h;t++){let t=a.readString();if(!t)throw new Error("Animatio name must not be null.");r.animations.push(this.readAnimation(a,t,r))}return r}readSkin(t,e,s,i){let r=null,a=0;if(s){if(a=t.readInt(!0),0==a)return null;r=new se("default")}else{let s=t.readStringRef();if(!s)throw new Error("Skin name must not be null.");r=new se(s),r.bones.length=t.readInt(!0);for(let s=0,i=r.bones.length;s<i;s++)r.bones[s]=e.bones[t.readInt(!0)];for(let s=0,i=t.readInt(!0);s<i;s++)r.constraints.push(e.ikConstraints[t.readInt(!0)]);for(let s=0,i=t.readInt(!0);s<i;s++)r.constraints.push(e.transformConstraints[t.readInt(!0)]);for(let s=0,i=t.readInt(!0);s<i;s++)r.constraints.push(e.pathConstraints[t.readInt(!0)]);a=t.readInt(!0)}for(let s=0;s<a;s++){let s=t.readInt(!0);for(let a=0,n=t.readInt(!0);a<n;a++){let a=t.readStringRef();if(!a)throw new Error("Attachment name must not be null");let n=this.readAttachment(t,e,r,s,a,i);n&&r.setAttachment(s,a,n)}}return r}readAttachment(t,s,r,a,n,o){let l=this.scale,h=t.readStringRef();switch(h||(h=n),t.readByte()){case Ft.Region:{let s=t.readStringRef(),i=t.readFloat(),a=t.readFloat(),n=t.readFloat(),o=t.readFloat(),c=t.readFloat(),d=t.readFloat(),u=t.readFloat(),m=t.readInt32(),g=this.readSequence(t);s||(s=h);let f=this.attachmentLoader.newRegionAttachment(r,h,s,g);return f?(f.path=s,f.x=a*l,f.y=n*l,f.scaleX=o,f.scaleY=c,f.rotation=i,f.width=d*l,f.height=u*l,e.rgba8888ToColor(f.color,m),f.sequence=g,null==g&&f.updateRegion(),f):null}case Ft.BoundingBox:{let s=t.readInt(!0),i=this.readVertices(t,s),a=o?t.readInt32():0,n=this.attachmentLoader.newBoundingBoxAttachment(r,h);return n?(n.worldVerticesLength=s<<1,n.vertices=i.vertices,n.bones=i.bones,o&&e.rgba8888ToColor(n.color,a),n):null}case Ft.Mesh:{let s=t.readStringRef(),i=t.readInt32(),a=t.readInt(!0),n=this.readFloatArray(t,a<<1,1),c=this.readShortArray(t),d=this.readVertices(t,a),u=t.readInt(!0),m=this.readSequence(t),g=[],f=0,p=0;o&&(g=this.readShortArray(t),f=t.readFloat(),p=t.readFloat()),s||(s=h);let x=this.attachmentLoader.newMeshAttachment(r,h,s,m);return x?(x.path=s,e.rgba8888ToColor(x.color,i),x.bones=d.bones,x.vertices=d.vertices,x.worldVerticesLength=a<<1,x.triangles=c,x.regionUVs=n,null==m&&x.updateRegion(),x.hullLength=u<<1,x.sequence=m,o&&(x.edges=g,x.width=f*l,x.height=p*l),x):null}case Ft.LinkedMesh:{let s=t.readStringRef(),i=t.readInt32(),n=t.readStringRef(),c=t.readStringRef(),d=t.readBoolean(),u=this.readSequence(t),m=0,g=0;o&&(m=t.readFloat(),g=t.readFloat()),s||(s=h);let f=this.attachmentLoader.newMeshAttachment(r,h,s,u);return f?(f.path=s,e.rgba8888ToColor(f.color,i),f.sequence=u,o&&(f.width=m*l,f.height=g*l),this.linkedMeshes.push(new oe(f,n,a,c,d)),f):null}case Ft.Path:{let s=t.readBoolean(),a=t.readBoolean(),n=t.readInt(!0),c=this.readVertices(t,n),d=i.newArray(n/3,0);for(let e=0,s=d.length;e<s;e++)d[e]=t.readFloat()*l;let u=o?t.readInt32():0,m=this.attachmentLoader.newPathAttachment(r,h);return m?(m.closed=s,m.constantSpeed=a,m.worldVerticesLength=n<<1,m.vertices=c.vertices,m.bones=c.bones,m.lengths=d,o&&e.rgba8888ToColor(m.color,u),m):null}case Ft.Point:{let s=t.readFloat(),i=t.readFloat(),a=t.readFloat(),n=o?t.readInt32():0,c=this.attachmentLoader.newPointAttachment(r,h);return c?(c.x=i*l,c.y=a*l,c.rotation=s,o&&e.rgba8888ToColor(c.color,n),c):null}case Ft.Clipping:{let i=t.readInt(!0),a=t.readInt(!0),n=this.readVertices(t,a),l=o?t.readInt32():0,c=this.attachmentLoader.newClippingAttachment(r,h);return c?(c.endSlot=s.slots[i],c.worldVerticesLength=a<<1,c.vertices=n.vertices,c.bones=n.bones,o&&e.rgba8888ToColor(c.color,l),c):null}}return null}readSequence(t){if(!t.readBoolean())return null;let e=new l(t.readInt(!0));return e.start=t.readInt(!0),e.digits=t.readInt(!0),e.setupIndex=t.readInt(!0),e}readVertices(t,e){let s=this.scale,r=e<<1,a=new le;if(!t.readBoolean())return a.vertices=this.readFloatArray(t,r,s),a;let n=new Array,o=new Array;for(let i=0;i<e;i++){let e=t.readInt(!0);o.push(e);for(let i=0;i<e;i++)o.push(t.readInt(!0)),n.push(t.readFloat()*s),n.push(t.readFloat()*s),n.push(t.readFloat())}return a.vertices=i.toFloatArray(n),a.bones=o,a}readFloatArray(t,e,s){let i=new Array(e);if(1==s)for(let s=0;s<e;s++)i[s]=t.readFloat();else for(let r=0;r<e;r++)i[r]=t.readFloat()*s;return i}readShortArray(t){let e=t.readInt(!0),s=new Array(e);for(let i=0;i<e;i++)s[i]=t.readShort();return s}readAnimation(t,s,r){t.readInt(!0);let a=new Array,n=this.scale;new e,new e;for(let e=0,s=t.readInt(!0);e<s;e++){let e=t.readInt(!0);for(let s=0,i=t.readInt(!0);s<i;s++){let s=t.readByte(),i=t.readInt(!0),r=i-1;switch(s){case ke:{let s=new Z(i,e);for(let e=0;e<i;e++)s.setFrame(e,t.readFloat(),t.readStringRef());a.push(s);break}case Ae:{let s=t.readInt(!0),n=new H(i,s,e),o=t.readFloat(),l=t.readUnsignedByte()/255,h=t.readUnsignedByte()/255,c=t.readUnsignedByte()/255,d=t.readUnsignedByte()/255;for(let e=0,s=0;n.setFrame(e,o,l,h,c,d),e!=r;e++){let i=t.readFloat(),r=t.readUnsignedByte()/255,a=t.readUnsignedByte()/255,u=t.readUnsignedByte()/255,m=t.readUnsignedByte()/255;switch(t.readByte()){case Pe:n.setStepped(e);break;case Le:de(t,n,s++,e,0,o,i,l,r,1),de(t,n,s++,e,1,o,i,h,a,1),de(t,n,s++,e,2,o,i,c,u,1),de(t,n,s++,e,3,o,i,d,m,1)}o=i,l=r,h=a,c=u,d=m}a.push(n);break}case Se:{let s=t.readInt(!0),n=new j(i,s,e),o=t.readFloat(),l=t.readUnsignedByte()/255,h=t.readUnsignedByte()/255,c=t.readUnsignedByte()/255;for(let e=0,s=0;n.setFrame(e,o,l,h,c),e!=r;e++){let i=t.readFloat(),r=t.readUnsignedByte()/255,a=t.readUnsignedByte()/255,d=t.readUnsignedByte()/255;switch(t.readByte()){case Pe:n.setStepped(e);break;case Le:de(t,n,s++,e,0,o,i,l,r,1),de(t,n,s++,e,1,o,i,h,a,1),de(t,n,s++,e,2,o,i,c,d,1)}o=i,l=r,h=a,c=d}a.push(n);break}case Ie:{let s=t.readInt(!0),n=new Q(i,s,e),o=t.readFloat(),l=t.readUnsignedByte()/255,h=t.readUnsignedByte()/255,c=t.readUnsignedByte()/255,d=t.readUnsignedByte()/255,u=t.readUnsignedByte()/255,m=t.readUnsignedByte()/255,g=t.readUnsignedByte()/255;for(let e=0,s=0;n.setFrame(e,o,l,h,c,d,u,m,g),e!=r;e++){let i=t.readFloat(),r=t.readUnsignedByte()/255,a=t.readUnsignedByte()/255,f=t.readUnsignedByte()/255,p=t.readUnsignedByte()/255,x=t.readUnsignedByte()/255,w=t.readUnsignedByte()/255,b=t.readUnsignedByte()/255;switch(t.readByte()){case Pe:n.setStepped(e);break;case Le:de(t,n,s++,e,0,o,i,l,r,1),de(t,n,s++,e,1,o,i,h,a,1),de(t,n,s++,e,2,o,i,c,f,1),de(t,n,s++,e,3,o,i,d,p,1),de(t,n,s++,e,4,o,i,u,x,1),de(t,n,s++,e,5,o,i,m,w,1),de(t,n,s++,e,6,o,i,g,b,1)}o=i,l=r,h=a,c=f,d=p,u=x,m=w,g=b}a.push(n);break}case Ce:{let s=t.readInt(!0),n=new J(i,s,e),o=t.readFloat(),l=t.readUnsignedByte()/255,h=t.readUnsignedByte()/255,c=t.readUnsignedByte()/255,d=t.readUnsignedByte()/255,u=t.readUnsignedByte()/255,m=t.readUnsignedByte()/255;for(let e=0,s=0;n.setFrame(e,o,l,h,c,d,u,m),e!=r;e++){let i=t.readFloat(),r=t.readUnsignedByte()/255,a=t.readUnsignedByte()/255,g=t.readUnsignedByte()/255,f=t.readUnsignedByte()/255,p=t.readUnsignedByte()/255,x=t.readUnsignedByte()/255;switch(t.readByte()){case Pe:n.setStepped(e);break;case Le:de(t,n,s++,e,0,o,i,l,r,1),de(t,n,s++,e,1,o,i,h,a,1),de(t,n,s++,e,2,o,i,c,g,1),de(t,n,s++,e,3,o,i,d,f,1),de(t,n,s++,e,4,o,i,u,p,1),de(t,n,s++,e,5,o,i,m,x,1)}o=i,l=r,h=a,c=g,d=f,u=p,m=x}a.push(n);break}case Me:{let s=new K(i,t.readInt(!0),e),n=t.readFloat(),o=t.readUnsignedByte()/255;for(let e=0,i=0;s.setFrame(e,n,o),e!=r;e++){let r=t.readFloat(),a=t.readUnsignedByte()/255;switch(t.readByte()){case Pe:s.setStepped(e);break;case Le:de(t,s,i++,e,0,n,r,o,a,1)}n=r,o=a}a.push(s)}}}}for(let e=0,s=t.readInt(!0);e<s;e++){let e=t.readInt(!0);for(let s=0,i=t.readInt(!0);s<i;s++){let s=t.readByte(),i=t.readInt(!0),r=t.readInt(!0);switch(s){case ue:a.push(he(t,new V(i,r,e),1));break;case me:a.push(ce(t,new D(i,r,e),n));break;case ge:a.push(he(t,new N(i,r,e),n));break;case fe:a.push(he(t,new U(i,r,e),n));break;case pe:a.push(ce(t,new O(i,r,e),1));break;case xe:a.push(he(t,new W(i,r,e),1));break;case we:a.push(he(t,new z(i,r,e),1));break;case be:a.push(ce(t,new q(i,r,e),1));break;case ye:a.push(he(t,new $(i,r,e),1));break;case ve:a.push(he(t,new G(i,r,e),1))}}}for(let e=0,s=t.readInt(!0);e<s;e++){let e=t.readInt(!0),s=t.readInt(!0),i=s-1,r=new it(s,t.readInt(!0),e),o=t.readFloat(),l=t.readFloat(),h=t.readFloat()*n;for(let e=0,s=0;r.setFrame(e,o,l,h,t.readByte(),t.readBoolean(),t.readBoolean()),e!=i;e++){let i=t.readFloat(),a=t.readFloat(),c=t.readFloat()*n;switch(t.readByte()){case Pe:r.setStepped(e);break;case Le:de(t,r,s++,e,0,o,i,l,a,1),de(t,r,s++,e,1,o,i,h,c,n)}o=i,l=a,h=c}a.push(r)}for(let e=0,s=t.readInt(!0);e<s;e++){let e=t.readInt(!0),s=t.readInt(!0),i=s-1,r=new rt(s,t.readInt(!0),e),n=t.readFloat(),o=t.readFloat(),l=t.readFloat(),h=t.readFloat(),c=t.readFloat(),d=t.readFloat(),u=t.readFloat();for(let e=0,s=0;r.setFrame(e,n,o,l,h,c,d,u),e!=i;e++){let i=t.readFloat(),a=t.readFloat(),m=t.readFloat(),g=t.readFloat(),f=t.readFloat(),p=t.readFloat(),x=t.readFloat();switch(t.readByte()){case Pe:r.setStepped(e);break;case Le:de(t,r,s++,e,0,n,i,o,a,1),de(t,r,s++,e,1,n,i,l,m,1),de(t,r,s++,e,2,n,i,h,g,1),de(t,r,s++,e,3,n,i,c,f,1),de(t,r,s++,e,4,n,i,d,p,1),de(t,r,s++,e,5,n,i,u,x,1)}n=i,o=a,l=m,h=g,c=f,d=p,u=x}a.push(r)}for(let e=0,s=t.readInt(!0);e<s;e++){let e=t.readInt(!0),s=r.pathConstraints[e];for(let i=0,r=t.readInt(!0);i<r;i++)switch(t.readByte()){case Ee:a.push(he(t,new at(t.readInt(!0),t.readInt(!0),e),s.positionMode==Mt.Fixed?n:1));break;case Fe:a.push(he(t,new nt(t.readInt(!0),t.readInt(!0),e),s.spacingMode==Rt.Length||s.spacingMode==Rt.Fixed?n:1));break;case Ye:let i=new ot(t.readInt(!0),t.readInt(!0),e),r=t.readFloat(),o=t.readFloat(),l=t.readFloat(),h=t.readFloat();for(let e=0,s=0,a=i.getFrameCount()-1;i.setFrame(e,r,o,l,h),e!=a;e++){let a=t.readFloat(),n=t.readFloat(),c=t.readFloat(),d=t.readFloat();switch(t.readByte()){case Pe:i.setStepped(e);break;case Le:de(t,i,s++,e,0,r,a,o,n,1),de(t,i,s++,e,1,r,a,l,c,1),de(t,i,s++,e,2,r,a,h,d,1)}r=a,o=n,l=c,h=d}a.push(i)}}for(let e=0,s=t.readInt(!0);e<s;e++){let e=r.skins[t.readInt(!0)];for(let s=0,r=t.readInt(!0);s<r;s++){let s=t.readInt(!0);for(let r=0,o=t.readInt(!0);r<o;r++){let r=t.readStringRef();if(!r)throw new Error("attachmentName must not be null.");let o=e.getAttachment(s,r),l=t.readByte(),h=t.readInt(!0),d=h-1;switch(l){case Re:{let e=o,r=e.bones,l=e.vertices,c=r?l.length/3*2:l.length,u=t.readInt(!0),m=new tt(h,u,s,e),g=t.readFloat();for(let e=0,s=0;;e++){let a,o=t.readInt(!0);if(0==o)a=r?i.newFloatArray(c):l;else{a=i.newFloatArray(c);let e=t.readInt(!0);if(o+=e,1==n)for(let s=e;s<o;s++)a[s]=t.readFloat();else for(let s=e;s<o;s++)a[s]=t.readFloat()*n;if(!r)for(let t=0,e=a.length;t<e;t++)a[t]+=l[t]}if(m.setFrame(e,g,a),e==d)break;let h=t.readFloat();switch(t.readByte()){case Pe:m.setStepped(e);break;case Le:de(t,m,s++,e,0,g,h,0,1,1)}g=h}a.push(m);break}case Te:{let e=new lt(h,s,o);for(let s=0;s<h;s++){let i=t.readFloat(),r=t.readInt32();e.setFrame(s,i,c[15&r],r>>4,t.readFloat())}a.push(e);break}}}}}let o=t.readInt(!0);if(o>0){let e=new st(o),s=r.slots.length;for(let r=0;r<o;r++){let a=t.readFloat(),n=t.readInt(!0),o=i.newArray(s,0);for(let t=s-1;t>=0;t--)o[t]=-1;let l=i.newArray(s-n,0),h=0,c=0;for(let e=0;e<n;e++){let e=t.readInt(!0);for(;h!=e;)l[c++]=h++;o[h+t.readInt(!0)]=h++}for(;h<s;)l[c++]=h++;for(let t=s-1;t>=0;t--)-1==o[t]&&(o[t]=l[--c]);e.setFrame(r,a,o)}a.push(e)}let l=t.readInt(!0);if(l>0){let e=new et(l);for(let s=0;s<l;s++){let i=t.readFloat(),a=r.events[t.readInt(!0)],n=new Qt(i,a);n.intValue=t.readInt(!1),n.floatValue=t.readFloat(),n.stringValue=t.readBoolean()?t.readString():a.stringValue,n.data.audioPath&&(n.volume=t.readFloat(),n.balance=t.readFloat()),e.setFrame(s,n)}a.push(e)}let h=0;for(let t=0,e=a.length;t<e;t++)h=Math.max(h,a[t].getDuration());return new d(s,a,h)}}class ne{strings;index;buffer;constructor(t,e=new Array,s=0,i=new DataView(t.buffer)){this.strings=e,this.index=s,this.buffer=i}readByte(){return this.buffer.getInt8(this.index++)}readUnsignedByte(){return this.buffer.getUint8(this.index++)}readShort(){let t=this.buffer.getInt16(this.index);return this.index+=2,t}readInt32(){let t=this.buffer.getInt32(this.index);return this.index+=4,t}readInt(t){let e=this.readByte(),s=127&e;return 0!=(128&e)&&(e=this.readByte(),s|=(127&e)<<7,0!=(128&e)&&(e=this.readByte(),s|=(127&e)<<14,0!=(128&e)&&(e=this.readByte(),s|=(127&e)<<21,0!=(128&e)&&(e=this.readByte(),s|=(127&e)<<28)))),t?s:s>>>1^-(1&s)}readStringRef(){let t=this.readInt(!0);return 0==t?null:this.strings[t-1]}readString(){let t=this.readInt(!0);switch(t){case 0:return null;case 1:return""}t--;let e="";for(let s=0;s<t;){let t=this.readUnsignedByte();switch(t>>4){case 12:case 13:e+=String.fromCharCode((31&t)<<6|63&this.readByte()),s+=2;break;case 14:e+=String.fromCharCode((15&t)<<12|(63&this.readByte())<<6|63&this.readByte()),s+=3;break;default:e+=String.fromCharCode(t),s++}}return e}readFloat(){let t=this.buffer.getFloat32(this.index);return this.index+=4,t}readBoolean(){return 0!=this.readByte()}}class oe{parent;skin;slotIndex;mesh;inheritTimeline;constructor(t,e,s,i,r){this.mesh=t,this.skin=e,this.slotIndex=s,this.parent=i,this.inheritTimeline=r}}class le{bones;vertices;constructor(t=null,e=null){this.bones=t,this.vertices=e}}function he(t,e,s){let i=t.readFloat(),r=t.readFloat()*s;for(let a=0,n=0,o=e.getFrameCount()-1;e.setFrame(a,i,r),a!=o;a++){let o=t.readFloat(),l=t.readFloat()*s;switch(t.readByte()){case Pe:e.setStepped(a);break;case Le:de(t,e,n++,a,0,i,o,r,l,s)}i=o,r=l}return e}function ce(t,e,s){let i=t.readFloat(),r=t.readFloat()*s,a=t.readFloat()*s;for(let n=0,o=0,l=e.getFrameCount()-1;e.setFrame(n,i,r,a),n!=l;n++){let l=t.readFloat(),h=t.readFloat()*s,c=t.readFloat()*s;switch(t.readByte()){case Pe:e.setStepped(n);break;case Le:de(t,e,o++,n,0,i,l,r,h,s),de(t,e,o++,n,1,i,l,a,c,s)}i=l,r=h,a=c}return e}function de(t,e,s,i,r,a,n,o,l,h){e.setBezier(s,i,r,a,o,t.readFloat(),t.readFloat()*h,t.readFloat(),t.readFloat()*h,n,l)}!function(t){t[t.Region=0]="Region",t[t.BoundingBox=1]="BoundingBox",t[t.Mesh=2]="Mesh",t[t.LinkedMesh=3]="LinkedMesh",t[t.Path=4]="Path",t[t.Point=5]="Point",t[t.Clipping=6]="Clipping"}(Ft||(Ft={}));const ue=0,me=1,ge=2,fe=3,pe=4,xe=5,we=6,be=7,ye=8,ve=9,ke=0,Ae=1,Se=2,Ie=3,Ce=4,Me=5,Re=0,Te=1,Ee=0,Fe=1,Ye=2,Pe=1,Le=2;class Xe{minX=0;minY=0;maxX=0;maxY=0;boundingBoxes=new Array;polygons=new Array;polygonPool=new r((()=>i.newFloatArray(16)));update(t,e){if(!t)throw new Error("skeleton cannot be null.");let s=this.boundingBoxes,r=this.polygons,a=this.polygonPool,n=t.slots,o=n.length;s.length=0,a.freeAll(r),r.length=0;for(let t=0;t<o;t++){let e=n[t];if(!e.bone.active)continue;let o=e.getAttachment();if(o instanceof vt){let t=o;s.push(t);let n=a.obtain();n.length!=t.worldVerticesLength&&(n=i.newFloatArray(t.worldVerticesLength)),r.push(n),t.computeWorldVertices(e,0,t.worldVerticesLength,n,0,2)}}e?this.aabbCompute():(this.minX=Number.POSITIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.maxY=Number.NEGATIVE_INFINITY)}aabbCompute(){let t=Number.POSITIVE_INFINITY,e=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY,i=Number.NEGATIVE_INFINITY,r=this.polygons;for(let a=0,n=r.length;a<n;a++){let n=r[a],o=n;for(let r=0,a=n.length;r<a;r+=2){let a=o[r],n=o[r+1];t=Math.min(t,a),e=Math.min(e,n),s=Math.max(s,a),i=Math.max(i,n)}}this.minX=t,this.minY=e,this.maxX=s,this.maxY=i}aabbContainsPoint(t,e){return t>=this.minX&&t<=this.maxX&&e>=this.minY&&e<=this.maxY}aabbIntersectsSegment(t,e,s,i){let r=this.minX,a=this.minY,n=this.maxX,o=this.maxY;if(t<=r&&s<=r||e<=a&&i<=a||t>=n&&s>=n||e>=o&&i>=o)return!1;let l=(i-e)/(s-t),h=l*(r-t)+e;if(h>a&&h<o)return!0;if(h=l*(n-t)+e,h>a&&h<o)return!0;let c=(a-e)/l+t;return c>r&&c<n||(c=(o-e)/l+t,c>r&&c<n)}aabbIntersectsSkeleton(t){return this.minX<t.maxX&&this.maxX>t.minX&&this.minY<t.maxY&&this.maxY>t.minY}containsPoint(t,e){let s=this.polygons;for(let i=0,r=s.length;i<r;i++)if(this.containsPointPolygon(s[i],t,e))return this.boundingBoxes[i];return null}containsPointPolygon(t,e,s){let i=t,r=t.length,a=r-2,n=!1;for(let t=0;t<r;t+=2){let r=i[t+1],o=i[a+1];if(r<s&&o>=s||o<s&&r>=s){let l=i[t];l+(s-r)/(o-r)*(i[a]-l)<e&&(n=!n)}a=t}return n}intersectsSegment(t,e,s,i){let r=this.polygons;for(let a=0,n=r.length;a<n;a++)if(this.intersectsSegmentPolygon(r[a],t,e,s,i))return this.boundingBoxes[a];return null}intersectsSegmentPolygon(t,e,s,i,r){let a=t,n=t.length,o=e-i,l=s-r,h=e*r-s*i,c=a[n-2],d=a[n-1];for(let t=0;t<n;t+=2){let n=a[t],u=a[t+1],m=c*u-d*n,g=c-n,f=d-u,p=o*f-l*g,x=(h*g-o*m)/p;if((x>=c&&x<=n||x>=n&&x<=c)&&(x>=e&&x<=i||x>=i&&x<=e)){let t=(h*f-l*m)/p;if((t>=d&&t<=u||t>=u&&t<=d)&&(t>=s&&t<=r||t>=r&&t<=s))return!0}c=n,d=u}return!1}getPolygon(t){if(!t)throw new Error("boundingBox cannot be null.");let e=this.boundingBoxes.indexOf(t);return-1==e?null:this.polygons[e]}getWidth(){return this.maxX-this.minX}getHeight(){return this.maxY-this.minY}}class Be{convexPolygons=new Array;convexPolygonsIndices=new Array;indicesArray=new Array;isConcaveArray=new Array;triangles=new Array;polygonPool=new r((()=>new Array));polygonIndicesPool=new r((()=>new Array));triangulate(t){let e=t,s=t.length>>1,i=this.indicesArray;i.length=0;for(let t=0;t<s;t++)i[t]=t;let r=this.isConcaveArray;r.length=0;for(let t=0,a=s;t<a;++t)r[t]=Be.isConcave(t,s,e,i);let a=this.triangles;for(a.length=0;s>3;){let t=s-1,n=0,o=1;for(;;){t:if(!r[n]){let a=i[t]<<1,l=i[n]<<1,h=i[o]<<1,c=e[a],d=e[a+1],u=e[l],m=e[l+1],g=e[h],f=e[h+1];for(let a=(o+1)%s;a!=t;a=(a+1)%s){if(!r[a])continue;let t=i[a]<<1,s=e[t],n=e[t+1];if(Be.positiveArea(g,f,c,d,s,n)&&Be.positiveArea(c,d,u,m,s,n)&&Be.positiveArea(u,m,g,f,s,n))break t}break}if(0==o){do{if(!r[n])break;n--}while(n>0);break}t=n,n=o,o=(o+1)%s}a.push(i[(s+n-1)%s]),a.push(i[n]),a.push(i[(n+1)%s]),i.splice(n,1),r.splice(n,1),s--;let l=(s+n-1)%s,h=n==s?0:n;r[l]=Be.isConcave(l,s,e,i),r[h]=Be.isConcave(h,s,e,i)}return 3==s&&(a.push(i[2]),a.push(i[0]),a.push(i[1])),a}decompose(t,e){let s=t,i=this.convexPolygons;this.polygonPool.freeAll(i),i.length=0;let r=this.convexPolygonsIndices;this.polygonIndicesPool.freeAll(r),r.length=0;let a=this.polygonIndicesPool.obtain();a.length=0;let n=this.polygonPool.obtain();n.length=0;let o=-1,l=0;for(let t=0,h=e.length;t<h;t+=3){let h=e[t]<<1,c=e[t+1]<<1,d=e[t+2]<<1,u=s[h],m=s[h+1],g=s[c],f=s[c+1],p=s[d],x=s[d+1],w=!1;if(o==h){let t=n.length-4,e=Be.winding(n[t],n[t+1],n[t+2],n[t+3],p,x),s=Be.winding(p,x,n[0],n[1],n[2],n[3]);e==l&&s==l&&(n.push(p),n.push(x),a.push(d),w=!0)}w||(n.length>0?(i.push(n),r.push(a)):(this.polygonPool.free(n),this.polygonIndicesPool.free(a)),n=this.polygonPool.obtain(),n.length=0,n.push(u),n.push(m),n.push(g),n.push(f),n.push(p),n.push(x),a=this.polygonIndicesPool.obtain(),a.length=0,a.push(h),a.push(c),a.push(d),l=Be.winding(u,m,g,f,p,x),o=h)}n.length>0&&(i.push(n),r.push(a));for(let t=0,e=i.length;t<e;t++){if(a=r[t],0==a.length)continue;let s=a[0],o=a[a.length-1];n=i[t];let l=n.length-4,h=n[l],c=n[l+1],d=n[l+2],u=n[l+3],m=n[0],g=n[1],f=n[2],p=n[3],x=Be.winding(h,c,d,u,m,g);for(let l=0;l<e;l++){if(l==t)continue;let e=r[l];if(3!=e.length)continue;let w=e[0],b=e[1],y=e[2],v=i[l],k=v[v.length-2],A=v[v.length-1];if(w!=s||b!=o)continue;let S=Be.winding(h,c,d,u,k,A),I=Be.winding(k,A,m,g,f,p);S==x&&I==x&&(v.length=0,e.length=0,n.push(k),n.push(A),a.push(y),h=d,c=u,d=k,u=A,l=0)}}for(let t=i.length-1;t>=0;t--)n=i[t],0==n.length&&(i.splice(t,1),this.polygonPool.free(n),a=r[t],r.splice(t,1),this.polygonIndicesPool.free(a));return i}static isConcave(t,e,s,i){let r=i[(e+t-1)%e]<<1,a=i[t]<<1,n=i[(t+1)%e]<<1;return!this.positiveArea(s[r],s[r+1],s[a],s[a+1],s[n],s[n+1])}static positiveArea(t,e,s,i,r,a){return t*(a-i)+s*(e-a)+r*(i-e)>=0}static winding(t,e,s,i,r,a){let n=s-t,o=i-e;return r*o-a*n+n*e-t*o>=0?1:-1}}class _e{triangulator=new Be;clippingPolygon=new Array;clipOutput=new Array;clippedVertices=new Array;clippedTriangles=new Array;scratch=new Array;clipAttachment=null;clippingPolygons=null;clipStart(t,e){if(this.clipAttachment)return 0;this.clipAttachment=e;let s=e.worldVerticesLength,r=i.setArraySize(this.clippingPolygon,s);e.computeWorldVertices(t,0,s,r,0,2);let a=this.clippingPolygon;_e.makeClockwise(a);let n=this.clippingPolygons=this.triangulator.decompose(a,this.triangulator.triangulate(a));for(let t=0,e=n.length;t<e;t++){let e=n[t];_e.makeClockwise(e),e.push(e[0]),e.push(e[1])}return n.length}clipEndWithSlot(t){this.clipAttachment&&this.clipAttachment.endSlot==t.data&&this.clipEnd()}clipEnd(){this.clipAttachment&&(this.clipAttachment=null,this.clippingPolygons=null,this.clippedVertices.length=0,this.clippedTriangles.length=0,this.clippingPolygon.length=0)}isClipping(){return null!=this.clipAttachment}clipTriangles(t,e,s,r,a,n,o,l){let h=this.clipOutput,c=this.clippedVertices,d=this.clippedTriangles,u=this.clippingPolygons,m=u.length,g=l?12:8,f=0;c.length=0,d.length=0;t:for(let e=0;e<r;e+=3){let r=s[e]<<1,p=t[r],x=t[r+1],w=a[r],b=a[r+1];r=s[e+1]<<1;let y=t[r],v=t[r+1],k=a[r],A=a[r+1];r=s[e+2]<<1;let S=t[r],I=t[r+1],C=a[r],M=a[r+1];for(let t=0;t<m;t++){let e=c.length;if(!this.clip(p,x,y,v,S,I,u[t],h)){let t=i.setArraySize(c,e+3*g);t[e]=p,t[e+1]=x,t[e+2]=n.r,t[e+3]=n.g,t[e+4]=n.b,t[e+5]=n.a,l?(t[e+6]=w,t[e+7]=b,t[e+8]=o.r,t[e+9]=o.g,t[e+10]=o.b,t[e+11]=o.a,t[e+12]=y,t[e+13]=v,t[e+14]=n.r,t[e+15]=n.g,t[e+16]=n.b,t[e+17]=n.a,t[e+18]=k,t[e+19]=A,t[e+20]=o.r,t[e+21]=o.g,t[e+22]=o.b,t[e+23]=o.a,t[e+24]=S,t[e+25]=I,t[e+26]=n.r,t[e+27]=n.g,t[e+28]=n.b,t[e+29]=n.a,t[e+30]=C,t[e+31]=M,t[e+32]=o.r,t[e+33]=o.g,t[e+34]=o.b,t[e+35]=o.a):(t[e+6]=w,t[e+7]=b,t[e+8]=y,t[e+9]=v,t[e+10]=n.r,t[e+11]=n.g,t[e+12]=n.b,t[e+13]=n.a,t[e+14]=k,t[e+15]=A,t[e+16]=S,t[e+17]=I,t[e+18]=n.r,t[e+19]=n.g,t[e+20]=n.b,t[e+21]=n.a,t[e+22]=C,t[e+23]=M),e=d.length;let s=i.setArraySize(d,e+3);s[e]=f,s[e+1]=f+1,s[e+2]=f+2,f+=3;continue t}{let t=h.length;if(0==t)continue;let s=v-I,r=S-y,a=p-S,u=I-x,m=1/(s*a+r*(x-I)),R=t>>1,T=this.clipOutput,E=i.setArraySize(c,e+R*g);for(let i=0;i<t;i+=2){let t=T[i],h=T[i+1];E[e]=t,E[e+1]=h,E[e+2]=n.r,E[e+3]=n.g,E[e+4]=n.b,E[e+5]=n.a;let c=t-S,d=h-I,f=(s*c+r*d)*m,p=(u*c+a*d)*m,x=1-f-p;E[e+6]=w*f+k*p+C*x,E[e+7]=b*f+A*p+M*x,l&&(E[e+8]=o.r,E[e+9]=o.g,E[e+10]=o.b,E[e+11]=o.a),e+=g}e=d.length;let F=i.setArraySize(d,e+3*(R-2));R--;for(let t=1;t<R;t++)F[e]=f,F[e+1]=f+t,F[e+2]=f+t+1,e+=3;f+=R+1}}}}clip(t,e,s,i,r,a,n,o){let l,h=o,c=!1;n.length%4>=2?(l=o,o=this.scratch):l=this.scratch,l.length=0,l.push(t),l.push(e),l.push(s),l.push(i),l.push(r),l.push(a),l.push(t),l.push(e),o.length=0;let d=n,u=n.length-4;for(let t=0;;t+=2){let e=d[t],s=d[t+1],i=d[t+2],r=d[t+3],a=e-i,n=s-r,m=l,g=l.length-2,f=o.length;for(let t=0;t<g;t+=2){let l=m[t],h=m[t+1],d=m[t+2],u=m[t+3],g=a*(u-r)-n*(d-i)>0;if(a*(h-r)-n*(l-i)>0){if(g){o.push(d),o.push(u);continue}let t=u-h,a=d-l,n=t*(i-e)-a*(r-s);if(Math.abs(n)>1e-6){let c=(a*(s-h)-t*(e-l))/n;o.push(e+(i-e)*c),o.push(s+(r-s)*c)}else o.push(e),o.push(s)}else if(g){let t=u-h,a=d-l,n=t*(i-e)-a*(r-s);if(Math.abs(n)>1e-6){let c=(a*(s-h)-t*(e-l))/n;o.push(e+(i-e)*c),o.push(s+(r-s)*c)}else o.push(e),o.push(s);o.push(d),o.push(u)}c=!0}if(f==o.length)return h.length=0,!0;if(o.push(o[0]),o.push(o[1]),t==u)break;let p=o;(o=l).length=0,l=p}if(h!=o){h.length=0;for(let t=0,e=o.length-2;t<e;t++)h[t]=o[t]}else h.length=h.length-2;return c}static makeClockwise(t){let e=t,s=t.length,i=e[s-2]*e[1]-e[0]*e[s-1],r=0,a=0,n=0,o=0;for(let t=0,l=s-3;t<l;t+=2)r=e[t],a=e[t+1],n=e[t+2],o=e[t+3],i+=r*o-n*a;if(!(i<0))for(let t=0,i=s-2,r=s>>1;t<r;t+=2){let s=e[t],r=e[t+1],a=i-t;e[t]=e[a],e[t+1]=e[a+1],e[a]=s,e[a+1]=r}}}class Ve{attachmentLoader;scale=1;linkedMeshes=new Array;constructor(t){this.attachmentLoader=t}readSkeletonData(t){let s=this.scale,r=new te,a="string"==typeof t?JSON.parse(t):t,n=a.skeleton;if(n&&(r.hash=n.hash,r.version=n.spine,r.x=n.x,r.y=n.y,r.width=n.width,r.height=n.height,r.fps=n.fps,r.imagesPath=n.images),a.bones)for(let t=0;t<a.bones.length;t++){let e=a.bones[t],n=null,o=We(e,"parent",null);o&&(n=r.findBone(o));let l=new Ot(r.bones.length,e.name,n);l.length=We(e,"length",0)*s,l.x=We(e,"x",0)*s,l.y=We(e,"y",0)*s,l.rotation=We(e,"rotation",0),l.scaleX=We(e,"scaleX",1),l.scaleY=We(e,"scaleY",1),l.shearX=We(e,"shearX",0),l.shearY=We(e,"shearY",0),l.transformMode=i.enumValue(Ct,We(e,"transform","Normal")),l.skinRequired=We(e,"skin",!1);let h=We(e,"color",null);h&&l.color.setFromString(h),r.bones.push(l)}if(a.slots)for(let t=0;t<a.slots.length;t++){let s=a.slots[t],n=r.findBone(s.bone);if(!n)throw new Error(`Couldn't find bone ${s.bone} for slot ${s.name}`);let o=new ie(r.slots.length,s.name,n),l=We(s,"color",null);l&&o.color.setFromString(l);let h=We(s,"dark",null);h&&(o.darkColor=e.fromString(h)),o.attachmentName=We(s,"attachment",null),o.blendMode=i.enumValue(Et,We(s,"blend","normal")),r.slots.push(o)}if(a.ik)for(let t=0;t<a.ik.length;t++){let e=a.ik[t],i=new Zt(e.name);i.order=We(e,"order",0),i.skinRequired=We(e,"skin",!1);for(let t=0;t<e.bones.length;t++){let s=r.findBone(e.bones[t]);if(!s)throw new Error(`Couldn't find bone ${e.bones[t]} for IK constraint ${e.name}.`);i.bones.push(s)}let n=r.findBone(e.target);if(!n)throw new Error(`Couldn't find target bone ${e.target} for IK constraint ${e.name}.`);i.target=n,i.mix=We(e,"mix",1),i.softness=We(e,"softness",0)*s,i.bendDirection=We(e,"bendPositive",!0)?1:-1,i.compress=We(e,"compress",!1),i.stretch=We(e,"stretch",!1),i.uniform=We(e,"uniform",!1),r.ikConstraints.push(i)}if(a.transform)for(let t=0;t<a.transform.length;t++){let e=a.transform[t],i=new re(e.name);i.order=We(e,"order",0),i.skinRequired=We(e,"skin",!1);for(let t=0;t<e.bones.length;t++){let s=e.bones[t],a=r.findBone(s);if(!a)throw new Error(`Couldn't find bone ${s} for transform constraint ${e.name}.`);i.bones.push(a)}let n=e.target,o=r.findBone(n);if(!o)throw new Error(`Couldn't find target bone ${n} for transform constraint ${e.name}.`);i.target=o,i.local=We(e,"local",!1),i.relative=We(e,"relative",!1),i.offsetRotation=We(e,"rotation",0),i.offsetX=We(e,"x",0)*s,i.offsetY=We(e,"y",0)*s,i.offsetScaleX=We(e,"scaleX",0),i.offsetScaleY=We(e,"scaleY",0),i.offsetShearY=We(e,"shearY",0),i.mixRotate=We(e,"mixRotate",1),i.mixX=We(e,"mixX",1),i.mixY=We(e,"mixY",i.mixX),i.mixScaleX=We(e,"mixScaleX",1),i.mixScaleY=We(e,"mixScaleY",i.mixScaleX),i.mixShearY=We(e,"mixShearY",1),r.transformConstraints.push(i)}if(a.path)for(let t=0;t<a.path.length;t++){let e=a.path[t],n=new $t(e.name);n.order=We(e,"order",0),n.skinRequired=We(e,"skin",!1);for(let t=0;t<e.bones.length;t++){let s=e.bones[t],i=r.findBone(s);if(!i)throw new Error(`Couldn't find bone ${s} for path constraint ${e.name}.`);n.bones.push(i)}let o=e.target,l=r.findSlot(o);if(!l)throw new Error(`Couldn't find target slot ${o} for path constraint ${e.name}.`);n.target=l,n.positionMode=i.enumValue(Mt,We(e,"positionMode","Percent")),n.spacingMode=i.enumValue(Rt,We(e,"spacingMode","Length")),n.rotateMode=i.enumValue(Tt,We(e,"rotateMode","Tangent")),n.offsetRotation=We(e,"rotation",0),n.position=We(e,"position",0),n.positionMode==Mt.Fixed&&(n.position*=s),n.spacing=We(e,"spacing",0),n.spacingMode!=Rt.Length&&n.spacingMode!=Rt.Fixed||(n.spacing*=s),n.mixRotate=We(e,"mixRotate",1),n.mixX=We(e,"mixX",1),n.mixY=We(e,"mixY",n.mixX),r.pathConstraints.push(n)}if(a.skins)for(let t=0;t<a.skins.length;t++){let e=a.skins[t],s=new se(e.name);if(e.bones)for(let t=0;t<e.bones.length;t++){let i=e.bones[t],a=r.findBone(i);if(!a)throw new Error(`Couldn't find bone ${i} for skin ${e.name}.`);s.bones.push(a)}if(e.ik)for(let t=0;t<e.ik.length;t++){let i=e.ik[t],a=r.findIkConstraint(i);if(!a)throw new Error(`Couldn't find IK constraint ${i} for skin ${e.name}.`);s.constraints.push(a)}if(e.transform)for(let t=0;t<e.transform.length;t++){let i=e.transform[t],a=r.findTransformConstraint(i);if(!a)throw new Error(`Couldn't find transform constraint ${i} for skin ${e.name}.`);s.constraints.push(a)}if(e.path)for(let t=0;t<e.path.length;t++){let i=e.path[t],a=r.findPathConstraint(i);if(!a)throw new Error(`Couldn't find path constraint ${i} for skin ${e.name}.`);s.constraints.push(a)}for(let t in e.attachments){let i=r.findSlot(t);if(!i)throw new Error(`Couldn't find slot ${t} for skin ${e.name}.`);let a=e.attachments[t];for(let t in a){let e=this.readAttachment(a[t],s,i.index,t,r);e&&s.setAttachment(i.index,t,e)}}r.skins.push(s),"default"==s.name&&(r.defaultSkin=s)}for(let t=0,e=this.linkedMeshes.length;t<e;t++){let e=this.linkedMeshes[t],s=e.skin?r.findSkin(e.skin):r.defaultSkin;if(!s)throw new Error(`Skin not found: ${e.skin}`);let i=s.getAttachment(e.slotIndex,e.parent);if(!i)throw new Error(`Parent mesh not found: ${e.parent}`);e.mesh.timelineAttachment=e.inheritTimeline?i:e.mesh,e.mesh.setParentMesh(i),null!=e.mesh.region&&e.mesh.updateRegion()}if(this.linkedMeshes.length=0,a.events)for(let t in a.events){let e=a.events[t],s=new Jt(t);s.intValue=We(e,"int",0),s.floatValue=We(e,"float",0),s.stringValue=We(e,"string",""),s.audioPath=We(e,"audio",null),s.audioPath&&(s.volume=We(e,"volume",1),s.balance=We(e,"balance",0)),r.events.push(s)}if(a.animations)for(let t in a.animations){let e=a.animations[t];this.readAnimation(e,t,r)}return r}readAttachment(t,e,s,r,a){let n=this.scale;switch(r=We(t,"name",r),We(t,"type","region")){case"region":{let s=We(t,"path",r),i=this.readSequence(We(t,"sequence",null)),a=this.attachmentLoader.newRegionAttachment(e,r,s,i);if(!a)return null;a.path=s,a.x=We(t,"x",0)*n,a.y=We(t,"y",0)*n,a.scaleX=We(t,"scaleX",1),a.scaleY=We(t,"scaleY",1),a.rotation=We(t,"rotation",0),a.width=t.width*n,a.height=t.height*n,a.sequence=i;let o=We(t,"color",null);return o&&a.color.setFromString(o),null!=a.region&&a.updateRegion(),a}case"boundingbox":{let s=this.attachmentLoader.newBoundingBoxAttachment(e,r);if(!s)return null;this.readVertices(t,s,t.vertexCount<<1);let i=We(t,"color",null);return i&&s.color.setFromString(i),s}case"mesh":case"linkedmesh":{let i=We(t,"path",r),a=this.readSequence(We(t,"sequence",null)),o=this.attachmentLoader.newMeshAttachment(e,r,i,a);if(!o)return null;o.path=i;let l=We(t,"color",null);l&&o.color.setFromString(l),o.width=We(t,"width",0)*n,o.height=We(t,"height",0)*n,o.sequence=a;let h=We(t,"parent",null);if(h)return this.linkedMeshes.push(new De(o,We(t,"skin",null),s,h,We(t,"timelines",!0))),o;let c=t.uvs;return this.readVertices(t,o,c.length),o.triangles=t.triangles,o.regionUVs=c,null!=o.region&&o.updateRegion(),o.edges=We(t,"edges",null),o.hullLength=2*We(t,"hull",0),o}case"path":{let s=this.attachmentLoader.newPathAttachment(e,r);if(!s)return null;s.closed=We(t,"closed",!1),s.constantSpeed=We(t,"constantSpeed",!0);let a=t.vertexCount;this.readVertices(t,s,a<<1);let o=i.newArray(a/3,0);for(let e=0;e<t.lengths.length;e++)o[e]=t.lengths[e]*n;s.lengths=o;let l=We(t,"color",null);return l&&s.color.setFromString(l),s}case"point":{let s=this.attachmentLoader.newPointAttachment(e,r);if(!s)return null;s.x=We(t,"x",0)*n,s.y=We(t,"y",0)*n,s.rotation=We(t,"rotation",0);let i=We(t,"color",null);return i&&s.color.setFromString(i),s}case"clipping":{let s=this.attachmentLoader.newClippingAttachment(e,r);if(!s)return null;let i=We(t,"end",null);i&&(s.endSlot=a.findSlot(i));let n=t.vertexCount;this.readVertices(t,s,n<<1);let o=We(t,"color",null);return o&&s.color.setFromString(o),s}}return null}readSequence(t){if(null==t)return null;let e=new l(We(t,"count",0));return e.start=We(t,"start",1),e.digits=We(t,"digits",0),e.setupIndex=We(t,"setup",0),e}readVertices(t,e,s){let r=this.scale;e.worldVerticesLength=s;let a=t.vertices;if(s==a.length){let t=i.toFloatArray(a);if(1!=r)for(let e=0,s=a.length;e<s;e++)t[e]*=r;return void(e.vertices=t)}let n=new Array,o=new Array;for(let t=0,e=a.length;t<e;){let e=a[t++];o.push(e);for(let s=t+4*e;t<s;t+=4)o.push(a[t]),n.push(a[t+1]*r),n.push(a[t+2]*r),n.push(a[t+3])}e.bones=o,e.vertices=i.toFloatArray(n)}readAnimation(t,s,r){let a=this.scale,n=new Array;if(t.slots)for(let s in t.slots){let i=t.slots[s],a=r.findSlot(s);if(!a)throw new Error("Slot not found: "+s);let o=a.index;for(let t in i){let s=i[t];if(!s)continue;let r=s.length;if("attachment"==t){let t=new Z(r,o);for(let e=0;e<r;e++){let i=s[e];t.setFrame(e,We(i,"time",0),We(i,"name",null))}n.push(t)}else if("rgba"==t){let t=new H(r,r<<2,o),i=s[0],a=We(i,"time",0),l=e.fromString(i.color);for(let r=0,n=0;;r++){t.setFrame(r,a,l.r,l.g,l.b,l.a);let o=s[r+1];if(!o){t.shrink(n);break}let h=We(o,"time",0),c=e.fromString(o.color),d=i.curve;d&&(n=Oe(d,t,n,r,0,a,h,l.r,c.r,1),n=Oe(d,t,n,r,1,a,h,l.g,c.g,1),n=Oe(d,t,n,r,2,a,h,l.b,c.b,1),n=Oe(d,t,n,r,3,a,h,l.a,c.a,1)),a=h,l=c,i=o}n.push(t)}else if("rgb"==t){let t=new j(r,3*r,o),i=s[0],a=We(i,"time",0),l=e.fromString(i.color);for(let r=0,n=0;;r++){t.setFrame(r,a,l.r,l.g,l.b);let o=s[r+1];if(!o){t.shrink(n);break}let h=We(o,"time",0),c=e.fromString(o.color),d=i.curve;d&&(n=Oe(d,t,n,r,0,a,h,l.r,c.r,1),n=Oe(d,t,n,r,1,a,h,l.g,c.g,1),n=Oe(d,t,n,r,2,a,h,l.b,c.b,1)),a=h,l=c,i=o}n.push(t)}else if("alpha"==t)n.push(Ne(s,new K(r,r,o),0,1));else if("rgba2"==t){let t=new Q(r,7*r,o),i=s[0],a=We(i,"time",0),l=e.fromString(i.light),h=e.fromString(i.dark);for(let r=0,n=0;;r++){t.setFrame(r,a,l.r,l.g,l.b,l.a,h.r,h.g,h.b);let o=s[r+1];if(!o){t.shrink(n);break}let c=We(o,"time",0),d=e.fromString(o.light),u=e.fromString(o.dark),m=i.curve;m&&(n=Oe(m,t,n,r,0,a,c,l.r,d.r,1),n=Oe(m,t,n,r,1,a,c,l.g,d.g,1),n=Oe(m,t,n,r,2,a,c,l.b,d.b,1),n=Oe(m,t,n,r,3,a,c,l.a,d.a,1),n=Oe(m,t,n,r,4,a,c,h.r,u.r,1),n=Oe(m,t,n,r,5,a,c,h.g,u.g,1),n=Oe(m,t,n,r,6,a,c,h.b,u.b,1)),a=c,l=d,h=u,i=o}n.push(t)}else if("rgb2"==t){let t=new J(r,6*r,o),i=s[0],a=We(i,"time",0),l=e.fromString(i.light),h=e.fromString(i.dark);for(let r=0,n=0;;r++){t.setFrame(r,a,l.r,l.g,l.b,h.r,h.g,h.b);let o=s[r+1];if(!o){t.shrink(n);break}let c=We(o,"time",0),d=e.fromString(o.light),u=e.fromString(o.dark),m=i.curve;m&&(n=Oe(m,t,n,r,0,a,c,l.r,d.r,1),n=Oe(m,t,n,r,1,a,c,l.g,d.g,1),n=Oe(m,t,n,r,2,a,c,l.b,d.b,1),n=Oe(m,t,n,r,3,a,c,h.r,u.r,1),n=Oe(m,t,n,r,4,a,c,h.g,u.g,1),n=Oe(m,t,n,r,5,a,c,h.b,u.b,1)),a=c,l=d,h=u,i=o}n.push(t)}}}if(t.bones)for(let e in t.bones){let s=t.bones[e],i=r.findBone(e);if(!i)throw new Error("Bone not found: "+e);let o=i.index;for(let t in s){let e=s[t],i=e.length;if(0!=i)if("rotate"===t)n.push(Ne(e,new V(i,i,o),0,1));else if("translate"===t){let t=new D(i,i<<1,o);n.push(Ue(e,t,"x","y",0,a))}else if("translatex"===t){let t=new N(i,i,o);n.push(Ne(e,t,0,a))}else if("translatey"===t){let t=new U(i,i,o);n.push(Ne(e,t,0,a))}else if("scale"===t){let t=new O(i,i<<1,o);n.push(Ue(e,t,"x","y",1,1))}else if("scalex"===t){let t=new W(i,i,o);n.push(Ne(e,t,1,1))}else if("scaley"===t){let t=new z(i,i,o);n.push(Ne(e,t,1,1))}else if("shear"===t){let t=new q(i,i<<1,o);n.push(Ue(e,t,"x","y",0,1))}else if("shearx"===t){let t=new $(i,i,o);n.push(Ne(e,t,0,1))}else if("sheary"===t){let t=new G(i,i,o);n.push(Ne(e,t,0,1))}}}if(t.ik)for(let e in t.ik){let s=t.ik[e],i=s[0];if(!i)continue;let o=r.findIkConstraint(e);if(!o)throw new Error("IK Constraint not found: "+e);let l=r.ikConstraints.indexOf(o),h=new it(s.length,s.length<<1,l),c=We(i,"time",0),d=We(i,"mix",1),u=We(i,"softness",0)*a;for(let t=0,e=0;;t++){h.setFrame(t,c,d,u,We(i,"bendPositive",!0)?1:-1,We(i,"compress",!1),We(i,"stretch",!1));let r=s[t+1];if(!r){h.shrink(e);break}let n=We(r,"time",0),o=We(r,"mix",1),l=We(r,"softness",0)*a,m=i.curve;m&&(e=Oe(m,h,e,t,0,c,n,d,o,1),e=Oe(m,h,e,t,1,c,n,u,l,a)),c=n,d=o,u=l,i=r}n.push(h)}if(t.transform)for(let e in t.transform){let s=t.transform[e],i=s[0];if(!i)continue;let a=r.findTransformConstraint(e);if(!a)throw new Error("Transform constraint not found: "+e);let o=r.transformConstraints.indexOf(a),l=new rt(s.length,6*s.length,o),h=We(i,"time",0),c=We(i,"mixRotate",1),d=We(i,"mixX",1),u=We(i,"mixY",d),m=We(i,"mixScaleX",1),g=We(i,"mixScaleY",m),f=We(i,"mixShearY",1);for(let t=0,e=0;;t++){l.setFrame(t,h,c,d,u,m,g,f);let r=s[t+1];if(!r){l.shrink(e);break}let a=We(r,"time",0),n=We(r,"mixRotate",1),o=We(r,"mixX",1),p=We(r,"mixY",o),x=We(r,"mixScaleX",1),w=We(r,"mixScaleY",x),b=We(r,"mixShearY",1),y=i.curve;y&&(e=Oe(y,l,e,t,0,h,a,c,n,1),e=Oe(y,l,e,t,1,h,a,d,o,1),e=Oe(y,l,e,t,2,h,a,u,p,1),e=Oe(y,l,e,t,3,h,a,m,x,1),e=Oe(y,l,e,t,4,h,a,g,w,1),e=Oe(y,l,e,t,5,h,a,f,b,1)),h=a,c=n,d=o,u=p,m=x,g=w,m=x,i=r}n.push(l)}if(t.path)for(let e in t.path){let s=t.path[e],i=r.findPathConstraint(e);if(!i)throw new Error("Path constraint not found: "+e);let o=r.pathConstraints.indexOf(i);for(let t in s){let e=s[t],r=e[0];if(!r)continue;let l=e.length;if("position"===t){let t=new at(l,l,o);n.push(Ne(e,t,0,i.positionMode==Mt.Fixed?a:1))}else if("spacing"===t){let t=new nt(l,l,o);n.push(Ne(e,t,0,i.spacingMode==Rt.Length||i.spacingMode==Rt.Fixed?a:1))}else if("mix"===t){let t=new ot(l,3*l,o),s=We(r,"time",0),i=We(r,"mixRotate",1),a=We(r,"mixX",1),h=We(r,"mixY",a);for(let n=0,o=0;;n++){t.setFrame(n,s,i,a,h);let l=e[n+1];if(!l){t.shrink(o);break}let c=We(l,"time",0),d=We(l,"mixRotate",1),u=We(l,"mixX",1),m=We(l,"mixY",u),g=r.curve;g&&(o=Oe(g,t,o,n,0,s,c,i,d,1),o=Oe(g,t,o,n,1,s,c,a,u,1),o=Oe(g,t,o,n,2,s,c,h,m,1)),s=c,i=d,a=u,h=m,r=l}n.push(t)}}}if(t.attachments)for(let e in t.attachments){let s=t.attachments[e],o=r.findSkin(e);if(!o)throw new Error("Skin not found: "+e);for(let t in s){let e=s[t],l=r.findSlot(t);if(!l)throw new Error("Slot not found: "+t);let c=l.index;for(let t in e){let s=e[t],r=o.getAttachment(c,t);for(let t in s){let e=s[t],o=e[0];if(o)if("deform"==t){let t=r.bones,s=r.vertices,l=t?s.length/3*2:s.length,h=new tt(e.length,e.length,c,r),d=We(o,"time",0);for(let r=0,n=0;;r++){let c,u=We(o,"vertices",null);if(u){c=i.newFloatArray(l);let e=We(o,"offset",0);if(i.arrayCopy(u,0,c,e,u.length),1!=a)for(let t=e,s=t+u.length;t<s;t++)c[t]*=a;if(!t)for(let t=0;t<l;t++)c[t]+=s[t]}else c=t?i.newFloatArray(l):s;h.setFrame(r,d,c);let m=e[r+1];if(!m){h.shrink(n);break}let g=We(m,"time",0),f=o.curve;f&&(n=Oe(f,h,n,r,0,d,g,0,1,1)),d=g,o=m}n.push(h)}else if("sequence"==t){let t=new lt(e.length,c,r),s=0;for(let i=0;i<e.length;i++){let r=We(o,"delay",s),a=We(o,"time",0),n=h[We(o,"mode","hold")],l=We(o,"index",0);t.setFrame(i,a,n,l,r),s=r,o=e[i+1]}n.push(t)}}}}}if(t.drawOrder){let e=new st(t.drawOrder.length),s=r.slots.length,a=0;for(let n=0;n<t.drawOrder.length;n++,a++){let o=t.drawOrder[n],l=null,h=We(o,"offsets",null);if(h){l=i.newArray(s,-1);let t=i.newArray(s-h.length,0),e=0,a=0;for(let s=0;s<h.length;s++){let i=h[s],n=r.findSlot(i.slot);if(!n)throw new Error("Slot not found: "+n);let o=n.index;for(;e!=o;)t[a++]=e++;l[e+i.offset]=e++}for(;e<s;)t[a++]=e++;for(let e=s-1;e>=0;e--)-1==l[e]&&(l[e]=t[--a])}e.setFrame(a,We(o,"time",0),l)}n.push(e)}if(t.events){let e=new et(t.events.length),s=0;for(let a=0;a<t.events.length;a++,s++){let n=t.events[a],o=r.findEvent(n.name);if(!o)throw new Error("Event not found: "+n.name);let l=new Qt(i.toSinglePrecision(We(n,"time",0)),o);l.intValue=We(n,"int",o.intValue),l.floatValue=We(n,"float",o.floatValue),l.stringValue=We(n,"string",o.stringValue),l.data.audioPath&&(l.volume=We(n,"volume",1),l.balance=We(n,"balance",0)),e.setFrame(s,l)}n.push(e)}let o=0;for(let t=0,e=n.length;t<e;t++)o=Math.max(o,n[t].getDuration());r.animations.push(new d(s,n,o))}}class De{parent;skin;slotIndex;mesh;inheritTimeline;constructor(t,e,s,i,r){this.mesh=t,this.skin=e,this.slotIndex=s,this.parent=i,this.inheritTimeline=r}}function Ne(t,e,s,i){let r=t[0],a=We(r,"time",0),n=We(r,"value",s)*i,o=0;for(let l=0;;l++){e.setFrame(l,a,n);let h=t[l+1];if(!h)return e.shrink(o),e;let c=We(h,"time",0),d=We(h,"value",s)*i;r.curve&&(o=Oe(r.curve,e,o,l,0,a,c,n,d,i)),a=c,n=d,r=h}}function Ue(t,e,s,i,r,a){let n=t[0],o=We(n,"time",0),l=We(n,s,r)*a,h=We(n,i,r)*a,c=0;for(let d=0;;d++){e.setFrame(d,o,l,h);let u=t[d+1];if(!u)return e.shrink(c),e;let m=We(u,"time",0),g=We(u,s,r)*a,f=We(u,i,r)*a,p=n.curve;p&&(c=Oe(p,e,c,d,0,o,m,l,g,a),c=Oe(p,e,c,d,1,o,m,h,f,a)),o=m,l=g,h=f,n=u}}function Oe(t,e,s,i,r,a,n,o,l,h){if("stepped"==t)return e.setStepped(i),s;let c=r<<2,d=t[c],u=t[c+1]*h,m=t[c+2],g=t[c+3]*h;return e.setBezier(s,i,r,a,o,d,u,m,g,n,l),s+1}function We(t,e,s){return void 0!==t[e]?t[e]:s}var ze;void 0===Math.fround&&(Math.fround=(ze=new Float32Array(1),function(t){return ze[0]=t,ze[0]}));class qe{canvas;gl;restorables=new Array;constructor(t,e={alpha:"true"}){if(t instanceof WebGLRenderingContext||"undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext)this.gl=t,this.canvas=this.gl.canvas;else{let s=t;this.gl=s.getContext("webgl2",e)||s.getContext("webgl",e),this.canvas=s,s.addEventListener("webglcontextlost",(t=>{t&&t.preventDefault()})),s.addEventListener("webglcontextrestored",(t=>{for(let t=0,e=this.restorables.length;t<e;t++)this.restorables[t].restore()}))}}addRestorable(t){this.restorables.push(t)}removeRestorable(t){let e=this.restorables.indexOf(t);e>-1&&this.restorables.splice(e,1)}}class $e extends At{context;texture=null;boundUnit=0;useMipMaps=!1;static DISABLE_UNPACK_PREMULTIPLIED_ALPHA_WEBGL=!1;constructor(t,e,s=!1){super(e),this.context=t instanceof qe?t:new qe(t),this.useMipMaps=s,this.restore(),this.context.addRestorable(this)}setFilters(t,e){let s=this.context.gl;this.bind(),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,t),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,$e.validateMagFilter(e)),this.useMipMaps=$e.usesMipMaps(t),this.useMipMaps&&s.generateMipmap(s.TEXTURE_2D)}static validateMagFilter(t){switch(t){case St.MipMap:case St.MipMapLinearLinear:case St.MipMapLinearNearest:case St.MipMapNearestLinear:case St.MipMapNearestNearest:return St.Linear;default:return t}}static usesMipMaps(t){switch(t){case St.MipMap:case St.MipMapLinearLinear:case St.MipMapLinearNearest:case St.MipMapNearestLinear:case St.MipMapNearestNearest:return!0;default:return!1}}setWraps(t,e){let s=this.context.gl;this.bind(),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,t),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,e)}update(t){let e=this.context.gl;this.texture||(this.texture=this.context.gl.createTexture()),this.bind(),$e.DISABLE_UNPACK_PREMULTIPLIED_ALPHA_WEBGL&&e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,this._image),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,t?e.LINEAR_MIPMAP_LINEAR:e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),t&&e.generateMipmap(e.TEXTURE_2D)}restore(){this.texture=null,this.update(this.useMipMaps)}bind(t=0){let e=this.context.gl;this.boundUnit=t,e.activeTexture(e.TEXTURE0+t),e.bindTexture(e.TEXTURE_2D,this.texture)}unbind(){let t=this.context.gl;t.activeTexture(t.TEXTURE0+this.boundUnit),t.bindTexture(t.TEXTURE_2D,null)}dispose(){this.context.removeRestorable(this),this.context.gl.deleteTexture(this.texture)}}class Ge{x=0;y=0;z=0;constructor(t=0,e=0,s=0){this.x=t,this.y=e,this.z=s}setFrom(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}set(t,e,s){return this.x=t,this.y=e,this.z=s,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}scale(t){return this.x*=t,this.y*=t,this.z*=t,this}normalize(){let t=this.length();return 0==t||(t=1/t,this.x*=t,this.y*=t,this.z*=t),this}cross(t){return this.set(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}multiply(t){let e=t.values;return this.set(this.x*e[He]+this.y*e[je]+this.z*e[Ke]+e[Qe],this.x*e[Je]+this.y*e[Ze]+this.z*e[ts]+e[es],this.x*e[ss]+this.y*e[is]+this.z*e[rs]+e[as])}project(t){let e=t.values,s=1/(this.x*e[ns]+this.y*e[os]+this.z*e[ls]+e[hs]);return this.set((this.x*e[He]+this.y*e[je]+this.z*e[Ke]+e[Qe])*s,(this.x*e[Je]+this.y*e[Ze]+this.z*e[ts]+e[es])*s,(this.x*e[ss]+this.y*e[is]+this.z*e[rs]+e[as])*s)}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}distance(t){let e=t.x-this.x,s=t.y-this.y,i=t.z-this.z;return Math.sqrt(e*e+s*s+i*i)}}const He=0,je=4,Ke=8,Qe=12,Je=1,Ze=5,ts=9,es=13,ss=2,is=6,rs=10,as=14,ns=3,os=7,ls=11,hs=15;class cs{temp=new Float32Array(16);values=new Float32Array(16);static xAxis=new Ge;static yAxis=new Ge;static zAxis=new Ge;static tmpMatrix=new cs;constructor(){let t=this.values;t[He]=1,t[Ze]=1,t[rs]=1,t[hs]=1}set(t){return this.values.set(t),this}transpose(){let t=this.temp,e=this.values;return t[He]=e[He],t[je]=e[Je],t[Ke]=e[ss],t[Qe]=e[ns],t[Je]=e[je],t[Ze]=e[Ze],t[ts]=e[is],t[es]=e[os],t[ss]=e[Ke],t[is]=e[ts],t[rs]=e[rs],t[as]=e[ls],t[ns]=e[Qe],t[os]=e[es],t[ls]=e[as],t[hs]=e[hs],this.set(t)}identity(){let t=this.values;return t[He]=1,t[je]=0,t[Ke]=0,t[Qe]=0,t[Je]=0,t[Ze]=1,t[ts]=0,t[es]=0,t[ss]=0,t[is]=0,t[rs]=1,t[as]=0,t[ns]=0,t[os]=0,t[ls]=0,t[hs]=1,this}invert(){let t=this.values,e=this.temp,s=t[ns]*t[is]*t[ts]*t[Qe]-t[ss]*t[os]*t[ts]*t[Qe]-t[ns]*t[Ze]*t[rs]*t[Qe]+t[Je]*t[os]*t[rs]*t[Qe]+t[ss]*t[Ze]*t[ls]*t[Qe]-t[Je]*t[is]*t[ls]*t[Qe]-t[ns]*t[is]*t[Ke]*t[es]+t[ss]*t[os]*t[Ke]*t[es]+t[ns]*t[je]*t[rs]*t[es]-t[He]*t[os]*t[rs]*t[es]-t[ss]*t[je]*t[ls]*t[es]+t[He]*t[is]*t[ls]*t[es]+t[ns]*t[Ze]*t[Ke]*t[as]-t[Je]*t[os]*t[Ke]*t[as]-t[ns]*t[je]*t[ts]*t[as]+t[He]*t[os]*t[ts]*t[as]+t[Je]*t[je]*t[ls]*t[as]-t[He]*t[Ze]*t[ls]*t[as]-t[ss]*t[Ze]*t[Ke]*t[hs]+t[Je]*t[is]*t[Ke]*t[hs]+t[ss]*t[je]*t[ts]*t[hs]-t[He]*t[is]*t[ts]*t[hs]-t[Je]*t[je]*t[rs]*t[hs]+t[He]*t[Ze]*t[rs]*t[hs];if(0==s)throw new Error("non-invertible matrix");let i=1/s;return e[He]=t[ts]*t[as]*t[os]-t[es]*t[rs]*t[os]+t[es]*t[is]*t[ls]-t[Ze]*t[as]*t[ls]-t[ts]*t[is]*t[hs]+t[Ze]*t[rs]*t[hs],e[je]=t[Qe]*t[rs]*t[os]-t[Ke]*t[as]*t[os]-t[Qe]*t[is]*t[ls]+t[je]*t[as]*t[ls]+t[Ke]*t[is]*t[hs]-t[je]*t[rs]*t[hs],e[Ke]=t[Ke]*t[es]*t[os]-t[Qe]*t[ts]*t[os]+t[Qe]*t[Ze]*t[ls]-t[je]*t[es]*t[ls]-t[Ke]*t[Ze]*t[hs]+t[je]*t[ts]*t[hs],e[Qe]=t[Qe]*t[ts]*t[is]-t[Ke]*t[es]*t[is]-t[Qe]*t[Ze]*t[rs]+t[je]*t[es]*t[rs]+t[Ke]*t[Ze]*t[as]-t[je]*t[ts]*t[as],e[Je]=t[es]*t[rs]*t[ns]-t[ts]*t[as]*t[ns]-t[es]*t[ss]*t[ls]+t[Je]*t[as]*t[ls]+t[ts]*t[ss]*t[hs]-t[Je]*t[rs]*t[hs],e[Ze]=t[Ke]*t[as]*t[ns]-t[Qe]*t[rs]*t[ns]+t[Qe]*t[ss]*t[ls]-t[He]*t[as]*t[ls]-t[Ke]*t[ss]*t[hs]+t[He]*t[rs]*t[hs],e[ts]=t[Qe]*t[ts]*t[ns]-t[Ke]*t[es]*t[ns]-t[Qe]*t[Je]*t[ls]+t[He]*t[es]*t[ls]+t[Ke]*t[Je]*t[hs]-t[He]*t[ts]*t[hs],e[es]=t[Ke]*t[es]*t[ss]-t[Qe]*t[ts]*t[ss]+t[Qe]*t[Je]*t[rs]-t[He]*t[es]*t[rs]-t[Ke]*t[Je]*t[as]+t[He]*t[ts]*t[as],e[ss]=t[Ze]*t[as]*t[ns]-t[es]*t[is]*t[ns]+t[es]*t[ss]*t[os]-t[Je]*t[as]*t[os]-t[Ze]*t[ss]*t[hs]+t[Je]*t[is]*t[hs],e[is]=t[Qe]*t[is]*t[ns]-t[je]*t[as]*t[ns]-t[Qe]*t[ss]*t[os]+t[He]*t[as]*t[os]+t[je]*t[ss]*t[hs]-t[He]*t[is]*t[hs],e[rs]=t[je]*t[es]*t[ns]-t[Qe]*t[Ze]*t[ns]+t[Qe]*t[Je]*t[os]-t[He]*t[es]*t[os]-t[je]*t[Je]*t[hs]+t[He]*t[Ze]*t[hs],e[as]=t[Qe]*t[Ze]*t[ss]-t[je]*t[es]*t[ss]-t[Qe]*t[Je]*t[is]+t[He]*t[es]*t[is]+t[je]*t[Je]*t[as]-t[He]*t[Ze]*t[as],e[ns]=t[ts]*t[is]*t[ns]-t[Ze]*t[rs]*t[ns]-t[ts]*t[ss]*t[os]+t[Je]*t[rs]*t[os]+t[Ze]*t[ss]*t[ls]-t[Je]*t[is]*t[ls],e[os]=t[je]*t[rs]*t[ns]-t[Ke]*t[is]*t[ns]+t[Ke]*t[ss]*t[os]-t[He]*t[rs]*t[os]-t[je]*t[ss]*t[ls]+t[He]*t[is]*t[ls],e[ls]=t[Ke]*t[Ze]*t[ns]-t[je]*t[ts]*t[ns]-t[Ke]*t[Je]*t[os]+t[He]*t[ts]*t[os]+t[je]*t[Je]*t[ls]-t[He]*t[Ze]*t[ls],e[hs]=t[je]*t[ts]*t[ss]-t[Ke]*t[Ze]*t[ss]+t[Ke]*t[Je]*t[is]-t[He]*t[ts]*t[is]-t[je]*t[Je]*t[rs]+t[He]*t[Ze]*t[rs],t[He]=e[He]*i,t[je]=e[je]*i,t[Ke]=e[Ke]*i,t[Qe]=e[Qe]*i,t[Je]=e[Je]*i,t[Ze]=e[Ze]*i,t[ts]=e[ts]*i,t[es]=e[es]*i,t[ss]=e[ss]*i,t[is]=e[is]*i,t[rs]=e[rs]*i,t[as]=e[as]*i,t[ns]=e[ns]*i,t[os]=e[os]*i,t[ls]=e[ls]*i,t[hs]=e[hs]*i,this}determinant(){let t=this.values;return t[ns]*t[is]*t[ts]*t[Qe]-t[ss]*t[os]*t[ts]*t[Qe]-t[ns]*t[Ze]*t[rs]*t[Qe]+t[Je]*t[os]*t[rs]*t[Qe]+t[ss]*t[Ze]*t[ls]*t[Qe]-t[Je]*t[is]*t[ls]*t[Qe]-t[ns]*t[is]*t[Ke]*t[es]+t[ss]*t[os]*t[Ke]*t[es]+t[ns]*t[je]*t[rs]*t[es]-t[He]*t[os]*t[rs]*t[es]-t[ss]*t[je]*t[ls]*t[es]+t[He]*t[is]*t[ls]*t[es]+t[ns]*t[Ze]*t[Ke]*t[as]-t[Je]*t[os]*t[Ke]*t[as]-t[ns]*t[je]*t[ts]*t[as]+t[He]*t[os]*t[ts]*t[as]+t[Je]*t[je]*t[ls]*t[as]-t[He]*t[Ze]*t[ls]*t[as]-t[ss]*t[Ze]*t[Ke]*t[hs]+t[Je]*t[is]*t[Ke]*t[hs]+t[ss]*t[je]*t[ts]*t[hs]-t[He]*t[is]*t[ts]*t[hs]-t[Je]*t[je]*t[rs]*t[hs]+t[He]*t[Ze]*t[rs]*t[hs]}translate(t,e,s){let i=this.values;return i[Qe]+=t,i[es]+=e,i[as]+=s,this}copy(){return(new cs).set(this.values)}projection(t,e,s,i){this.identity();let r=1/Math.tan(s*(Math.PI/180)/2),a=(e+t)/(t-e),n=2*e*t/(t-e),o=this.values;return o[He]=r/i,o[Je]=0,o[ss]=0,o[ns]=0,o[je]=0,o[Ze]=r,o[is]=0,o[os]=0,o[Ke]=0,o[ts]=0,o[rs]=a,o[ls]=-1,o[Qe]=0,o[es]=0,o[as]=n,o[hs]=0,this}ortho2d(t,e,s,i){return this.ortho(t,t+s,e,e+i,0,1)}ortho(t,e,s,i,r,a){this.identity();let n=2/(e-t),o=2/(i-s),l=-2/(a-r),h=-(e+t)/(e-t),c=-(i+s)/(i-s),d=-(a+r)/(a-r),u=this.values;return u[He]=n,u[Je]=0,u[ss]=0,u[ns]=0,u[je]=0,u[Ze]=o,u[is]=0,u[os]=0,u[Ke]=0,u[ts]=0,u[rs]=l,u[ls]=0,u[Qe]=h,u[es]=c,u[as]=d,u[hs]=1,this}multiply(t){let e=this.temp,s=this.values,i=t.values;return e[He]=s[He]*i[He]+s[je]*i[Je]+s[Ke]*i[ss]+s[Qe]*i[ns],e[je]=s[He]*i[je]+s[je]*i[Ze]+s[Ke]*i[is]+s[Qe]*i[os],e[Ke]=s[He]*i[Ke]+s[je]*i[ts]+s[Ke]*i[rs]+s[Qe]*i[ls],e[Qe]=s[He]*i[Qe]+s[je]*i[es]+s[Ke]*i[as]+s[Qe]*i[hs],e[Je]=s[Je]*i[He]+s[Ze]*i[Je]+s[ts]*i[ss]+s[es]*i[ns],e[Ze]=s[Je]*i[je]+s[Ze]*i[Ze]+s[ts]*i[is]+s[es]*i[os],e[ts]=s[Je]*i[Ke]+s[Ze]*i[ts]+s[ts]*i[rs]+s[es]*i[ls],e[es]=s[Je]*i[Qe]+s[Ze]*i[es]+s[ts]*i[as]+s[es]*i[hs],e[ss]=s[ss]*i[He]+s[is]*i[Je]+s[rs]*i[ss]+s[as]*i[ns],e[is]=s[ss]*i[je]+s[is]*i[Ze]+s[rs]*i[is]+s[as]*i[os],e[rs]=s[ss]*i[Ke]+s[is]*i[ts]+s[rs]*i[rs]+s[as]*i[ls],e[as]=s[ss]*i[Qe]+s[is]*i[es]+s[rs]*i[as]+s[as]*i[hs],e[ns]=s[ns]*i[He]+s[os]*i[Je]+s[ls]*i[ss]+s[hs]*i[ns],e[os]=s[ns]*i[je]+s[os]*i[Ze]+s[ls]*i[is]+s[hs]*i[os],e[ls]=s[ns]*i[Ke]+s[os]*i[ts]+s[ls]*i[rs]+s[hs]*i[ls],e[hs]=s[ns]*i[Qe]+s[os]*i[es]+s[ls]*i[as]+s[hs]*i[hs],this.set(this.temp)}multiplyLeft(t){let e=this.temp,s=this.values,i=t.values;return e[He]=i[He]*s[He]+i[je]*s[Je]+i[Ke]*s[ss]+i[Qe]*s[ns],e[je]=i[He]*s[je]+i[je]*s[Ze]+i[Ke]*s[is]+i[Qe]*s[os],e[Ke]=i[He]*s[Ke]+i[je]*s[ts]+i[Ke]*s[rs]+i[Qe]*s[ls],e[Qe]=i[He]*s[Qe]+i[je]*s[es]+i[Ke]*s[as]+i[Qe]*s[hs],e[Je]=i[Je]*s[He]+i[Ze]*s[Je]+i[ts]*s[ss]+i[es]*s[ns],e[Ze]=i[Je]*s[je]+i[Ze]*s[Ze]+i[ts]*s[is]+i[es]*s[os],e[ts]=i[Je]*s[Ke]+i[Ze]*s[ts]+i[ts]*s[rs]+i[es]*s[ls],e[es]=i[Je]*s[Qe]+i[Ze]*s[es]+i[ts]*s[as]+i[es]*s[hs],e[ss]=i[ss]*s[He]+i[is]*s[Je]+i[rs]*s[ss]+i[as]*s[ns],e[is]=i[ss]*s[je]+i[is]*s[Ze]+i[rs]*s[is]+i[as]*s[os],e[rs]=i[ss]*s[Ke]+i[is]*s[ts]+i[rs]*s[rs]+i[as]*s[ls],e[as]=i[ss]*s[Qe]+i[is]*s[es]+i[rs]*s[as]+i[as]*s[hs],e[ns]=i[ns]*s[He]+i[os]*s[Je]+i[ls]*s[ss]+i[hs]*s[ns],e[os]=i[ns]*s[je]+i[os]*s[Ze]+i[ls]*s[is]+i[hs]*s[os],e[ls]=i[ns]*s[Ke]+i[os]*s[ts]+i[ls]*s[rs]+i[hs]*s[ls],e[hs]=i[ns]*s[Qe]+i[os]*s[es]+i[ls]*s[as]+i[hs]*s[hs],this.set(this.temp)}lookAt(t,e,s){let i=cs.xAxis,r=cs.yAxis,a=cs.zAxis;a.setFrom(e).normalize(),i.setFrom(e).normalize(),i.cross(s).normalize(),r.setFrom(i).cross(a).normalize(),this.identity();let n=this.values;return n[He]=i.x,n[je]=i.y,n[Ke]=i.z,n[Je]=r.x,n[Ze]=r.y,n[ts]=r.z,n[ss]=-a.x,n[is]=-a.y,n[rs]=-a.z,cs.tmpMatrix.identity(),cs.tmpMatrix.values[Qe]=-t.x,cs.tmpMatrix.values[es]=-t.y,cs.tmpMatrix.values[as]=-t.z,this.multiply(cs.tmpMatrix),this}}class ds{position=new Ge(0,0,0);direction=new Ge(0,0,-1);up=new Ge(0,1,0);near=0;far=100;zoom=1;viewportWidth=0;viewportHeight=0;projectionView=new cs;inverseProjectionView=new cs;projection=new cs;view=new cs;constructor(t,e){this.viewportWidth=t,this.viewportHeight=e,this.update()}update(){let t=this.projection,e=this.view,s=this.projectionView,i=this.inverseProjectionView,r=this.zoom,a=this.viewportWidth,n=this.viewportHeight;t.ortho(r*(-a/2),r*(a/2),r*(-n/2),r*(n/2),this.near,this.far),e.lookAt(this.position,this.direction,this.up),s.set(t.values),s.multiply(e),i.set(s.values).invert()}screenToWorld(t,e,s){let i=t.x,r=s-t.y-1;return t.x=2*i/e-1,t.y=2*r/s-1,t.z=2*t.z-1,t.project(this.inverseProjectionView),t}worldToScreen(t,e,s){return t.project(this.projectionView),t.x=e*(t.x+1)/2,t.y=s*(t.y+1)/2,t.z=(t.z+1)/2,t}setViewport(t,e){this.viewportWidth=t,this.viewportHeight=e}}class us{vertexShader;fragmentShader;static MVP_MATRIX="u_projTrans";static POSITION="a_position";static COLOR="a_color";static COLOR2="a_color2";static TEXCOORDS="a_texCoords";static SAMPLER="u_texture";context;vs=null;vsSource;fs=null;fsSource;program=null;tmp2x2=new Float32Array(4);tmp3x3=new Float32Array(9);tmp4x4=new Float32Array(16);getProgram(){return this.program}getVertexShader(){return this.vertexShader}getFragmentShader(){return this.fragmentShader}getVertexShaderSource(){return this.vsSource}getFragmentSource(){return this.fsSource}constructor(t,e,s){this.vertexShader=e,this.fragmentShader=s,this.vsSource=e,this.fsSource=s,this.context=t instanceof qe?t:new qe(t),this.context.addRestorable(this),this.compile()}compile(){let t=this.context.gl;try{if(this.vs=this.compileShader(t.VERTEX_SHADER,this.vertexShader),!this.vs)throw new Error("Couldn't compile vertex shader.");if(this.fs=this.compileShader(t.FRAGMENT_SHADER,this.fragmentShader),!this.fs)throw new Error("Couldn#t compile fragment shader.");this.program=this.compileProgram(this.vs,this.fs)}catch(t){throw this.dispose(),t}}compileShader(t,e){let s=this.context.gl,i=s.createShader(t);if(!i)throw new Error("Couldn't create shader.");if(s.shaderSource(i,e),s.compileShader(i),!s.getShaderParameter(i,s.COMPILE_STATUS)){let t="Couldn't compile shader: "+s.getShaderInfoLog(i);if(s.deleteShader(i),!s.isContextLost())throw new Error(t)}return i}compileProgram(t,e){let s=this.context.gl,i=s.createProgram();if(!i)throw new Error("Couldn't compile program.");if(s.attachShader(i,t),s.attachShader(i,e),s.linkProgram(i),!s.getProgramParameter(i,s.LINK_STATUS)){let t="Couldn't compile shader program: "+s.getProgramInfoLog(i);if(s.deleteProgram(i),!s.isContextLost())throw new Error(t)}return i}restore(){this.compile()}bind(){this.context.gl.useProgram(this.program)}unbind(){this.context.gl.useProgram(null)}setUniformi(t,e){this.context.gl.uniform1i(this.getUniformLocation(t),e)}setUniformf(t,e){this.context.gl.uniform1f(this.getUniformLocation(t),e)}setUniform2f(t,e,s){this.context.gl.uniform2f(this.getUniformLocation(t),e,s)}setUniform3f(t,e,s,i){this.context.gl.uniform3f(this.getUniformLocation(t),e,s,i)}setUniform4f(t,e,s,i,r){this.context.gl.uniform4f(this.getUniformLocation(t),e,s,i,r)}setUniform2x2f(t,e){let s=this.context.gl;this.tmp2x2.set(e),s.uniformMatrix2fv(this.getUniformLocation(t),!1,this.tmp2x2)}setUniform3x3f(t,e){let s=this.context.gl;this.tmp3x3.set(e),s.uniformMatrix3fv(this.getUniformLocation(t),!1,this.tmp3x3)}setUniform4x4f(t,e){let s=this.context.gl;this.tmp4x4.set(e),s.uniformMatrix4fv(this.getUniformLocation(t),!1,this.tmp4x4)}getUniformLocation(t){let e=this.context.gl;if(!this.program)throw new Error("Shader not compiled.");let s=e.getUniformLocation(this.program,t);if(!s&&!e.isContextLost())throw new Error(`Couldn't find location for uniform ${t}`);return s}getAttributeLocation(t){let e=this.context.gl;if(!this.program)throw new Error("Shader not compiled.");let s=e.getAttribLocation(this.program,t);if(-1==s&&!e.isContextLost())throw new Error(`Couldn't find location for attribute ${t}`);return s}dispose(){this.context.removeRestorable(this);let t=this.context.gl;this.vs&&(t.deleteShader(this.vs),this.vs=null),this.fs&&(t.deleteShader(this.fs),this.fs=null),this.program&&(t.deleteProgram(this.program),this.program=null)}static newColoredTextured(t){let e=`\nattribute vec4 ${us.POSITION};\nattribute vec4 ${us.COLOR};\nattribute vec2 ${us.TEXCOORDS};\nuniform mat4 ${us.MVP_MATRIX};\nvarying vec4 v_color;\nvarying vec2 v_texCoords;\n\nvoid main () {\n\tv_color = ${us.COLOR};\n\tv_texCoords = ${us.TEXCOORDS};\n\tgl_Position = ${us.MVP_MATRIX} * ${us.POSITION};\n}\n`;return new us(t,e,"\n#ifdef GL_ES\n\t#define LOWP lowp\n\tprecision mediump float;\n#else\n\t#define LOWP\n#endif\nvarying LOWP vec4 v_color;\nvarying vec2 v_texCoords;\nuniform sampler2D u_texture;\n\nvoid main () {\n\tgl_FragColor = v_color * texture2D(u_texture, v_texCoords);\n}\n")}static newTwoColoredTextured(t){let e=`\nattribute vec4 ${us.POSITION};\nattribute vec4 ${us.COLOR};\nattribute vec4 ${us.COLOR2};\nattribute vec2 ${us.TEXCOORDS};\nuniform mat4 ${us.MVP_MATRIX};\nvarying vec4 v_light;\nvarying vec4 v_dark;\nvarying vec2 v_texCoords;\n\nvoid main () {\n\tv_light = ${us.COLOR};\n\tv_dark = ${us.COLOR2};\n\tv_texCoords = ${us.TEXCOORDS};\n\tgl_Position = ${us.MVP_MATRIX} * ${us.POSITION};\n}\n`;return new us(t,e,"\n#ifdef GL_ES\n\t#define LOWP lowp\n\tprecision mediump float;\n#else\n\t#define LOWP\n#endif\nvarying LOWP vec4 v_light;\nvarying LOWP vec4 v_dark;\nvarying vec2 v_texCoords;\nuniform sampler2D u_texture;\n\nvoid main () {\n\tvec4 texColor = texture2D(u_texture, v_texCoords);\n\tgl_FragColor.a = texColor.a * v_light.a;\n\tgl_FragColor.rgb = ((texColor.a - 1.0) * v_dark.a + 1.0 - texColor.rgb) * v_dark.rgb + texColor.rgb * v_light.rgb;\n}\n")}static newColored(t){let e=`\nattribute vec4 ${us.POSITION};\nattribute vec4 ${us.COLOR};\nuniform mat4 ${us.MVP_MATRIX};\nvarying vec4 v_color;\n\nvoid main () {\n\tv_color = ${us.COLOR};\n\tgl_Position = ${us.MVP_MATRIX} * ${us.POSITION};\n}\n`;return new us(t,e,"\n#ifdef GL_ES\n\t#define LOWP lowp\n\tprecision mediump float;\n#else\n\t#define LOWP\n#endif\nvarying LOWP vec4 v_color;\n\nvoid main () {\n\tgl_FragColor = v_color;\n}\n")}}class ms{attributes;context;vertices;verticesBuffer=null;verticesLength=0;dirtyVertices=!1;indices;indicesBuffer=null;indicesLength=0;dirtyIndices=!1;elementsPerVertex=0;getAttributes(){return this.attributes}maxVertices(){return this.vertices.length/this.elementsPerVertex}numVertices(){return this.verticesLength/this.elementsPerVertex}setVerticesLength(t){this.dirtyVertices=!0,this.verticesLength=t}getVertices(){return this.vertices}maxIndices(){return this.indices.length}numIndices(){return this.indicesLength}setIndicesLength(t){this.dirtyIndices=!0,this.indicesLength=t}getIndices(){return this.indices}getVertexSizeInFloats(){let t=0;for(var e=0;e<this.attributes.length;e++){t+=this.attributes[e].numElements}return t}constructor(t,e,s,i){this.attributes=e,this.context=t instanceof qe?t:new qe(t),this.elementsPerVertex=0;for(let t=0;t<e.length;t++)this.elementsPerVertex+=e[t].numElements;this.vertices=new Float32Array(s*this.elementsPerVertex),this.indices=new Uint16Array(i),this.context.addRestorable(this)}setVertices(t){if(this.dirtyVertices=!0,t.length>this.vertices.length)throw Error("Mesh can't store more than "+this.maxVertices()+" vertices");this.vertices.set(t,0),this.verticesLength=t.length}setIndices(t){if(this.dirtyIndices=!0,t.length>this.indices.length)throw Error("Mesh can't store more than "+this.maxIndices()+" indices");this.indices.set(t,0),this.indicesLength=t.length}draw(t,e){this.drawWithOffset(t,e,0,this.indicesLength>0?this.indicesLength:this.verticesLength/this.elementsPerVertex)}drawWithOffset(t,e,s,i){let r=this.context.gl;(this.dirtyVertices||this.dirtyIndices)&&this.update(),this.bind(t),this.indicesLength>0?r.drawElements(e,i,r.UNSIGNED_SHORT,2*s):r.drawArrays(e,s,i),this.unbind(t)}bind(t){let e=this.context.gl;e.bindBuffer(e.ARRAY_BUFFER,this.verticesBuffer);let s=0;for(let i=0;i<this.attributes.length;i++){let r=this.attributes[i],a=t.getAttributeLocation(r.name);e.enableVertexAttribArray(a),e.vertexAttribPointer(a,r.numElements,e.FLOAT,!1,4*this.elementsPerVertex,4*s),s+=r.numElements}this.indicesLength>0&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indicesBuffer)}unbind(t){let e=this.context.gl;for(let s=0;s<this.attributes.length;s++){let i=this.attributes[s],r=t.getAttributeLocation(i.name);e.disableVertexAttribArray(r)}e.bindBuffer(e.ARRAY_BUFFER,null),this.indicesLength>0&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}update(){let t=this.context.gl;this.dirtyVertices&&(this.verticesBuffer||(this.verticesBuffer=t.createBuffer()),t.bindBuffer(t.ARRAY_BUFFER,this.verticesBuffer),t.bufferData(t.ARRAY_BUFFER,this.vertices.subarray(0,this.verticesLength),t.DYNAMIC_DRAW),this.dirtyVertices=!1),this.dirtyIndices&&(this.indicesBuffer||(this.indicesBuffer=t.createBuffer()),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indicesBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices.subarray(0,this.indicesLength),t.DYNAMIC_DRAW),this.dirtyIndices=!1)}restore(){this.verticesBuffer=null,this.indicesBuffer=null,this.update()}dispose(){this.context.removeRestorable(this);let t=this.context.gl;t.deleteBuffer(this.verticesBuffer),t.deleteBuffer(this.indicesBuffer)}}class gs{name;type;numElements;constructor(t,e,s){this.name=t,this.type=e,this.numElements=s}}class fs extends gs{constructor(){super(us.POSITION,bs.Float,2)}}class ps extends gs{constructor(t=0){super(us.TEXCOORDS+(0==t?"":t),bs.Float,2)}}class xs extends gs{constructor(){super(us.COLOR,bs.Float,4)}}class ws extends gs{constructor(){super(us.COLOR2,bs.Float,4)}}var bs;!function(t){t[t.Float=0]="Float"}(bs||(bs={}));class ys{static disableCulling=!1;context;drawCalls=0;static globalDrawCalls=0;isDrawing=!1;mesh;shader=null;lastTexture=null;verticesLength=0;indicesLength=0;srcColorBlend;srcAlphaBlend;dstBlend;cullWasEnabled=!1;constructor(t,e=!0,s=10920){if(s>10920)throw new Error("Can't have more than 10920 triangles per batch: "+s);this.context=t instanceof qe?t:new qe(t);let i=e?[new fs,new xs,new ps,new ws]:[new fs,new xs,new ps];this.mesh=new ms(t,i,s,3*s);let r=this.context.gl;this.srcColorBlend=r.SRC_ALPHA,this.srcAlphaBlend=r.ONE,this.dstBlend=r.ONE_MINUS_SRC_ALPHA}begin(t){if(this.isDrawing)throw new Error("PolygonBatch is already drawing. Call PolygonBatch.end() before calling PolygonBatch.begin()");this.drawCalls=0,this.shader=t,this.lastTexture=null,this.isDrawing=!0;let e=this.context.gl;e.enable(e.BLEND),e.blendFuncSeparate(this.srcColorBlend,this.dstBlend,this.srcAlphaBlend,this.dstBlend),ys.disableCulling&&(this.cullWasEnabled=e.isEnabled(e.CULL_FACE),this.cullWasEnabled&&e.disable(e.CULL_FACE))}static blendModesGL=[{srcRgb:770,srcRgbPma:1,dstRgb:771,srcAlpha:1},{srcRgb:770,srcRgbPma:1,dstRgb:1,srcAlpha:1},{srcRgb:774,srcRgbPma:774,dstRgb:771,srcAlpha:1},{srcRgb:1,srcRgbPma:1,dstRgb:769,srcAlpha:1}];setBlendMode(t,e){const s=ys.blendModesGL[t],i=e?s.srcRgbPma:s.srcRgb,r=s.srcAlpha,a=s.dstRgb;if(this.srcColorBlend==i&&this.srcAlphaBlend==r&&this.dstBlend==a)return;this.srcColorBlend=i,this.srcAlphaBlend=r,this.dstBlend=a,this.isDrawing&&this.flush(),this.context.gl.blendFuncSeparate(i,a,r,a)}draw(t,e,s){t!=this.lastTexture?(this.flush(),this.lastTexture=t):(this.verticesLength+e.length>this.mesh.getVertices().length||this.indicesLength+s.length>this.mesh.getIndices().length)&&this.flush();let i=this.mesh.numVertices();this.mesh.getVertices().set(e,this.verticesLength),this.verticesLength+=e.length,this.mesh.setVerticesLength(this.verticesLength);let r=this.mesh.getIndices();for(let t=this.indicesLength,e=0;e<s.length;t++,e++)r[t]=s[e]+i;this.indicesLength+=s.length,this.mesh.setIndicesLength(this.indicesLength)}flush(){if(0!=this.verticesLength){if(!this.lastTexture)throw new Error("No texture set.");if(!this.shader)throw new Error("No shader set.");this.lastTexture.bind(),this.mesh.draw(this.shader,this.context.gl.TRIANGLES),this.verticesLength=0,this.indicesLength=0,this.mesh.setVerticesLength(0),this.mesh.setIndicesLength(0),this.drawCalls++,ys.globalDrawCalls++}}end(){if(!this.isDrawing)throw new Error("PolygonBatch is not drawing. Call PolygonBatch.begin() before calling PolygonBatch.end()");(this.verticesLength>0||this.indicesLength>0)&&this.flush(),this.shader=null,this.lastTexture=null,this.isDrawing=!1;let t=this.context.gl;t.disable(t.BLEND),ys.disableCulling&&this.cullWasEnabled&&t.enable(t.CULL_FACE)}getDrawCalls(){return this.drawCalls}static getAndResetGlobalDrawCalls(){let t=ys.globalDrawCalls;return ys.globalDrawCalls=0,t}dispose(){this.mesh.dispose()}}class vs{context;isDrawing=!1;mesh;shapeType=ks.Filled;color=new e(1,1,1,1);shader=null;vertexIndex=0;tmp=new a;srcColorBlend;srcAlphaBlend;dstBlend;constructor(t,e=10920){if(e>10920)throw new Error("Can't have more than 10920 triangles per batch: "+e);this.context=t instanceof qe?t:new qe(t),this.mesh=new ms(t,[new fs,new xs],e,0);let s=this.context.gl;this.srcColorBlend=s.SRC_ALPHA,this.srcAlphaBlend=s.ONE,this.dstBlend=s.ONE_MINUS_SRC_ALPHA}begin(t){if(this.isDrawing)throw new Error("ShapeRenderer.begin() has already been called");this.shader=t,this.vertexIndex=0,this.isDrawing=!0;let e=this.context.gl;e.enable(e.BLEND),e.blendFuncSeparate(this.srcColorBlend,this.dstBlend,this.srcAlphaBlend,this.dstBlend)}setBlendMode(t,e,s){if(this.srcColorBlend=t,this.srcAlphaBlend=e,this.dstBlend=s,this.isDrawing){this.flush(),this.context.gl.blendFuncSeparate(t,s,e,s)}}setColor(t){this.color.setFromColor(t)}setColorWith(t,e,s,i){this.color.set(t,e,s,i)}point(t,e,s){this.check(ks.Point,1),s||(s=this.color),this.vertex(t,e,s)}line(t,e,s,i,r){this.check(ks.Line,2);this.mesh.getVertices(),this.vertexIndex;r||(r=this.color),this.vertex(t,e,r),this.vertex(s,i,r)}triangle(t,e,s,i,r,a,n,o,l,h){this.check(t?ks.Filled:ks.Line,3);this.mesh.getVertices(),this.vertexIndex;o||(o=this.color),l||(l=this.color),h||(h=this.color),t?(this.vertex(e,s,o),this.vertex(i,r,l),this.vertex(a,n,h)):(this.vertex(e,s,o),this.vertex(i,r,l),this.vertex(i,r,o),this.vertex(a,n,l),this.vertex(a,n,o),this.vertex(e,s,l))}quad(t,e,s,i,r,a,n,o,l,h,c,d,u){this.check(t?ks.Filled:ks.Line,3);this.mesh.getVertices(),this.vertexIndex;h||(h=this.color),c||(c=this.color),d||(d=this.color),u||(u=this.color),t?(this.vertex(e,s,h),this.vertex(i,r,c),this.vertex(a,n,d),this.vertex(a,n,d),this.vertex(o,l,u),this.vertex(e,s,h)):(this.vertex(e,s,h),this.vertex(i,r,c),this.vertex(i,r,c),this.vertex(a,n,d),this.vertex(a,n,d),this.vertex(o,l,u),this.vertex(o,l,u),this.vertex(e,s,h))}rect(t,e,s,i,r,a){this.quad(t,e,s,e+i,s,e+i,s+r,e,s+r,a,a,a,a)}rectLine(t,e,s,i,r,a,n){this.check(t?ks.Filled:ks.Line,8),n||(n=this.color);let o=this.tmp.set(r-s,e-i);o.normalize(),a*=.5;let l=o.x*a,h=o.y*a;t?(this.vertex(e+l,s+h,n),this.vertex(e-l,s-h,n),this.vertex(i+l,r+h,n),this.vertex(i-l,r-h,n),this.vertex(i+l,r+h,n),this.vertex(e-l,s-h,n)):(this.vertex(e+l,s+h,n),this.vertex(e-l,s-h,n),this.vertex(i+l,r+h,n),this.vertex(i-l,r-h,n),this.vertex(i+l,r+h,n),this.vertex(e+l,s+h,n),this.vertex(i-l,r-h,n),this.vertex(e-l,s-h,n))}x(t,e,s){this.line(t-s,e-s,t+s,e+s),this.line(t-s,e+s,t+s,e-s)}polygon(t,e,s,i){if(s<3)throw new Error("Polygon must contain at least 3 vertices");this.check(ks.Line,2*s),i||(i=this.color);this.mesh.getVertices(),this.vertexIndex;s<<=1;let r=t[e<<=1],a=t[e+1],n=e+s;for(let o=e,l=e+s-2;o<l;o+=2){let e=t[o],s=t[o+1],l=0,h=0;o+2>=n?(l=r,h=a):(l=t[o+2],h=t[o+3]),this.vertex(e,s,i),this.vertex(l,h,i)}}circle(t,e,i,r,a,n=0){if(0==n&&(n=Math.max(1,6*s.cbrt(r)|0)),n<=0)throw new Error("segments must be > 0.");a||(a=this.color);let o=2*s.PI/n,l=Math.cos(o),h=Math.sin(o),c=r,d=0;if(t){this.check(ks.Filled,3*n+3),n--;for(let t=0;t<n;t++){this.vertex(e,i,a),this.vertex(e+c,i+d,a);let t=c;c=l*c-h*d,d=h*t+l*d,this.vertex(e+c,i+d,a)}this.vertex(e,i,a),this.vertex(e+c,i+d,a)}else{this.check(ks.Line,2*n+2);for(let t=0;t<n;t++){this.vertex(e+c,i+d,a);let t=c;c=l*c-h*d,d=h*t+l*d,this.vertex(e+c,i+d,a)}this.vertex(e+c,i+d,a)}c=r,d=0,this.vertex(e+c,i+d,a)}curve(t,e,s,i,r,a,n,o,l,h){this.check(ks.Line,2*l+2),h||(h=this.color);let c=1/l,d=c*c,u=c*c*c,m=3*c,g=3*d,f=6*d,p=6*u,x=t-2*s+r,w=e-2*i+a,b=3*(s-r)-t+n,y=3*(i-a)-e+o,v=t,k=e,A=(s-t)*m+x*g+b*u,S=(i-e)*m+w*g+y*u,I=x*f+b*p,C=w*f+y*p,M=b*p,R=y*p;for(;l-- >0;)this.vertex(v,k,h),v+=A,k+=S,A+=I,S+=C,I+=M,C+=R,this.vertex(v,k,h);this.vertex(v,k,h),this.vertex(n,o,h)}vertex(t,e,s){let i=this.vertexIndex,r=this.mesh.getVertices();r[i++]=t,r[i++]=e,r[i++]=s.r,r[i++]=s.g,r[i++]=s.b,r[i++]=s.a,this.vertexIndex=i}end(){if(!this.isDrawing)throw new Error("ShapeRenderer.begin() has not been called");this.flush();let t=this.context.gl;t.disable(t.BLEND),this.isDrawing=!1}flush(){if(0!=this.vertexIndex){if(!this.shader)throw new Error("No shader set.");this.mesh.setVerticesLength(this.vertexIndex),this.mesh.draw(this.shader,this.shapeType),this.vertexIndex=0}}check(t,e){if(!this.isDrawing)throw new Error("ShapeRenderer.begin() has not been called");if(this.shapeType==t){if(!(this.mesh.maxVertices()-this.mesh.numVertices()<e))return;this.flush()}else this.flush(),this.shapeType=t}dispose(){this.mesh.dispose()}}var ks;!function(t){t[t.Point=0]="Point",t[t.Line=1]="Line",t[t.Filled=4]="Filled"}(ks||(ks={}));class As{boneLineColor=new e(1,0,0,1);boneOriginColor=new e(0,1,0,1);attachmentLineColor=new e(0,0,1,.5);triangleLineColor=new e(1,.64,0,.5);pathColor=(new e).setFromString("FF7F00");clipColor=new e(.8,0,0,2);aabbColor=new e(0,1,0,.5);drawBones=!0;drawRegionAttachments=!0;drawBoundingBoxes=!0;drawMeshHull=!0;drawMeshTriangles=!0;drawPaths=!0;drawSkeletonXY=!1;drawClipping=!0;premultipliedAlpha=!1;scale=1;boneWidth=2;context;bounds=new Xe;temp=new Array;vertices=i.newFloatArray(2048);static LIGHT_GRAY=new e(192/255,192/255,192/255,1);static GREEN=new e(0,1,0,1);constructor(t){this.context=t instanceof qe?t:new qe(t)}draw(t,e,s){let r=e.x,a=e.y,n=this.context.gl,o=this.premultipliedAlpha?n.ONE:n.SRC_ALPHA;t.setBlendMode(o,n.ONE,n.ONE_MINUS_SRC_ALPHA);let l=e.bones;if(this.drawBones){t.setColor(this.boneLineColor);for(let e=0,i=l.length;e<i;e++){let i=l[e];if(s&&s.indexOf(i.data.name)>-1)continue;if(!i.parent)continue;let r=i.data.length*i.a+i.worldX,a=i.data.length*i.c+i.worldY;t.rectLine(!0,i.worldX,i.worldY,r,a,this.boneWidth*this.scale)}this.drawSkeletonXY&&t.x(r,a,4*this.scale)}if(this.drawRegionAttachments){t.setColor(this.attachmentLineColor);let s=e.slots;for(let e=0,i=s.length;e<i;e++){let i=s[e],r=i.getAttachment();if(r instanceof Nt){let e=r,s=this.vertices;e.computeWorldVertices(i,s,0,2),t.line(s[0],s[1],s[2],s[3]),t.line(s[2],s[3],s[4],s[5]),t.line(s[4],s[5],s[6],s[7]),t.line(s[6],s[7],s[0],s[1])}}}if(this.drawMeshHull||this.drawMeshTriangles){let s=e.slots;for(let e=0,i=s.length;e<i;e++){let i=s[e];if(!i.bone.active)continue;let r=i.getAttachment();if(!(r instanceof _t))continue;let a=r,n=this.vertices;a.computeWorldVertices(i,0,a.worldVerticesLength,n,0,2);let o=a.triangles,l=a.hullLength;if(this.drawMeshTriangles){t.setColor(this.triangleLineColor);for(let e=0,s=o.length;e<s;e+=3){let s=2*o[e],i=2*o[e+1],r=2*o[e+2];t.triangle(!1,n[s],n[s+1],n[i],n[i+1],n[r],n[r+1])}}if(this.drawMeshHull&&l>0){t.setColor(this.attachmentLineColor),l=2*(l>>1);let e=n[l-2],s=n[l-1];for(let i=0,r=l;i<r;i+=2){let r=n[i],a=n[i+1];t.line(r,a,e,s),e=r,s=a}}}}if(this.drawBoundingBoxes){let s=this.bounds;s.update(e,!0),t.setColor(this.aabbColor),t.rect(!1,s.minX,s.minY,s.getWidth(),s.getHeight());let i=s.polygons,r=s.boundingBoxes;for(let e=0,s=i.length;e<s;e++){let s=i[e];t.setColor(r[e].color),t.polygon(s,0,s.length)}}if(this.drawPaths){let s=e.slots;for(let e=0,r=s.length;e<r;e++){let r=s[e];if(!r.bone.active)continue;let a=r.getAttachment();if(!(a instanceof Vt))continue;let n=a,o=n.worldVerticesLength,l=this.temp=i.setArraySize(this.temp,o,0);n.computeWorldVertices(r,0,o,l,0,2);let h=this.pathColor,c=l[2],d=l[3],u=0,m=0;if(n.closed){t.setColor(h);let e=l[0],s=l[1],i=l[o-2],r=l[o-1];u=l[o-4],m=l[o-3],t.curve(c,d,e,s,i,r,u,m,32),t.setColor(As.LIGHT_GRAY),t.line(c,d,e,s),t.line(u,m,i,r)}o-=4;for(let e=4;e<o;e+=6){let s=l[e],i=l[e+1],r=l[e+2],a=l[e+3];u=l[e+4],m=l[e+5],t.setColor(h),t.curve(c,d,s,i,r,a,u,m,32),t.setColor(As.LIGHT_GRAY),t.line(c,d,s,i),t.line(u,m,r,a),c=u,d=m}}}if(this.drawBones){t.setColor(this.boneOriginColor);for(let e=0,i=l.length;e<i;e++){let i=l[e];s&&s.indexOf(i.data.name)>-1||t.circle(!0,i.worldX,i.worldY,3*this.scale,this.boneOriginColor,8)}}if(this.drawClipping){let s=e.slots;t.setColor(this.clipColor);for(let e=0,r=s.length;e<r;e++){let r=s[e];if(!r.bone.active)continue;let a=r.getAttachment();if(!(a instanceof kt))continue;let n=a,o=n.worldVerticesLength,l=this.temp=i.setArraySize(this.temp,o,0);n.computeWorldVertices(r,0,o,l,0,2);for(let e=0,s=l.length;e<s;e+=2){let s=l[e],i=l[e+1],r=l[(e+2)%l.length],a=l[(e+3)%l.length];t.line(s,i,r,a)}}}}dispose(){}}class Ss{vertices;numVertices;numFloats;constructor(t,e,s){this.vertices=t,this.numVertices=e,this.numFloats=s}}class Is{static QUAD_TRIANGLES=[0,1,2,2,3,0];premultipliedAlpha=!1;tempColor=new e;tempColor2=new e;vertices;vertexSize=8;twoColorTint=!1;renderable=new Ss([],0,0);clipper=new _e;temp=new a;temp2=new a;temp3=new e;temp4=new e;constructor(t,e=!0){this.twoColorTint=e,e&&(this.vertexSize+=4),this.vertices=i.newFloatArray(1024*this.vertexSize)}draw(t,e,s=-1,r=-1,a=null){let n,o,l,h=this.clipper,c=this.premultipliedAlpha,d=this.twoColorTint,u=null,m=this.renderable,g=e.drawOrder,f=e.color,p=d?12:8,x=!1;-1==s&&(x=!0);for(let e=0,w=g.length;e<w;e++){let w=h.isClipping()?2:p,b=g[e];if(!b.bone.active){h.clipEndWithSlot(b);continue}if(s>=0&&s==b.data.index&&(x=!0),!x){h.clipEndWithSlot(b);continue}r>=0&&r==b.data.index&&(x=!1);let y,v=b.getAttachment();if(v instanceof Nt){let t=v;m.vertices=this.vertices,m.numVertices=4,m.numFloats=w<<2,t.computeWorldVertices(b,m.vertices,0,w),o=Is.QUAD_TRIANGLES,n=t.uvs,y=t.region.texture,l=t.color}else{if(!(v instanceof _t)){if(v instanceof kt){let t=v;h.clipStart(b,t);continue}h.clipEndWithSlot(b);continue}{let t=v;m.vertices=this.vertices,m.numVertices=t.worldVerticesLength>>1,m.numFloats=m.numVertices*w,m.numFloats>m.vertices.length&&(m.vertices=this.vertices=i.newFloatArray(m.numFloats)),t.computeWorldVertices(b,0,t.worldVerticesLength,m.vertices,0,w),o=t.triangles,y=t.region.texture,n=t.uvs,l=t.color}}if(y){let e=b.color,s=this.tempColor;s.r=f.r*e.r*l.r,s.g=f.g*e.g*l.g,s.b=f.b*e.b*l.b,s.a=f.a*e.a*l.a,c&&(s.r*=s.a,s.g*=s.a,s.b*=s.a);let i=this.tempColor2;b.darkColor?(c?(i.r=b.darkColor.r*s.a,i.g=b.darkColor.g*s.a,i.b=b.darkColor.b*s.a):i.setFromColor(b.darkColor),i.a=c?1:0):i.set(0,0,0,1);let r=b.data.blendMode;if(r!=u&&(u=r,t.setBlendMode(u,c)),h.isClipping()){h.clipTriangles(m.vertices,m.numFloats,o,o.length,n,s,i,d);let e=new Float32Array(h.clippedVertices),r=h.clippedTriangles;a&&a(e,e.length,p),t.draw(y,e,r)}else{let e=m.vertices;if(d)for(let t=2,r=0,a=m.numFloats;t<a;t+=p,r+=2)e[t]=s.r,e[t+1]=s.g,e[t+2]=s.b,e[t+3]=s.a,e[t+4]=n[r],e[t+5]=n[r+1],e[t+6]=i.r,e[t+7]=i.g,e[t+8]=i.b,e[t+9]=i.a;else for(let t=2,i=0,r=m.numFloats;t<r;t+=p,i+=2)e[t]=s.r,e[t+1]=s.g,e[t+2]=s.b,e[t+3]=s.a,e[t+4]=n[i],e[t+5]=n[i+1];let r=m.vertices.subarray(0,m.numFloats);a&&a(m.vertices,m.numFloats,p),t.draw(y,r,o)}}h.clipEndWithSlot(b)}h.clipEnd()}}const Cs=[0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0],Ms=[0,1,2,2,3,0],Rs=new e(1,1,1,1);class Ts{context;canvas;camera;batcher;twoColorTint=!1;batcherShader;shapes;shapesShader;activeRenderer=null;skeletonRenderer;skeletonDebugRenderer;constructor(t,e,s=!0){this.canvas=t,this.context=e instanceof qe?e:new qe(e),this.twoColorTint=s,this.camera=new ds(t.width,t.height),this.batcherShader=s?us.newTwoColoredTextured(this.context):us.newColoredTextured(this.context),this.batcher=new ys(this.context,s),this.shapesShader=us.newColored(this.context),this.shapes=new vs(this.context),this.skeletonRenderer=new Is(this.context,s),this.skeletonDebugRenderer=new As(this.context)}dispose(){this.batcher.dispose(),this.batcherShader.dispose(),this.shapes.dispose(),this.shapesShader.dispose(),this.skeletonDebugRenderer.dispose()}begin(){this.camera.update(),this.enableRenderer(this.batcher)}drawSkeleton(t,e=!1,s=-1,i=-1,r=null){this.enableRenderer(this.batcher),this.skeletonRenderer.premultipliedAlpha=e,this.skeletonRenderer.draw(this.batcher,t,s,i,r)}drawSkeletonDebug(t,e=!1,s){this.enableRenderer(this.shapes),this.skeletonDebugRenderer.premultipliedAlpha=e,this.skeletonDebugRenderer.draw(this.shapes,t,s)}drawTexture(t,e,s,i,r,a){this.enableRenderer(this.batcher),a||(a=Rs);var n=0;Cs[n++]=e,Cs[n++]=s,Cs[n++]=a.r,Cs[n++]=a.g,Cs[n++]=a.b,Cs[n++]=a.a,Cs[n++]=0,Cs[n++]=1,this.twoColorTint&&(Cs[n++]=0,Cs[n++]=0,Cs[n++]=0,Cs[n++]=0),Cs[n++]=e+i,Cs[n++]=s,Cs[n++]=a.r,Cs[n++]=a.g,Cs[n++]=a.b,Cs[n++]=a.a,Cs[n++]=1,Cs[n++]=1,this.twoColorTint&&(Cs[n++]=0,Cs[n++]=0,Cs[n++]=0,Cs[n++]=0),Cs[n++]=e+i,Cs[n++]=s+r,Cs[n++]=a.r,Cs[n++]=a.g,Cs[n++]=a.b,Cs[n++]=a.a,Cs[n++]=1,Cs[n++]=0,this.twoColorTint&&(Cs[n++]=0,Cs[n++]=0,Cs[n++]=0,Cs[n++]=0),Cs[n++]=e,Cs[n++]=s+r,Cs[n++]=a.r,Cs[n++]=a.g,Cs[n++]=a.b,Cs[n++]=a.a,Cs[n++]=0,Cs[n++]=0,this.twoColorTint&&(Cs[n++]=0,Cs[n++]=0,Cs[n++]=0,Cs[n]=0),this.batcher.draw(t,Cs,Ms)}drawTextureUV(t,e,s,i,r,a,n,o,l,h){this.enableRenderer(this.batcher),h||(h=Rs);var c=0;Cs[c++]=e,Cs[c++]=s,Cs[c++]=h.r,Cs[c++]=h.g,Cs[c++]=h.b,Cs[c++]=h.a,Cs[c++]=a,Cs[c++]=n,this.twoColorTint&&(Cs[c++]=0,Cs[c++]=0,Cs[c++]=0,Cs[c++]=0),Cs[c++]=e+i,Cs[c++]=s,Cs[c++]=h.r,Cs[c++]=h.g,Cs[c++]=h.b,Cs[c++]=h.a,Cs[c++]=o,Cs[c++]=n,this.twoColorTint&&(Cs[c++]=0,Cs[c++]=0,Cs[c++]=0,Cs[c++]=0),Cs[c++]=e+i,Cs[c++]=s+r,Cs[c++]=h.r,Cs[c++]=h.g,Cs[c++]=h.b,Cs[c++]=h.a,Cs[c++]=o,Cs[c++]=l,this.twoColorTint&&(Cs[c++]=0,Cs[c++]=0,Cs[c++]=0,Cs[c++]=0),Cs[c++]=e,Cs[c++]=s+r,Cs[c++]=h.r,Cs[c++]=h.g,Cs[c++]=h.b,Cs[c++]=h.a,Cs[c++]=a,Cs[c++]=l,this.twoColorTint&&(Cs[c++]=0,Cs[c++]=0,Cs[c++]=0,Cs[c]=0),this.batcher.draw(t,Cs,Ms)}drawTextureRotated(t,e,i,r,a,n,o,l,h){this.enableRenderer(this.batcher),h||(h=Rs);let c=e+n,d=i+o,u=-n,m=-o,g=r-n,f=a-o,p=u,x=m,w=u,b=f,y=g,v=f,k=g,A=m,S=0,I=0,C=0,M=0,R=0,T=0,E=0,F=0;if(0!=l){let t=s.cosDeg(l),e=s.sinDeg(l);S=t*p-e*x,I=e*p+t*x,E=t*w-e*b,F=e*w+t*b,R=t*y-e*v,T=e*y+t*v,C=R+(S-E),M=T+(I-F)}else S=p,I=x,E=w,F=b,R=y,T=v,C=k,M=A;S+=c,I+=d,C+=c,M+=d,R+=c,T+=d,E+=c,F+=d;var Y=0;Cs[Y++]=S,Cs[Y++]=I,Cs[Y++]=h.r,Cs[Y++]=h.g,Cs[Y++]=h.b,Cs[Y++]=h.a,Cs[Y++]=0,Cs[Y++]=1,this.twoColorTint&&(Cs[Y++]=0,Cs[Y++]=0,Cs[Y++]=0,Cs[Y++]=0),Cs[Y++]=C,Cs[Y++]=M,Cs[Y++]=h.r,Cs[Y++]=h.g,Cs[Y++]=h.b,Cs[Y++]=h.a,Cs[Y++]=1,Cs[Y++]=1,this.twoColorTint&&(Cs[Y++]=0,Cs[Y++]=0,Cs[Y++]=0,Cs[Y++]=0),Cs[Y++]=R,Cs[Y++]=T,Cs[Y++]=h.r,Cs[Y++]=h.g,Cs[Y++]=h.b,Cs[Y++]=h.a,Cs[Y++]=1,Cs[Y++]=0,this.twoColorTint&&(Cs[Y++]=0,Cs[Y++]=0,Cs[Y++]=0,Cs[Y++]=0),Cs[Y++]=E,Cs[Y++]=F,Cs[Y++]=h.r,Cs[Y++]=h.g,Cs[Y++]=h.b,Cs[Y++]=h.a,Cs[Y++]=0,Cs[Y++]=0,this.twoColorTint&&(Cs[Y++]=0,Cs[Y++]=0,Cs[Y++]=0,Cs[Y]=0),this.batcher.draw(t,Cs,Ms)}drawRegion(t,e,s,i,r,a){this.enableRenderer(this.batcher),a||(a=Rs);var n=0;Cs[n++]=e,Cs[n++]=s,Cs[n++]=a.r,Cs[n++]=a.g,Cs[n++]=a.b,Cs[n++]=a.a,Cs[n++]=t.u,Cs[n++]=t.v2,this.twoColorTint&&(Cs[n++]=0,Cs[n++]=0,Cs[n++]=0,Cs[n++]=0),Cs[n++]=e+i,Cs[n++]=s,Cs[n++]=a.r,Cs[n++]=a.g,Cs[n++]=a.b,Cs[n++]=a.a,Cs[n++]=t.u2,Cs[n++]=t.v2,this.twoColorTint&&(Cs[n++]=0,Cs[n++]=0,Cs[n++]=0,Cs[n++]=0),Cs[n++]=e+i,Cs[n++]=s+r,Cs[n++]=a.r,Cs[n++]=a.g,Cs[n++]=a.b,Cs[n++]=a.a,Cs[n++]=t.u2,Cs[n++]=t.v,this.twoColorTint&&(Cs[n++]=0,Cs[n++]=0,Cs[n++]=0,Cs[n++]=0),Cs[n++]=e,Cs[n++]=s+r,Cs[n++]=a.r,Cs[n++]=a.g,Cs[n++]=a.b,Cs[n++]=a.a,Cs[n++]=t.u,Cs[n++]=t.v,this.twoColorTint&&(Cs[n++]=0,Cs[n++]=0,Cs[n++]=0,Cs[n]=0),this.batcher.draw(t.page.texture,Cs,Ms)}line(t,e,s,i,r,a){this.enableRenderer(this.shapes),this.shapes.line(t,e,s,i,r)}triangle(t,e,s,i,r,a,n,o,l,h){this.enableRenderer(this.shapes),this.shapes.triangle(t,e,s,i,r,a,n,o,l,h)}quad(t,e,s,i,r,a,n,o,l,h,c,d,u){this.enableRenderer(this.shapes),this.shapes.quad(t,e,s,i,r,a,n,o,l,h,c,d,u)}rect(t,e,s,i,r,a){this.enableRenderer(this.shapes),this.shapes.rect(t,e,s,i,r,a)}rectLine(t,e,s,i,r,a,n){this.enableRenderer(this.shapes),this.shapes.rectLine(t,e,s,i,r,a,n)}polygon(t,e,s,i){this.enableRenderer(this.shapes),this.shapes.polygon(t,e,s,i)}circle(t,e,s,i,r,a=0){this.enableRenderer(this.shapes),this.shapes.circle(t,e,s,i,r,a)}curve(t,e,s,i,r,a,n,o,l,h){this.enableRenderer(this.shapes),this.shapes.curve(t,e,s,i,r,a,n,o,l,h)}end(){this.activeRenderer===this.batcher?this.batcher.end():this.activeRenderer===this.shapes&&this.shapes.end(),this.activeRenderer=null}resize(t){let e=this.canvas;var s=window.devicePixelRatio||1,i=Math.round(e.clientWidth*s),r=Math.round(e.clientHeight*s);if(e.width==i&&e.height==r||(e.width=i,e.height=r),this.context.gl.viewport(0,0,e.width,e.height),t===Es.Expand)this.camera.setViewport(i,r);else if(t===Es.Fit){let t=e.width,s=e.height,i=this.camera.viewportWidth,r=this.camera.viewportHeight,a=r/i<s/t?i/t:r/s;this.camera.setViewport(t*a,s*a)}this.camera.update()}enableRenderer(t){this.activeRenderer!==t&&(this.end(),t instanceof ys?(this.batcherShader.bind(),this.batcherShader.setUniform4x4f(us.MVP_MATRIX,this.camera.projectionView.values),this.batcherShader.setUniformi("u_texture",0),this.batcher.begin(this.batcherShader),this.activeRenderer=this.batcher):t instanceof vs?(this.shapesShader.bind(),this.shapesShader.setUniform4x4f(us.MVP_MATRIX,this.camera.projectionView.values),this.shapes.begin(this.shapesShader),this.activeRenderer=this.shapes):this.activeRenderer=this.skeletonDebugRenderer)}}var Es;!function(t){t[t.Stretch=0]="Stretch",t[t.Expand=1]="Expand",t[t.Fit=2]="Fit"}(Es||(Es={}));class Fs extends At{constructor(t){super(t)}setFilters(t,e){}setWraps(t,e){}dispose(){}}const Ys=i.newFloatArray(8);class Ps{static QUAD_TRIANGLES=[0,1,2,2,3,0];static VERTEX_SIZE=8;ctx;triangleRendering=!1;debugRendering=!1;vertices=i.newFloatArray(8192);tempColor=new e;constructor(t){this.ctx=t}draw(t){this.triangleRendering?this.drawTriangles(t):this.drawImages(t)}drawImages(t){let e=this.ctx,s=this.tempColor,i=t.color,r=t.drawOrder;this.debugRendering&&(e.strokeStyle="green");for(let t=0,a=r.length;t<a;t++){let a=r[t],n=a.bone;if(!n.active)continue;let o=a.getAttachment();if(!(o instanceof Nt))continue;o.computeWorldVertices(a,Ys,0,2);let l=o.region,h=l.texture.getImage(),c=a.color,d=o.color;s.set(i.r*c.r*d.r,i.g*c.g*d.g,i.b*c.b*d.b,i.a*c.a*d.a),e.save(),e.transform(n.a,n.c,n.b,n.d,n.worldX,n.worldY),e.translate(o.offset[0],o.offset[1]),e.rotate(o.rotation*Math.PI/180);let u=o.width/l.originalWidth;e.scale(u*o.scaleX,u*o.scaleY);let m=l.width,g=l.height;if(e.translate(m/2,g/2),90==o.region.degrees){let t=m;m=g,g=t,e.rotate(-Math.PI/2)}e.scale(1,-1),e.translate(-m/2,-g/2),e.globalAlpha=s.a,e.drawImage(h,h.width*l.u,h.height*l.v,m,g,0,0,m,g),this.debugRendering&&e.strokeRect(0,0,m,g),e.restore()}}drawTriangles(t){let e=this.ctx,s=this.tempColor,i=t.color,r=t.drawOrder,a=null,n=this.vertices,o=null;for(let t=0,h=r.length;t<h;t++){let h,c=r[t],d=c.getAttachment();if(d instanceof Nt){let t=d;n=this.computeRegionVertices(c,t,!1),o=Ps.QUAD_TRIANGLES,h=t.region.texture.getImage()}else{if(!(d instanceof _t))continue;{let t=d;n=this.computeMeshVertices(c,t,!1),o=t.triangles,h=t.region.texture.getImage()}}if(h){c.data.blendMode!=a&&(a=c.data.blendMode);let t=c.color,r=d.color;s.set(i.r*t.r*r.r,i.g*t.g*r.g,i.b*t.b*r.b,i.a*t.a*r.a),e.globalAlpha=s.a;for(var l=0;l<o.length;l+=3){let t=8*o[l],s=8*o[l+1],i=8*o[l+2],r=n[t],a=n[t+1],c=n[t+6],d=n[t+7],u=n[s],m=n[s+1],g=n[s+6],f=n[s+7],p=n[i],x=n[i+1],w=n[i+6],b=n[i+7];this.drawTriangle(h,r,a,c,d,u,m,g,f,p,x,w,b),this.debugRendering&&(e.strokeStyle="green",e.beginPath(),e.moveTo(r,a),e.lineTo(u,m),e.lineTo(p,x),e.lineTo(r,a),e.stroke())}}}this.ctx.globalAlpha=1}drawTriangle(t,e,s,i,r,a,n,o,l,h,c,d,u){let m=this.ctx;i*=t.width,r*=t.height,o*=t.width,l*=t.height,d*=t.width,u*=t.height,m.beginPath(),m.moveTo(e,s),m.lineTo(a,n),m.lineTo(h,c),m.closePath();var g=1/((o-=i)*(u-=r)-(d-=i)*(l-=r)),f=(u*(a-=e)-l*(h-=e))*g,p=(u*(n-=s)-l*(c-=s))*g,x=(o*h-d*a)*g,w=(o*c-d*n)*g,b=e-f*i-x*r,y=s-p*i-w*r;m.save(),m.transform(f,p,x,w,b,y),m.clip(),m.drawImage(t,0,0),m.restore()}computeRegionVertices(t,e,s){let i=t.bone.skeleton.color,r=t.color,a=e.color,n=i.a*r.a*a.a,o=s?n:1,l=this.tempColor;l.set(i.r*r.r*a.r*o,i.g*r.g*a.g*o,i.b*r.b*a.b*o,n),e.computeWorldVertices(t,this.vertices,0,Ps.VERTEX_SIZE);let h=this.vertices,c=e.uvs;return h[Nt.C1R]=l.r,h[Nt.C1G]=l.g,h[Nt.C1B]=l.b,h[Nt.C1A]=l.a,h[Nt.U1]=c[0],h[Nt.V1]=c[1],h[Nt.C2R]=l.r,h[Nt.C2G]=l.g,h[Nt.C2B]=l.b,h[Nt.C2A]=l.a,h[Nt.U2]=c[2],h[Nt.V2]=c[3],h[Nt.C3R]=l.r,h[Nt.C3G]=l.g,h[Nt.C3B]=l.b,h[Nt.C3A]=l.a,h[Nt.U3]=c[4],h[Nt.V3]=c[5],h[Nt.C4R]=l.r,h[Nt.C4G]=l.g,h[Nt.C4B]=l.b,h[Nt.C4A]=l.a,h[Nt.U4]=c[6],h[Nt.V4]=c[7],h}computeMeshVertices(t,e,s){let r=t.bone.skeleton.color,a=t.color,n=e.color,o=r.a*a.a*n.a,l=s?o:1,h=this.tempColor;h.set(r.r*a.r*n.r*l,r.g*a.g*n.g*l,r.b*a.b*n.b*l,o);let c=e.worldVerticesLength/2,d=this.vertices;d.length<e.worldVerticesLength&&(this.vertices=d=i.newFloatArray(e.worldVerticesLength)),e.computeWorldVertices(t,0,e.worldVerticesLength,d,0,Ps.VERTEX_SIZE);let u=e.uvs;for(let t=0,e=0,s=2;t<c;t++)d[s++]=h.r,d[s++]=h.g,d[s++]=h.b,d[s++]=h.a,d[s++]=u[e++],d[s++]=u[e++],s+=2;return d}}class Ls extends Phaser.PIXI.DisplayObject{constructor(t,e,s){super(t),this.x=e||0,this.y=s||0,this.type=Phaser.SPRITE,this.physicsType=Phaser.SPRITE,Phaser.Component.Core.init.call(this,t,e,s)}get width(){return this.getBounds().width*this.scale.x}set width(t){const{width:e}=this.getBounds();this.scale.x=0!==e?t/e:1,this._width=t}get height(){return this.getBounds().height*this.scale.y}set height(t){const{height:e}=this.getBounds();this.scale.y=0!==e?t/e:1,this._height=t}}Phaser.Component.Core.install.call(Ls.prototype,["Angle","AutoCull","Bounds","BringToTop","Delta","Destroy","FixedToCamera","InCamera","InputEnabled","InWorld","Overlap","PhysicsBody","Reset"]),Ls.prototype.preUpdatePhysics=Phaser.Component.PhysicsBody.preUpdate,Ls.prototype.preUpdateLifeSpan=Phaser.Component.LifeSpan.preUpdate,Ls.prototype.preUpdateInWorld=Phaser.Component.InWorld.preUpdate,Ls.prototype.preUpdateCore=Phaser.Component.Core.preUpdate,Ls.prototype.preUpdate=function(){return!!(this.preUpdatePhysics()&&this.preUpdateLifeSpan()&&this.preUpdateInWorld())&&this.preUpdateCore()};class Xs{constructor(t,e,s,i){this.key=s,this.game=t,this.plugin=e,this.gameObject=i,this.setKeys(s),this.setSkeletonData()}setKeys(t){this.keys={root:t,image:`${t}-image`,text:`${t}-text`,json:`${t}-json`,binary:`${t}-binary`,atlas:`${t}-atlas`,skeleton:`${t}-skeleton`}}setSkeletonData(){Kt.yDown=!0,this.skeleton=this.createSkeleton()}createSkeleton(){return new Kt(this.getSkeletonData())}getSkeletonData(){const t=this.getAtlas();let e;if(this.game.cache.checkSpineSkeleton(this.keys.skeleton))e=this.game.cache.getSpineSkeleton(this.keys.skeleton);else{if(this.game.cache.checkJSONKey(this.keys.json)){const s=this.game.cache.getJSON(this.keys.json);e=new Ve(new Ut(t)).readSkeletonData(s)}else{const s=this.game.cache.getBinary(this.keys.binary);e=new ae(new Ut(t)).readSkeletonData(new Uint8Array(s))}this.game.cache.addSpineSkeleton(this.keys.skeleton,e)}return e}getAtlas(){let t;if(this.game.cache.checkSpineAtlas(this.keys.atlas))t=this.game.cache.getSpineAtlas(this.keys.atlas);else{const e=this.game.cache.getText(this.keys.text);if(t=new Pt(e),this.plugin.isWebGL)if(this.plugin.gl.pixelStorei(this.plugin.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),t.pages.length<2){const e=this.game.cache.getImage(this.keys.image);t.pages[0].setTexture(new $e(this.plugin.gl,e,!1))}else for(const e of t.pages){const t=e.name.replace(/\.[^/.]+$/gm,"").toLocaleLowerCase(),s=this.game.cache.getImage(`${this.keys.root}-${t}`);e.setTexture(new $e(this.plugin.gl,s,!1))}else if(t.pages.length<2){const e=this.game.cache.getImage(this.keys.image);t.pages[0].setTexture(new Fs(e))}else for(const e of t.pages){const t=e.name.replace(/\.[^/.]+$/gm,"").toLocaleLowerCase(),s=this.game.cache.getImage(`${this.keys.root}-${t}`);e.setTexture(new Fs(s))}this.game.cache.addSpineAtlas(this.keys.atlas,t)}return t}}class Bs{static skeletonToPhaserWorldCoordinates(t){const e=this.worldTransform,{a:s,b:i,c:r,d:a,tx:n,ty:o}=e,{x:l,y:h}=t;t.x=l*s+h*r+n,t.y=l*i+h*a+o}static phaserWorldCoordinatesToSkeleton(t){let e=this.worldTransform;e=e.invert();const{a:s,b:i,c:r,d:a,tx:n,ty:o}=e,{x:l,y:h}=t;t.x=l*s+h*r+n,t.y=l*i+h*a+o}static phaserWorldCoordinatesToBone(t,e){this.phaserWorldCoordinatesToSkeleton(t),e.parent?e.parent.worldToLocal(t):e.worldToLocal(t)}static calculateBounds(t){if(!t.skeleton)return{x:0,y:0,width:0,height:0};const e=new Kt(t.skeleton.data);e.setToSetupPose(),e.updateWorldTransform();const s=e.getBoundsRect();return s.width===Number.NEGATIVE_INFINITY?{x:0,y:0,width:0,height:0}:s}static calculateSkinBounds(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.05;const r={x:0,y:0,width:0,height:0};if(!t.skeleton||!t.animationState)return r;const a=new ht(t.animationState.data),n=new Kt(t.skeleton.data),{data:o}=n;if(s.length>0){const t=new se("custom-skin");for(const e of s){const s=o.findSkin(e);null!==s&&t.addSkin(s)}n.setSkin(t)}n.setToSetupPose();const l=null!=e?o.findAnimation(e):null;if(null==l){n.updateWorldTransform();const t=n.getBoundsRect();return t.width===Number.NEGATIVE_INFINITY?r:t}let h=Number.POSITIVE_INFINITY,c=Number.POSITIVE_INFINITY,d=Number.NEGATIVE_INFINITY,u=Number.NEGATIVE_INFINITY;a.clearTracks(),a.setAnimationWith(0,l,!1);const m=Math.max(l.duration/i,1);for(let t=0;t<m;t++){a.update(t>0?i:0),a.apply(n),n.updateWorldTransform();const e=n.getBoundsRect();h=Math.min(h,e.x),c=Math.min(c,e.y),d=Math.max(d,h+e.width),u=Math.max(u,c+e.height)}const g={x:h,y:c,width:d-h,height:u-c};return g.width===Number.NEGATIVE_INFINITY?r:g}}class _s extends Ls{constructor(t,e,s,i,r){let a=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(t,s,i),this.key=r,this.game=t,this.plugin=e,this.premultipliedAlpha=a,this.scaleMode=Phaser.PIXI.scaleModes.LINEAR,this.utils=new Bs,this.debug=!1,this.enableCanvasMesh=!1,this._setCallbacks(),this._setSpine()}_setCallbacks(){this.beforeUpdateWorldTransforms=()=>{},this.afterUpdateWorldTransforms=()=>{}}_setSpine(){this.skeleton=new Xs(this.game,this.plugin,this.key,this).skeleton,this.animationStateData=new yt(this.skeleton.data),this.animationState=new ht(this.animationStateData),this.skeletonBounds=new Xe,this.boundsOffset=new a,this.boundsSize=new a,this.boundsTemp=new Array(2)}_checkSpine(){return!this.inCamera||!this.visible||this.alpha<=0||!this.skeleton||!this.animationState}getBounds(){const t=this._bounds,{data:e}=this.skeleton;e.x||(this.skeleton.getBounds(this.boundsOffset,this.boundsSize,this.boundsTemp),this.boundsSize.x!==Number.NEGATIVE_INFINITY&&(e.x=this.boundsOffset.x,e.width=this.boundsSize.x,e.y=-this.boundsOffset.y,e.height=-this.boundsSize.y));const s=e.x,i=e.width+s,r=-e.y,a=-e.height+r,{a:n,b:o,c:l,d:h,tx:c,ty:d}=this.worldTransform,u=n*i+l*a+c,m=h*a+o*i+d,g=n*s+l*a+c,f=h*a+o*s+d,p=n*s+l*r+c,x=h*r+o*s+d,w=n*i+l*r+c,b=h*r+o*i+d,y=Math.max(u,g,p,w),v=Math.max(m,f,x,b),k=Math.min(u,g,p,w),A=Math.min(m,f,x,b);return t.x=k,t.width=y-k,t.y=A,t.height=v-A,t}replaceSpine(t){this.key=t,this._setSpine()}preUpdate(){this._checkSpine()||this.updatePose(this.game.time.delta)}update(){}postUpdate(){}updatePose(t){this.animationState.update(t/1e3),this.animationState.apply(this.skeleton),this.beforeUpdateWorldTransforms(this),this.skeleton.updateWorldTransform(),this.afterUpdateWorldTransforms(this)}destroy(){this.destroyPhase=!0,this.renderable=!1,this.events&&this.events.onDestroy$dispatch(this),this.parent&&(this.parent instanceof Phaser.Group?this.parent.remove(this):this.parent.removeChild(this)),this.input&&this.input.destroy(),this.transformCallback&&(this.transformCallback=null,this.transformCallbackContext=null),this.game.tweens.removeFrom(this),delete this.skeleton,delete this.animationStateData,delete this.animationState,delete this.skeletonBounds,delete this.spineBounds,delete this.boundsOffset,delete this.boundsSize,delete this.boundsTemp,delete this.beforeUpdateWorldTransforms,delete this.afterUpdateWorldTransforms,delete this.debug,delete this.enableCanvasMesh,delete this.utils,delete this.scaleMode,delete this.key,delete this.premultipliedAlpha,delete this.alive,delete this.exists,delete this.visible,delete this.filters,delete this.mask,delete this.game,delete this.data,delete this.hitArea,delete this.parent,delete this.stage,delete this.worldTransform,delete this.filterArea,delete this._bounds,delete this._currentBounds,delete this._mask,this._destroyCachedSprite(),this.destroyPhase=!1,this.pendingDestroy=!1}_renderWebGL(t){if(this._checkSpine()||!this.plugin.webGLRenderer)return;const{currentBlendMode:e}=t.blendModeManager,{currentShader:s}=t.shaderManager;t.spriteBatch.stop();for(let e=0;e<t.shaderManager.attribState.length;e++)t.shaderManager.attribState[e]=null,t.gl.disableVertexAttribArray(e);const{a:i,b:r,c:a,d:n,tx:o,ty:l}=this.worldTransform,h=this.plugin.webGLRenderer;this._mask&&t.maskManager.pushMask(this._mask,t),this._filters&&t.filterManager.pushFilter(this._filterBlock),h.begin(),h.drawSkeleton(this.skeleton,this.premultipliedAlpha,-1,-1,((t,e,s)=>{for(let h=0;h<e;h+=s){const e=t[h],s=t[h+1];t[h]=e*i+s*a+o,t[h+1]=e*r+s*n+l}})),h.end(),this._filters&&t.filterManager.popFilter(),this._mask&&t.maskManager.popMask(this.mask,t),t.drawCount++,t.blendModeManager.currentBlendMode=-1,t.blendModeManager.setBlendMode(e),t.gl.enable(t.gl.BLEND),t.shaderManager._currentId=null,t.shaderManager.setShader(s),t.spriteBatch.start(),this.debug&&this._debug()}_renderCanvas(t){if(this._checkSpine()||!this.plugin.canvasRenderer)return;const{context:e}=t,{a:s,b:i,c:r,d:a,tx:n,ty:o}=this.worldTransform,{skeleton:l}=this,h=this.plugin.canvasRenderer;e.setTransform(s,i,r,a,n,o),this.blendMode&&this.blendMode!==t.currentBlendMode&&(t.currentBlendMode=this.blendMode,t.context.globalCompositeOperation=Phaser.PIXI.blendModesCanvas[t.currentBlendMode]),this._mask&&t.maskManager.pushMask(this._mask,t),t.smoothProperty&&t.scaleMode!==this.scaleMode&&(t.scaleMode=this.scaleMode,t.context[t.smoothProperty]=t.scaleMode===Phaser.PIXI.scaleModes.LINEAR),this.debug&&this._debug(),h.debugRendering=this.debug,h.triangleRendering=this.enableCanvasMesh,e.save(),h.ctx=e,h.draw(l),e.restore(),this._mask&&t.maskManager.popMask(t)}_debug(){this.game.debug.spriteBounds(this,"rgba(0,0, 255, 0.5)")}}class Vs extends Phaser.Plugin{constructor(t,e){super(t,e),this.game=t,this.pluginManager=e,this.spineList=[],this._setFlags(),this._rendererConfig(),this._addSpineCache(),this._addSpineLoader(),this._addSpineFactory(),this._addRenderers()}_setFlags(){this.hasPostRender=!1,this.hasPostUpdate=!1,this.hasPreUpdate=!1,this.hasRender=!1,this.hasUpdate=!1}_rendererConfig(){this.isWebGL=this.game.renderType===Phaser.WEBGL||this.game.renderType===Phaser.WEBGL_MULTI,this.gl=this.isWebGL?this.game.renderer.gl:null,this.webGLRenderer=null,this.canvasRenderer=null}_addSpineCache(){Phaser.Cache.prototype.addCustom=function(t){this._cache[t]={},this[t.toUpperCase()]=this._cacheMap.length,this._cacheMap[this[t.toUpperCase()]]=this._cache[t];const e=this[t.toUpperCase()],s=t.charAt(0).toUpperCase()+t.slice(1);Phaser.Cache.prototype[`add${s}`]=function(e,s){this._cache[t][e]=s},Phaser.Cache.prototype[`check${s}`]=function(t){return this.checkKey(e,t)},Phaser.Cache.prototype[`get${s}`]=function(t){return this.getItem(t,e,`get${s}`)}},this.skeletonDataCache=this.game.cache.addCustom("spineSkeleton"),this.atlasCache=this.game.cache.addCustom("spineAtlas")}_addSpineLoader(){Phaser.Loader.prototype.spine=function(t,e,s){if(this.text(`${t}-text`,e.atlas,s),e.json&&this.json(`${t}-json`,e.json),e.binary&&this.binary(`${t}-binary`,e.binary),e.image)this.image(`${t}-image`,e.image,s);else for(const i in e.images)Object.prototype.hasOwnProperty.call(e.images,i)&&this.image(`${t}-${i.toLocaleLowerCase()}`,e.images[i],s);return this}}_addSpineFactory(){const t=this;Phaser.GameObjectFactory.prototype.spine=function(e,s,i,r,a){void 0===a&&(a=!1),void 0===r&&(r=this.world);const n=new _s(this.game,t,e,s,i,a);return t.spineList.push(n),r.add(n)},Phaser.GameObjectCreator.prototype.spine=function(e,s,i,r){void 0===r&&(r=!1);const a=new _s(this.game,t,e,s,i,r);return t.spineList.push(a),a}}_addRenderers(){this.isWebGL?(this.webGLRenderer||(this.webGLRenderer=new Ts(this.game.canvas,this.gl,!0)),this.onResize(),this.game.scale.onSizeChange.add(this.onResize,this)):this.canvasRenderer||(this.canvasRenderer=new Ps(this.game.context)),this.game.onDestroy.addOnce(this.gameDestroy)}onResize(){const t=this.game.renderer,e=this.webGLRenderer;if(t&&e){const s=t.width,i=t.height;e.camera.position.x=s/2,e.camera.position.y=i/2,e.camera.up.y=-1,e.camera.direction.z=1,e.camera.setViewport(s,i)}}destroy(){this.isWebGL&&this.game.scale.onSizeChange.remove(this.onResize),super.destroy()}gameDestroy(){for(const t of this.spineList)t.destroy&&t.destroy();this.webGLRenderer&&this.webGLRenderer.dispose()}}window.SpinePlugin=Vs})();
//# sourceMappingURL=spine-phaser-ce.min.js.map